#include "../src/PolynomEvaluation.h"
#include <gtest/gtest.h>

/*
 * Theoretical absolute relative error is calculated using this expression:
 * RELATIVE_ERROR ~< (100 * PRECISION) + CONDITION_NUMBER * (100 * PRECISION) ^ 2
 * where u = 2^-53 ~ 1.11e-16 -- unit roundoff for double aka scalar
 */

template<typename T>
T calc_gamma(const indexType &n) {
    T u = 1.11e-16;
    return n * u / (1 - n * u);
}

template<typename T, indexType N>
Polynom<T, N> abs(const Polynom<T, N> &polynom) {
    Polynom<T, N> result(polynom);

    for (indexType i = 0; i < N + 1; ++i) {
        result[i] = abs(result[i]);
    }

    return result;
}

template<typename T, indexType N>
T calc_absolute_error(const Polynom<T, N> &polynom, const T &x) {
    T res;
    T u = 1.11e-16;
    Polynom<T, N - 1> polynom_pi, polynom_sigma;

    ReturnStruct<T> p, s;
    s.result = polynom[N];

    for (long long i = N - 1; i >= 0; i--) {

        p = two_product_fma(s.result, x);
        s = two_sum(p.result, polynom[i]);

        polynom_pi[i] = p.error;
        polynom_sigma[i] = s.error;
    }

    res = s.result + horner(polynom_pi + polynom_sigma, x);

    return u * abs(res) +
           (calc_gamma<T>(4 * N + 2) * horner(abs(polynom_pi) + abs(polynom_sigma), abs(x)) + 2 * u * u * abs(res));

}

TEST(POLYNOM_EVAL, TEST_1) {

    /*
     * (x - 1) ^ 10
     */

    Containers::array<scalar, 11> coeffs = {1, -10, 45, -120, 210, -252, 210, -120, 45, -10, 1};
    Containers::array<scalar, 100> test_points = {1.33300, 1.32987, 1.32674, 1.32361, 1.32048, 1.31735, 1.31422,
                                                  1.31109,
                                                  1.30796, 1.30483, 1.30170, 1.29857, 1.29544, 1.29231, 1.28918,
                                                  1.28605,
                                                  1.28292, 1.27979, 1.27666, 1.27353, 1.27040, 1.26727, 1.26414,
                                                  1.26101,
                                                  1.25788, 1.25475, 1.25162, 1.24849, 1.24536, 1.24223, 1.23910,
                                                  1.23597,
                                                  1.23284, 1.22971, 1.22658, 1.22345, 1.22032, 1.21719, 1.21406,
                                                  1.21093,
                                                  1.20780, 1.20467, 1.20154, 1.19841, 1.19528, 1.19215, 1.18902,
                                                  1.18589,
                                                  1.18276, 1.17963, 1.17650, 1.17337, 1.17024, 1.16711, 1.16398,
                                                  1.16085,
                                                  1.15772, 1.15459, 1.15146, 1.14833, 1.14520, 1.14207, 1.13894,
                                                  1.13581,
                                                  1.13268, 1.12955, 1.12642, 1.12329, 1.12016, 1.11703, 1.11390,
                                                  1.11077,
                                                  1.10764, 1.10451, 1.10138, 1.09825, 1.09512, 1.09199, 1.08886,
                                                  1.08573,
                                                  1.08260, 1.07947, 1.07634, 1.07321, 1.07008, 1.06695, 1.06382,
                                                  1.06069,
                                                  1.05756, 1.05443, 1.05130, 1.04817, 1.04504, 1.04191, 1.03878,
                                                  1.03565,
                                                  1.03252, 1.02939, 1.02626, 1.02313};

    Containers::array<scalar, 100> reference_results = {0.00001676649698063893054717344900000000000000000000,
                                                        0.00001525556176801552845313919069987423155670401849,
                                                        0.00001386829423082166304381656073207781644307301376,
                                                        0.00001259561375535855268091810142176341349182475601,
                                                        0.00001142902859999423031111523482886550872888705024,
                                                        0.00001036060285388417872160114078674455088369140625,
                                                        0.00000938292495534294004732059969202580562904679424,
                                                        0.00000848907771040413796967404875743869628767313401,
                                                        0.00000767260975382314121600617439234315227497496576,
                                                        0.00000692750839646001861311495918807033820723565449,
                                                        0.00000624817380463081656267319358938104490000000000,
                                                        0.00000562939445863285688814902366143094692187677249,
                                                        0.00000506632383923503404785311134580282846322098176,
                                                        0.00000455445829247731321343540617159670853603712801,
                                                        0.00000408961602464512217381234148043451644986778624,
                                                        0.00000366791718077441793743344776971153761728515625,
                                                        0.00000328576496150222076730289468868722654077517824,
                                                        0.00000293982773450567168956430546922812682918298201,
                                                        0.00000262702209817051176404430706937050579536331776,
                                                        0.00000234449685649763009023965998553486210613872049,
                                                        0.00000208961786559431014113242748037365760000000000,
                                                        0.00000185995371340534806623546881004241726607673649,
                                                        0.00000165326219561864958071454884932769299864830976,
                                                        0.00000146747755193056145561152123771825561374711001,
                                                        0.00000130069842807838694141333773634322424711348224,
                                                        0.00000115117653024159918978203682689762115478515625,
                                                        0.00000101730593957953038248934363140701161783092224,
                                                        8.9761305581210432879404491812341162005764001E-7,
                                                        7.9074713986182424896886121616947873081982976E-7,
                                                        6.9547142666005281873409682193210269323059649E-7,
                                                        6.1065478027895580329588167582484010000000000E-7,
                                                        5.3526386458265125682530065106615074370071049E-7,
                                                        4.6835580359744079985910965873205026436939776E-7,
                                                        4.0907130678182540956103806771255309388430201E-7,
                                                        3.5662823533265296236284719650609992240333824E-7,
                                                        3.1031558659453595151432898820000349619140625E-7,
                                                        2.6948787454594285981926136268276400729882624E-7,
                                                        2.3355988521743309662796108329085916266350801E-7,
                                                        2.0200178675570070430446521088326273218610176E-7,
                                                        1.7433457468174369919550227893644748105848249E-7,
                                                        1.5012583370291143190725814083594240000000000E-7,
                                                        1.2898579822712922775247294728259856696149449E-7,
                                                        1.1056369449358529687259883980753131418264576E-7,
                                                        9.454434797791698107557662797420714412230401E-8,
                                                        8.064504045177932716722788511429054561255424E-8,
                                                        6.861260177694624080128048257061701650390625E-8,
                                                        5.822072219311057693762451758097270995969024E-8,
                                                        4.926747151664195918850580730519669731098601E-8,
                                                        4.157301230505738695597955325043738988773376E-8,
                                                        3.497749465918728262904135866014869438557849E-8,
                                                        2.933912093230604752340043847656250000000000E-8,
                                                        2.453236919316893101883452943888061964788849E-8,
                                                        2.044636484828356878644161891524984099045376E-8,
                                                        1.698339036817240940885409736067679455871601E-8,
                                                        1.405752358317892038858023302036342495233024E-8,
                                                        1.159339551686344082105990083345746572265625E-8,
                                                        9.52505920955132518774020261087397805031424E-9,
                                                        7.79496145146409710846592463761222657447401E-9,
                                                        6.35300979441119978971362405982544161432576E-9,
                                                        5.15572764357308762365044893475786443108449E-9,
                                                        4.16549064679334724064351082250240000000000E-9,
                                                        3.34983799834576260265667545731171888469249E-9,
                                                        2.68085265767924375492294852787426511922176E-9,
                                                        2.13460485149681893634614209550284939513801E-9,
                                                        1.69065358002194119323914486153584520986624E-9,
                                                        1.33160118577367975422181853537796884765625E-9,
                                                        1.04269636593944951435323512746772102349824E-9,
                                                        8.1148131782727535183458827201030761237201E-10,
                                                        6.2747900122668796886458784751674799947776E-10,
                                                        4.8191678213570081743241338400043111020049E-10,
                                                        3.6748298954841974896829019906010000000000E-10,
                                                        2.7811317117118462181239506598164489270649E-10,
                                                        2.0880307537223152038302766037867063934976E-10,
                                                        1.5544561569819179269873223272208661717001E-10,
                                                        1.1468929123780610651025308734045398836224E-10,
                                                        8.381574130652446670078968906402587890625E-11,
                                                        6.063430669268293579091474159483930804224E-11,
                                                        4.339165237419096331166356187137248708001E-11,
                                                        3.069467851162606645962768711767630078976E-11,
                                                        2.144510797681142179532207088203327412649E-11,
                                                        1.478429001284303376457562613760000000000E-11,
                                                        1.004690116963284848615143239565874873049E-11,
                                                        6.72235674583878853116781472954968523776E-12,
                                                        4.42286892105850429509690058258567441201E-12,
                                                        2.85720190886697800509534019477594701824E-12,
                                                        1.80928012917528538810481338951181640625E-12,
                                                        1.12090291497512552247991427100606874624E-12,
                                                        6.7790896130747938179018105473648499801E-13,
                                                        3.9921592075026002783359574493207986176E-13,
                                                        2.2823557735538029472299264376695006249E-13,
                                                        1.2623321727659510109666068490000000000E-13,
                                                        6.726148681208320699217728782814556449E-14,
                                                        3.435451473632526964034578771477528576E-14,
                                                        1.671770311071942231619946642316046401E-14,
                                                        7.69268673786027635855775293504103424E-15,
                                                        3.31585355680020247074923367666015625E-15,
                                                        1.32283406222095737502667401696641024E-15,
                                                        4.8083476557715974406625985443652601E-16,
                                                        1.5593629723875900694168127888229376E-16,
                                                        4.382847176545605626845729158120849E-17};

    Containers::array<scalar, 100> reference_errors =
            {1.1855408673623661210000E-14,
             1.189633148958322268072543612479436422767816117605194260120180072142101578661004831842378638566002527E-14,
             1.193968265118530393681522147370684325363128257590108414780002338930979512236689959611370438202387399E-14,
             1.198561905053806624803671632957585562917737993513904280409869809234043897487860101628395222273647660E-14,
             1.203430855753277711120625537641267167057038563568973864736113479960350170603336231434381458561593349E-14,
             1.208593084776290519628675310434780009116140514441342929797159407104434945451420088463137457795555957E-14,
             1.214067829746004450958680453919562547371825867138470399714834975746166112156835266684639461772139466E-14,
             1.219875695124711844876699952984185990795453863407616130635925408291735222314688896083383323095374154E-14,
             1.226038756904431026858307047563252552964487120865721688766956256668190824569425392470659960371894528E-14,
             1.232580675905058580574581992600143982145509138626318057231996181532919379765350310192559955124905270E-14,
             1.239526820436895954448157527162738313356747436468169504466178243573757423006335699459710651228862061E-14,
             1.246904399155284578263380500322660257391967471677576802909578007936984518576266766790361432750886193E-14,
             1.254742605013063852571067320901800180456014735278316049675357710609634337965921456753586399936225913E-14,
             1.263072771302352622983864911354209093717057977724134666073879559497255431848877544556545307888427855E-14,
             1.271928540871575073712668352640399746090712227167445335063442490168077590246857585724493682232184441E-14,
             1.281346049707627214530505825013975999238999136915629323939195550548890541209515172513675776401731626E-14,
             1.291364126187634948302168807663260283048024579889737673808384098011839467819737692604160213077412545E-14,
             1.302024507431029900963348885905601840763768311382562307718144050137686455216616515659323694993407678E-14,
             1.313372074321935620823116900782231051633073166848355453924721219632345352870580621748688578254533260E-14,
             1.325455106925530931471882634912858816198336309650992793585556768194085279043206470949597606345884553E-14,
             1.338325562191718960524989087502803704323443771194042347099510268802536150843586385540905142990514371E-14,
             1.352039376026842612458220973012984706564397009045287066592264517847012654514204465257140496010623820E-14,
             1.366656792021318489189077136671686568505955639407333302598183476997403969343308495766849673198028163E-14,
             1.382242719350110778713954159589386213087573891328013220037947529101790764613860486895381170711563777E-14,
             1.398867122616393081652771371886599282031778926808647805117527057597016511130522322130219423476214388E-14,
             1.416605446689299805886425571395814576306471368045417671266483245050613266297182731220461726188265082E-14,
             1.435539079897428027312648620325558653551585404157898194024488571578822382578123215421775022557575482E-14,
             1.455755859284163405689309474741171904843274692379950622853786297628037955998363918696235573053195578E-14,
             1.477350622012833866204370614592705881515006561405098788696269937086192592376353709940433637218743871E-14,
             1.500425807433475517821532446954690766799370529732656126522063835175226657619421080493462243310733622E-14,
             1.525092114793489204071446759586385854116777214207625841933736008314188119451616165290095541352951069E-14,
             1.551469222097133241346230904032841690651691433800294395507079889145216662585500589021072074973300329E-14,
             1.579686572199773397708243929088163723122058304872663599213878911921694549318488512033972608907016117E-14,
             1.609884232868993208507276392298552052281570646287226279430209718951148392289313991878302917699585797E-14,
             1.642213838263817793480814071101336902962943815110027504496233232621580007510998910035595986906549312E-14,
             1.676839620084161204063497195685759053489557186672772277259714453480142111307194449920533308253093383E-14,
             1.713939537535016928543549481104706330770318989082966795180080211500783490845158692715989598492714069E-14,
             1.753706516244974681149147726367921398614556436507477145120829310523798747049119463687710454569494776E-14,
             1.796349807388889300087517590035311198599816661216277308215504347277482023689166995534477317472587140E-14,
             1.842096479504091768876574084366796589871301693485760380626142410503551147790169108787683072872351654E-14,
             1.8911930568743976960000E-14,
             1.943907319904404029528360712247685022053206544299766867470002140864421872177039546703698096716216554E-14,
             2.000530284638617091723078278669378964451725605240453243549071127762441756122442564011529872652704633E-14,
             2.061378380518979045521998453214803359143587809479149896756351783209997767666020508194672907091967536E-14,
             2.126795847646597312935203195403024311477894181601693891037738548983367855692943325134052740068063860E-14,
             2.197157377248695232156842444218009545205632422564746032100793709027154572106187375436283217761859897E-14,
             2.272871021783775605641489069643058862066454356044618698004790981455545113822920990845719639033074526E-14,
             2.354381404185098702410214479354535760138492034248046036061673185445987655395909287038506138543124965E-14,
             2.442173259188453026865168233754744145600977794060987716211716816113738310607347855514051797945403367E-14,
             2.536775343564483850903616196906878198855301364613015279386208719328123896634028204313057166537963414E-14,
             2.638764756435072197604176192653558908702941624752324340801707056851089772900472488949855204999237921E-14,
             2.748771715761854130586938290738739060162518392906077881820742454655560813619002208755952236322741584E-14,
             2.867484842626428045845955187831493137564894623827065573287290232300301429279683926917881134523075451E-14,
             2.995657011160016711910310407481292639797626663191032579850619063737028956302045174817488787419410360E-14,
             3.134111829021198418998583207686499873991055962544582989559443364509843763021744507653625305479462408E-14,
             3.283750821273435136864672891094813512323059795806042455750291910815107421938224524955393527507681113E-14,
             3.445561399505002007449469119326830440297131523160098019493233358651818747768913171755353393299753952E-14,
             3.620625708206342298804290801754610662782974638937882583332232430478018138956449561225471948517634359E-14,
             3.810130451938713644977532983337685714412927709254851163149231059004051354592649989017963882707916531E-14,
             4.015377819882502898488274252169761683835618861339334933642687448317672495128591339029330181700232993E-14,
             4.237797639161191724559375214498881634758732436766521798870951698851321306384617081973082887697534166E-14,
             4.478960905147685368801443996297180485460148548860434548670806116172686871364551102225966181131541497E-14,
             4.740594856061382424422537200472774479594374076692390083240301847059184882265471477461461690511241515E-14,
             5.024599780888583635394453389141678497666703993767879971041124049226778451639696842089630457965170755E-14,
             5.333067774388091490977630397433268003217897964153147394987274921640741849557831950557257863825774086E-14,
             5.668303681119722350827330278464217761810354479290597901465830005850667991743520674068990556232621582E-14,
             6.032848502566280993357165999919740441344692525577965763775454400059646540877678515700508464120551122E-14,
             6.429505578099753793981776785512842502262780437090035043984993159978022228021827392213080647992990412E-14,
             6.861369892453843981920774051343595722486514435156058075671112448664768003501334778527321931851414272E-14,
             7.331860910300256059515562267885425739313387269301486462374365210105520075931545217114190695724634957E-14,
             7.844759393405428385671112852194393949132661964117756028999513213730253884347351895713831950611998748E-14,
             8.404248718736770584843674675844383442851361026216221126624653732508402068480319437073010375490503259E-14,
             9.014961288036414979329606056213378906250000E-14,
             9.682030702234154471445794077625352965488709303789782147013395349406865530900174290132612928476471142E-14,
             1.041115046931791686894539828208269212749713413036728895782996239278703660463037532491617115982629331E-13,
             1.12086401238904491210000E-13,
             1.208151976291775810903683574243761941981275208872944257883026988314638578534872779554631235530636786E-13,
             1.303759414781272477880826810310604957191931389397281417770947922614905797810976940259971273080649654E-13,
             1.408554769115259962062222972185901493391947316247405240634613181972304934429091417858793904609202524E-13,
             1.523505184070401131493233543001442299264343271390313001327246786151577151696693336623159136345427192E-13,
             1.649688659837154075005044962658131382411217802164304221917390641670477061423563481176649900929736321E-13,
             1.788307817230850675079474688241994411302032717645555124489786148943744055113355825604938931563090707E-13,
             1.940705506275125382425993888383111931921088104203517373080159138961624431746269810889905554573073712E-13,
             2.108382523325838324515392503260245149503368766591856037760882643413799997494110092474834754851276712E-13,
             2.293017742733324662587093753853630484169465836166981675156595023733083802912189316417000738901724471E-13,
             2.496491016578765715311638298671029503962648882206952667709978508603604141689571171759186013150411520E-13,
             2.720909251439455190167817046010626693222106400090029203559638117240541298740144598958302012643518987E-13,
             2.968636135828056790920895067534451718854495468757393077227879575424264813953195635242862411699614022E-13,
             3.242326067563291446550149931543205755347435767726325643490272664561842726263071636410877188039933368E-13,
             3.544962918826496455632452809088390579309607678617700930510931329815423379348343973695763532807902088E-13,
             3.879904380377221928712692028929784646817641846877209164132771718432956072345249108797592452228368408E-13,
             4.250932748128598116496842864781950234372273799386691953300943624349758934430230787994631867653924246E-13,
             4.662313158348629226934245646820444329647436027711964920437128065552363205830226699279961572797855699E-13,
             5.118860446139349179424756102406245899484256076552426293303954726137265411313087439852958574921395625E-13,
             5.626016000323828525983647228470873586776750716352999808121650337997574223279838693104653975811661346E-13,
             6.189936222168482907441822026186900155273783816851763716033201750408636905572520325809001310159851834E-13,
             6.817594472369982394933269016810539473610312381156448233559842532352205204632464613783111429082292775E-13,
             7.516898718733211489729828023184982839734527455047008196636162432056192854910680253842133420144531438E-13,
             8.296827485960333965734549268563149479594319927286397912317379807590764789649859298921916318785587645E-13,
             9.167587171046441344892620691102826168696625372024753318747827316941690192367728749508982954529874762E-13};


    Containers::array<scalar, 100> condition_numbers = {284908268, 308950347, 335316954, 364261300, 396067289,
                                                        431053619, 469578476, 512044935, 558907151, 610677502,
                                                        667934806, 731333824, 801616239, 879623372, 966310937,
                                                        1062766187, 1170227862, 1290109462, 1424026418, 1573827891,
                                                        1741634056, 1929879883, 2141366668, 2379322792, 2647475509,
                                                        2950135945, 3292299955, 3679768042, 4119288283, 4618727047,
                                                        5187273398, 5835684415, 6576580351, 7424800656, 8397834526,
                                                        9516342992, 10804793729, 12292235115, 14013242833, 16009080924,
                                                        18329130269, 21032651663, 24190968938, 27890181317, 32234544961,
                                                        37350703874, 43393003052, 50550186070, 59053871092, 69189321098,
                                                        81309186824, 95851119184, 113360442230, 134519476815,
                                                        160185649051, 191441263601, 229658850537, 276587422151,
                                                        334466970051, 406181336224, 495463560518, 607173466094,
                                                        747675374443, 925355612910, 1151336660670, 1440470075687,
                                                        1812727919368, 2295168727763, 2924739360161, 3752304492303,
                                                        4848497173296, 6312299153828, 8283758548405, 10963051641697,
                                                        14639393221827, 19735436090934, 26876369942878, 36998988697380,
                                                        51526452933093, 72652847626433, 103814536030846,
                                                        150485433163192, 221545610461463, 331687329031778,
                                                        505743561994414, 786672370627764, 1250691416447052,
                                                        2036832241481142, 3406569326268638, 5868540950522913,
                                                        10450044723923863., 19314948000597488.,
                                                        37242107703777547., 75368409787325063., 161296743236039092.,
                                                        368498524828089219., 909584200909524335.,
                                                        2464105507801976722.,
                                                        7481772431423944575.,
                                                        26210878242475537296.};


    Polynom<scalar, 10> polynom(coeffs);

    for (indexType i = 0; i < test_points.size(); ++i) {
        scalar compensated_horner_result = compensated_horner(polynom, test_points[i]);
        scalar experimental_relative_error = std::abs(
                (reference_results[i] - compensated_horner_result) * 1 / std::abs(reference_results[i]));
        ASSERT_TRUE(experimental_relative_error < reference_errors[i]);
    }

}

TEST(POLYNOM_EVAL, TEST_2) {

    /*
     * (x - 1) ^5 * (x - 5) ^ 5
     */

    Containers::array<scalar, 11> coeffs = {3125, -18750, 48125, -69000, 60650, -33876, 12130, -2760, 385, -30, 1};
    Containers::array<scalar, 100> test_points = {0.97000, 0.97029, 0.97058, 0.97087, 0.97116, 0.97145, 0.97174,
                                                  0.97203, 0.97232, 0.97261, 0.97290, 0.97319, 0.97348, 0.97377,
                                                  0.97406, 0.97435, 0.97464, 0.97493, 0.97522, 0.97551, 0.97580,
                                                  0.97609, 0.97638, 0.97667, 0.97696, 0.97725, 0.97754, 0.97783,
                                                  0.97812, 0.97841, 0.97870, 0.97899, 0.97928, 0.97957, 0.97986,
                                                  0.98015, 0.98044, 0.98073, 0.98102, 0.98131, 0.98160, 0.98189,
                                                  0.98218, 0.98247, 0.98276, 0.98305, 0.98334, 0.98363, 0.98392,
                                                  0.98421, 0.98450, 0.98479, 0.98508, 0.98537, 0.98566, 0.98595,
                                                  0.98624, 0.98653, 0.98682, 0.98711, 0.98740, 0.98769, 0.98798,
                                                  0.98827, 0.98856, 0.98885, 0.98914, 0.98943, 0.98972, 0.99001,
                                                  0.99030, 0.99059, 0.99088, 0.99117, 0.99146, 0.99175, 0.99204,
                                                  0.99233, 0.99262, 0.99291, 0.99320, 0.99349, 0.99378, 0.99407,
                                                  0.99436, 0.99465, 0.99494, 0.99523, 0.99552, 0.99581, 0.99610,
                                                  0.99639, 0.99668, 0.99697, 0.99726, 0.99755, 0.99784, 0.99813,
                                                  0.99842, 0.99871};

    Containers::array<scalar, 100> reference_results =
            {0.00002583042217025049000000000000000000000000000000, 0.00002459700471037052007455308861026885959424230201,
             0.00002341132697363821617311572767749332508175565824, 0.00002227197978942935021011258952136067317208758849,
             0.00002117758247551610557516928600347107755505483776, 0.00002012678252779634205831121774428502794931640625,
             0.00001911825531062858660185286845609263283111781376, 0.00001815070374777216068330057799872075930323735049,
             0.00001722285801393185546685690878003383837208346624, 0.00001633347522690656619427300346985842384121734601,
             0.00001548133914034129761884683294039432010000000000, 0.00001466525983708195261930996715509037028428274801,
             0.00001388407342313231646318348366798490360976769024, 0.00001313664172221264952191487373326346112555451649,
             0.00001242185197091930157273233002689383470315570176, 0.00001173861651448476115467061791528474676259765625,
             0.00001108587250313755377863385933660375003982462976, 0.00001046258158906140312366500995530621961617900249,
             0.00000986772962395306968378960157619472545893991424, 0.00000930032635717828166189246812757069485945588001,
             0.00000875940513452517323907069011038218240000000000, 0.00000824402259755464567978389452833684242980248401,
             0.00000775325838354706706489435022936192748246836224, 0.00000728621482604472677635401756817739761886233449,
             0.00000684201665598946118885386160972810232923160576, 0.00000641981070345486735520233500042057037353515625,
             0.00000601876559997252180354499540515329577734808576, 0.00000563807148145162189577575830964062213000634449,
             0.00000527693969169146752762231428613348434954420224, 0.00000493460248648620128191377578295944918314810401,
             0.00000461031273832122547745767739096378490000000000, 0.00000430334364166071488676605062955676890320471001,
             0.00000401298841882564422657644484828419133668327424, 0.00000373856002646174985571348512326211518916144249,
             0.00000347939086259684544532986130807749089838334976, 0.00000323483247428691171695254494247727803212890625,
             0.00000300425526585038067404054779597438026620338176, 0.00000278704820769003508293468269401303459099297649,
             0.00000258261854570194428914757920818339345513473024, 0.00000239039151127085778490365905577898139502681801,
             0.00000220981003185147827369390391437557760000000000, 0.00000204033444213503630735906708069995482267662601,
             0.00000188144219580058890085750525647587506005402624, 0.00000173262757785046485941005299380688550085824049,
             0.00000159340141752927988214434524560485635641573376, 0.00000146329080182594483568472830922393736337890625,
             0.00000134183878955809092035140149043576396480971776, 0.00000122860412603833578074371631680739943906849849,
             0.00000112316095832181494148764236104273755136589824, 0.00000102509855103440327782630396254499364840882201,
             9.3402100278105155952521562597656250000000000E-7, 8.4954696313366343525041089555700061042943201E-7,
             7.7130935019793855315808531987428117471821824E-7, 6.9895506875860784190867400071285333793512849E-7,
             6.3214472900248730468647342744849592759755776E-7, 5.7055236581877700706801110254857136728515625E-7,
             5.1386515867603226773838013027114004173029376E-7, 4.6178315207523438910470473640157096749851049E-7,
             4.1401897657838859279980187842486322662810624E-7, 3.7029757041207715290696895952995624095491601E-7,
             3.3035590164539604746867344290293760000000000E-7, 2.9394269094170377646776214151333680293832801E-7,
             2.6081813488361132198966139965570393298945024E-7, 2.3075362987064255368791955250149594827050649E-7,
             2.0353149658899470998336521546801194442162176E-7, 1.7894470505282891262913438294581441884765625E-7,
             1.5679660021652099936987127246782824191230976E-7, 1.3690062815730328641354760237620471456461249E-7,
             1.1908006282772819931858780507115676236775424E-7, 1.0316773337738503767734882063339498042990001E-7,
             8.900575204330146564949785362260490000000000E-8, 7.644524260846164696547507579268549318251401E-8,
             6.534606942787326948103598595429956503732224E-8, 5.557656702161603071885526188075029995877449E-8,
             4.701327023430448208235572461837682936472576E-8, 3.954064496039845557031774945163726806640625E-8,
             3.305081943479462285844136670990222492696576E-8, 2.744331608813306254589066621179732724440449E-8,
             2.262478396625303719096321804779180540724224E-8, 1.850873171323250748041131622671366246257401E-8,
             1.501526111744623649161220708106240000000000E-8, 1.207080122007766251575634786346968488519001E-8,
             9.60784298552004431351141929650871856743424E-9, 7.56467453310270797224055558435640963033249E-9,
             5.88511692957854972582132318165074864766976E-9, 4.51826054180927418444264206634103994140625E-9,
             3.41820194908517240246536700348285520946176E-9, 2.54378141451656908753389793986473689148649E-9,
             1.85832091493439302363623485915179226497024E-9, 1.32936272873764944474359977797438030573801E-9,
             9.2840858112589765403338369916010000000000E-10, 6.3065934615516163652600588318623875355601E-10,
             4.1475530505602576026256337699973050138624E-10, 2.6251696025299190293116697469450277158049E-10,
             1.5868640452449847713087230123385799525376E-10, 9.066924474332585825838813254023447265625E-11,
             4.827707963743664432954501692832429899776E-11, 2.347053101162299692010236811208691545849E-11,
             1.010282787065702684412808295368547533824E-11, 3.66394288496379719816802182478659619201E-12};

    Containers::array<scalar, 100> reference_errors =
            {
                    1.110107329038733392016410827726750207109089860478313819245207759274391600405629671054439209101690556E-14,
                    1.110112821438796836925507695890064610050772182462085513932778654685309740091103307159510537131364804E-14,
                    1.110118651406213810000620120954685825967765366675853390730836093250524079409491336995545340873881934E-14,
                    1.110124843261592611559210104908576824954552466502986395088000646466694454155338889469624771174079529E-14,
                    1.110131423341795596640019597664947503965227184090261952616794902676877035577668742474775138593617001E-14,
                    1.110138420189504460860362969922610546396518886670602271039406682127993535185367900615497370036488064E-14,
                    1.110145864762763735370168011583634797005949399062562975030383829338631435950507451534946963653082911E-14,
                    1.110153790666840285598699972594208311733700227107599961273674585944184753796808003786981046757061523E-14,
                    1.110162234411037962012749302374213056532867069465882613429274536214419058870414968274103041838117660E-14,
                    1.110171235693450413046334349544242548841434294574917448503113794925857637101126481448149547770974502E-14,
                    1.110180837717027965062608300965827293429146112501584078217197929933776208346080823399471363436021076E-14,
                    1.110191087540784010276803593732096030219612660760149710517947718601908123192279927696618406697010414E-14,
                    1.110202036470481408158970448439473353844256800270263567437659165575536509088819226105468600080492712E-14,
                    1.110213740493730396318821476959396031153293790856495999808181507333602255231753889127843162492165248E-14,
                    1.110226260765108607610734133993062684389693389070098608544818269083218070946707089193315072338768005E-14,
                    1.110239664147695303797029403931365728788110403733276146096357561380737965874952913607823956278841626E-14,
                    1.110254023818312680694398827319322581051048270506772865677282877804991683617429582572295996999902151E-14,
                    1.110269419944806886260306741315272640343210448962535317755624541448101887241995942541554755658765486E-14,
                    1.110285940444903600030944225487643023787862243526905968938738419031346516330211750829737423652025152E-14,
                    1.110303681837565289010866302168968766888982113373747816467623127226705622201255337137071576446104052E-14,
                    1.110322750199392319867580198679721561930910352938688982577934367693107884269257970161341924000053582E-14,
                    1.110343262240486822952939911469232897500662339867619373155116059255413158240680719972175534373423180E-14,
                    1.110365346516382770647613623466530988871427916517678077549163698741255980907876289984831853706990959E-14,
                    1.110389144795193199221640450355799475291252158083770625187302007942339376736185554773582440047996018E-14,
                    1.110414813602101596427785173431211677670807784858337530107722307821886084697214206297085502234142547E-14,
                    1.110442525966807838701326645894595765597135250216260898775007107630653938114171833863114258153059619E-14,
                    1.110472473403623992249357187552699171721630720146320096174821856615266373083136851776193397427378625E-14,
                    1.110504868158715118190042936076626689367663731754930187225721867175545049270535203914138973579204714E-14,
                    1.110539945764631445678305724870398891815967888319772672056561835189741876776840204950273878327268404E-14,
                    1.110577967948945700206194785430231746358477689196390612483809137316476657181575891403956891764594776E-14,
                    1.110619225951692441033635159791826339461212396815291067861692592279676072431543703511078367160518434E-14,
                    1.110664044315646933510826534150553164603871102588137351559072384948269251556140561753531776325279476E-14,
                    1.110712785224573641768846911114773704523164419540619355096400069751038877775971761491129229132082576E-14,
                    1.110765853477777719207837132256018904070818843677596000978128962863354378081818875790981832893995212E-14,
                    1.110823702205045630871897787996953325600837877290448567669598420656712296225399866575866233246846393E-14,
                    1.110886839444901133335626396177008563255161178909890679817391714630736943769809529245177422153382616E-14,
                    1.110955835731691523506280249435246599417052694423291459122668784283943161028450208637269739696617544E-14,
                    1.111031332864171646929659950377206764103549618541221297158755757926393519334137088339108656943532918E-14,
                    1.111114054060977832911098031454332352834543476644976129869439105427788644420138781594195185766207127E-14,
                    1.111204815747931254622877418298691001954076595064509781858214199429988410796064317989183201082453660E-14,
                    1.111304541270036235875419056435375266711292894665815716270842412695002639520833532574732688875526817E-14,
                    1.111414276879286147803736261066184253452709865689922137102439213328459503575952468606074582754701709E-14,
                    1.111535210420390546268860694917711726091606947493200918417224042930051834524151804482333047340931527E-14,
                    1.111668693223349532307258977088736996528375067751140068506661444950824810341931607730322716865634843E-14,
                    1.111816265818281056783796829990629873048988445989646175560877678304213250939819717270253770840221044E-14,
                    1.111979688218935150811488045552873501677648637093897796834757234980018447862493978007538662866140209E-14,
                    1.112160975683107766059155765969412011324107766946198666560437386741398403822436682629989678543953627E-14,
                    1.112362441058606871896303911740204362834812503063732029934183934816701792430770156133538333907358182E-14,
                    1.112586745072655871875093993854419164007080577657516930902923175936984925845438384428543528190412210E-14,
                    1.112836956233673013607321472713426024996429707727517820706606820099034442247713734791903001530978124E-14,
                    1.113116622404067368971874712360216837540078236594375592073230687576776382060234507573357027820378333E-14,
                    1.113429856592871745439068567130980198982932147514878344481288269926701696283827945220058956784657507E-14,
                    1.113781440136140430866736795368680643532381080987646005893543980930875500278537758761078991068086353E-14,
                    1.114176947218330092615810413646750263918106980473931398693894133692913416461845205079197617831265622E-14,
                    1.114622895688382822921963582073126199223084464274348117383140368976535800059796609481758747623559342E-14,
                    1.115126930404792615789485316195768543944159675188379149108574584866814093914664734891468747169261519E-14,
                    1.115698046990801286296100784286653930249497743899297009573712504633722265321637767123015979962551588E-14,
                    1.116346866009358438997465829472705289037400478887788052853819323794571029354164948546429526050230343E-14,
                    1.117085970332690711089504810975234561410245116233648971680207633025542615478797756791565711636888065E-14,
                    1.117930322093105872689850400703947745735875157628449211482797447100482556853565532748309576994543740E-14,
                    1.118897780345707932032211738576691697352344181929947212009245709794441718510399201042538712091701463E-14,
                    1.120009746841529153433336962216872799879262684460268558337678949959866884838864496718556549492313277E-14,
                    1.121291975641349684710319021989517991034431268460805883964238136683432876903642994619870705167218498E-14,
                    1.122775593446714988236271687826650638270818480475682672706254180688178398006911993510040004832763909E-14,
                    1.124498392535994198739421265788202840537410013946854833592577056406098522833747834114090451665401648E-14,
                    1.126506478551867434544217280435866220027941761852524829940096977807462146862212196870947674390213809E-14,
                    1.128856383200273576217939358127065707915101912285341470086705141573777997611206229870866790034355290E-14,
                    1.131617790213092418861964011809430138622167995681901926973858678723068210571350502122284372313203483E-14,
                    1.134877076073463980839819182097469801842549461143675283370669092223944746747853691380575016760361482E-14,
                    1.138741941396375996363313178451522917679265441720300081704729773758739403218137734355750254864704704E-14,
                    1.143347513930159305580574270787841992026087858152337158981221116155059935620541622187098037128574217E-14,
                    1.148864453959557324787969808317978042554411577084164721590914174867732888862861038540821420926845306E-14,
                    1.155509808646861042060724039538476141299585114504037640529547627697251801408891575044202115484269228E-14,
                    1.163561675874516095484336169770609822787165545911335710057599761469973295765710620902031449519043092E-14,
                    1.173379200369516704525574007793508483575456638375151332340474998519367473259627997308893032848313773E-14,
                    1.185430113388305021705974390209709043193436337746076697694916711814624429174916188054771480010708097E-14,
                    1.200329065895793247458789873721357120216904989608968111452300370658492673665658984960419458170025984E-14,
                    1.218891593416904496489952660501017908114266364006279135940784602794013806371551454102470157551608912E-14,
                    1.242211014770529243902682929836530339633923936079411954792018579024374321915031913535587360438529754E-14,
                    1.271769449350158258094682523251685850358417154780804455677088522689452975801061530628208452463186181E-14,
                    1.309600357707365066124333601690761950167505633301059493592926695321492025889333144834494669254209956E-14,
                    1.358530155730699629915214210583686789135691349714401479562926537482084891557651357305342966573333580E-14,
                    1.422543324705917833924496469587527749632093978660986899847951782631538237167060451687188887630267708E-14,
                    1.507344092933766440798762549609042515234176241979384671711536267396998596245900570562427641277195886E-14,
                    1.621237550089584689654278347783102441478752469119146110878014276749514425853199947376840586775176829E-14,
                    1.776541742116349703108408507290747087526114063438336026382348234591752985336540199159716133082183588E-14,
                    1.991904657131823120056305661832440542892359420465750834257062698750964680654020087044108822804181369E-14,
                    2.296206346497768641141904037058601043573930333717920624413414902790306123863909162441508206056024293E-14,
                    2.735323995802150168727632332232947995980102207754355582968057477680407924064690048089725470710318115E-14,
                    3.384247581335309087445432582056036539106610916390733167186725447194438419108901310595137861270742763E-14,
                    4.369587328413900059684579604867591781925855320796539901354391269320615156428225267877805220647130673E-14,
                    5.913163900547525211497416123859199723970133531159824145080407817018691643071479836836100322974983973E-14,
                    8.420561216456472407328372969813083244378601691792096218027689846951321157506436678666118914607890538E-14,
                    1.267127349988540048920814865259594732190971247063005436145977988036467211409124131390958177035651724E-13,
                    2.025448311471778421271532074580018249073550544568151383338397312783985212755264139639070951323174709E-13,
                    3.464850036162396618942595267472552108290232364673130945351381654323457239831555342301991669260781726E-13,
                    6.415967735193617870315848459454269730327480852153547826213461856057218285538025784403392716126727859E-13,
                    1.309238752519172754710757127408157993080639994459487734772952832496065897956718950653737834834542919E-12,
                    3.029808631971137343317956594427197702778683514974910192002932351548310010920323057109458556104191752E-12,
                    8.342836459667534796486643669498062694489487216422074472015775435881023919649489389466006760989531840E-12
            };

    Containers::array<scalar, 100> condition_number =
            {8711065557, 9156841067, 9630014301, 10132559174, 10666613245, 11234493101, 11838711367, 12481995523,
             13167308744, 13897873017, 14677194791, 15509093481, 16397733177, 17347657960, 18363831272, 19451679871,
             20617142952, 21866727116, 23207567965, 24647499193, 26195130216, 27859933486, 29652342860, 31583864555,
             33667202508, 35916400195, 38347001349, 40976232344, 43823209530, 46909175306, 50257767364, 53895326324,
             57851247834, 62158386314, 66853518792, 71977878816, 77577772233, 83705288870, 90419126773, 97785548894,
             105879495985, 114785884204, 124601121693, 135434885427, 147412208285, 160675936931, 175389634210,
             191741016038, 209946033005, 230253732138, 252952065909, 278374855358, 306910164446, 339010406487,
             375204584723, 416113173021, 462466276341, 515125883398, 575113248331, 643642731361, 722163813465,
             812413508767, 916482074616, 1036895823935, 1176722062819, 1339702828655, 1530426361518, 1754548349410,
             2019079301474, 2332760441228, 2706559039863, 3154326268935, 3693678163043, 4347185770190, 5143998082096,
             6122077216809, 7331309625500, 8837886000885, 10730542550972, 13129571410612, 16200012799883,
             20171264972867, 25366717369200, 32249337954205, 41493186436943, 54098023059520, 71577360371059,
             96275168127405, 131914941628289, 184583035576277, 264555419885877, 389835557223238, 593341548288001,
             938338892937699, 1553809196876697, 2722059927085785, 5117253254763101,
             static_cast<double>(10535985330080129),
             static_cast<double>(24500516451352466), static_cast<double>(67622242185435717)};


    Polynom<scalar, 10> polynom(coeffs);

    for (indexType i = 0; i < test_points.size(); ++i) {
        scalar compensated_horner_result = compensated_horner(polynom, test_points[i]);
        scalar experimental_relative_error = abs(
                (reference_results[i] - compensated_horner_result) * 1 / abs(reference_results[i]));
        //std::cout << experimental_relative_error << " " << 3 * reference_errors[i] << " " << i << std::endl;
        ASSERT_TRUE(experimental_relative_error < 3 * reference_errors[i]);
    }

}

TEST(POLYNOM_EVAL, TEST_3) {

    /*
     * (x - 1) ^ 5 * (x - 5) ^ 5
     */

    Containers::array<scalar, 11> coeffs = {3125, -18750, 48125, -69000, 60650, -33876, 12130, -2760, 385, -30, 1};
    Containers::array<scalar, 100> test_points = {5.0100, 5.0109, 5.0118, 5.0127, 5.0136, 5.0145, 5.0154, 5.0163,
                                                  5.0172, 5.0181, 5.0190, 5.0199, 5.0208, 5.0217, 5.0226, 5.0235,
                                                  5.0244, 5.0253, 5.0262, 5.0271, 5.0280, 5.0289, 5.0298, 5.0307,
                                                  5.0316, 5.0325, 5.0334, 5.0343, 5.0352, 5.0361, 5.0370, 5.0379,
                                                  5.0388, 5.0397, 5.0406, 5.0415, 5.0424, 5.0433, 5.0442, 5.0451,
                                                  5.0460, 5.0469, 5.0478, 5.0487, 5.0496, 5.0505, 5.0514, 5.0523,
                                                  5.0532, 5.0541, 5.0550, 5.0559, 5.0568, 5.0577, 5.0586, 5.0595,
                                                  5.0604, 5.0613, 5.0622, 5.0631, 5.0640, 5.0649, 5.0658, 5.0667,
                                                  5.0676, 5.0685, 5.0694, 5.0703, 5.0712, 5.0721, 5.0730, 5.0739,
                                                  5.0748, 5.0757, 5.0766, 5.0775, 5.0784, 5.0793, 5.0802, 5.0811,
                                                  5.0820, 5.0829, 5.0838, 5.0847, 5.0856, 5.0865, 5.0874, 5.0883,
                                                  5.0892, 5.0901, 5.0910, 5.0919, 5.0928, 5.0937, 5.0946, 5.0955,
                                                  5.0964, 5.0973, 5.0982, 5.0991};

    Containers::array<scalar, 100> reference_results =
            {1.036864160200100000000000000000000E-7, 1.597135124984735130846657089523401E-7,
             2.377422708756630155164461610394624E-7, 3.437178325659115461797048970931649E-7,
             4.845794380358100096990324746878976E-7, 6.683397970226493372149025400390625E-7,
             9.041649705779415609460459418264576E-7, 0.0000012024547665196913931555702704663849,
             0.0000015749236498799095636458664623079424, 0.0000020346821699366816649107934908699801,
             0.0000025963189054229315818378010000000000, 0.0000032759829295068467446428223401598001,
             0.0000040914667961417634408022311723597824, 0.0000050622900493861442553841879280094449,
             0.0000062097832572971163806415922805605376, 0.0000075571725720038790462758887197265625,
             0.0000091296648175701306726804286447026176, 0.0000109545331072575115419892584326179049,
             0.0000130612029918049058171573630158644224, 0.0000154813391403412976188468329403943201,
             0.0000182489325555527295948554240000000000, 0.0000214003883247267689884648266724201601,
             0.0000249746139083007456316709420452865024, 0.0000290131079675428885580528560368746249,
             0.0000335600497329983530493062988117835776, 0.0000386623889153349979004764556884765625,
             0.0000443699361602266435129393438575051776, 0.0000507354540489144151024658701996463249,
             0.0000578147486460896518435234237355393024, 0.0000656667615967447421615917160761555601,
             0.0000743536627736411276339578490000000000, 0.0000839409434770466030674755442817654201,
             0.0000944975101883969282903904014616756224, 0.0001060957788795396580258122386983927049,
             0.0001188117698792209899080223045145650176, 0.0001327252032984793272608027084462890625,
             0.0001479195950166121526806330906693861376, 0.0001644823532293857107581806189198876449,
             0.0001825048755611599034302791497769165824, 0.0002020826467426037094828171049566817001,
             0.0002233153368556793506238965760000000000, 0.0002463069001475763403175536669460675801,
             0.0002711656744152794682125073985955431424, 0.0002980044809624576925190969140998276849,
             0.0003269407251303638350820395281941528576, 0.0003580964974044378991681606357431640625,
             0.0003915986750983097581380759237125374976, 0.0004275790246168998942002119985422378649,
             0.0004661743043003198003557987324997402624, 0.0005075263678502765954358206322583407401,
             0.0005517822683406893418066406250000000000, 0.0005990943628142274978813731261074386401,
             0.0006496204174664848830203493823098650624, 0.0007035237134195054807374521593042035649,
             0.0007609731530863803573509641477124350976, 0.0008221433671286379273291402800791015625,
             0.0008872148220081527535832437687845912576, 0.0009563739281353010308555443745729529849,
             0.0010298131486150938631380304821911143424, 0.0011077311085930224117405992777329406801,
             0.0011903327052023519592065269760000000000, 0.0012778292181146049057493489198546306001,
             0.0013704384206949756892601627514733773824, 0.0014683846917644235972090720219335043449,
             0.0015718991279701924189402778450055397376, 0.0016812196567665088699384677977041015625,
             0.0017965911500072147056259095083910194176, 0.0019182655381520904311362965373524490049,
             0.0020465019250886315053041815291087028224, 0.0021815667035710409318090314845853295201,
             0.0023237336712782051280218176490000000000, 0.0024732841474924229626208732222254354601,
             0.0026305070904006608564737811567973761024, 0.0027956992150201098476245569989718740249,
             0.0029691651117498235304816333346214347776, 0.0031512173655502187914733982086181640625,
             0.0033421766757522242785255551780075339776, 0.0035423719764978645597196227200521019249,
             0.0037521405578140709474157408304439297024, 0.0039718281873215129879668680989709952601,
             0.0042017892325802476439166986240000000000, 0.0044423867840739862252614701076290852201,
             0.0046939927788347821589675376445925172224, 0.0049569881247099457214734173642888166049,
             0.0052317628252729948973682254909775282176, 0.0055187161053804545688293168365712890625,
             0.0058182565373763192847217275178624869376, 0.0061308021679459979055120150797910477449,
             0.0064567806456215614703305304928051789824, 0.0067966293489401186856303159598136659001,
             0.0071507955152571464909389654010000000000, 0.0075197363702166062161831761671886518801,
             0.0079039192578796789069856262488456167424, 0.0083038217715139564591914962824823960849,
             0.0087199318850449282716786852935382680576, 0.0091527480851716061972428086390634765625,
             0.0096027795041481336450266813090392702976, 0.0100705460532332277645854448962729824649,
             0.0105565785568093067212440574358209946624, 0.0110614188871731571549147972301429094401};

    Containers::array<scalar, 100> reference_errors =
            {
                    9.475117227043197436694286534815402689184895658746756545895823050886671410763756219239145444597339536E-13,
                    6.197497206586332132173044973108586548975006518604066845831783582341238191825088333686868946185757062E-13,
                    4.204765843830031818402187320517649398222333133332108449872751108553699146247856013069808017457477025E-13,
                    2.945964278042790175496574839435920670712767443381609705627007992495663117596464314520712807304459124E-13,
                    2.124283146157925186951104439546190504217428487362518384775347863492035817710278800292764682592823162E-13,
                    1.572479189541830080090403481291671665652194857658976510262445816942112364984302056979320914323537316E-13,
                    1.192589176768159606935449652563727068355290092736435761190080377985944155515735998800835798725088615E-13,
                    9.252565258280924070138073919700940455242705480188054673820448904432577457539174424697656476372368761E-14,
                    7.334298489234018546190843963561220015015477438310615379776774839860910896278093892129401554107136974E-14,
                    5.933621144880673425434497326809810792600217143466428615189180976896026900310062579879482677999015823E-14,
                    4.894700534318058218248238323162547186898677103332933906340755669910034769062409698992338592851011970E-14,
                    4.113085165570850554538374975620554274005889982174485104057608682968314218582866503598756589650223816E-14,
                    3.517409129689295832516467606356776841264162407673759916276828071419495704983103860417380750971567470E-14,
                    3.058056276123760990342436569573129103975803685207537394872879028359163502751713041870776890445747878E-14,
                    2.699979793385387472080417843258485560489018936148367160148956992259784250357746657790971477000201559E-14,
                    2.418061504616450501700606609869289090041701384657406588059481225186335787418264067101282914579767618E-14,
                    2.194056861481599743162820509527491375808264117262260499313781755838305336387772839523337875341849913E-14,
                    2.014549523499775944703852092857201029691471177897017337010049550119254009986873854267051705102329770E-14,
                    1.869560377769204308726475424802932911914070078768744453651121660926465507705166245761417376735612158E-14,
                    1.751587878099675307798686343081213803236421942404177503069596974242949911715039045265494490370057752E-14,
                    1.654937049653218239827248880694273646418768253416400241038368809260958414991792456374578176036766969E-14,
                    1.575244459601306271400845236222035388525265114121550158246940439983134608652270637080164167817365192E-14,
                    1.509138000031896177932846681666803081664163502892725501263501894883560709031522018721401886318253588E-14,
                    1.453990568879890367826834695252447117429053530469401036953719805258649020175067038761240250292054370E-14,
                    1.407739913864646958233912089574360940403942061549429095623801136916435683818952704679201979832237542E-14,
                    1.368755605791606849300788690260626076334464328469668353022534472991847594424898704488841787791670917E-14,
                    1.335739927495118421237809939707445012512365338075259661858508870559320747141560600691181467671748334E-14,
                    1.307653405034256300487940385969779858429560929780339397008702323002984571698602725351506513191191352E-14,
                    1.283658406257170745622591427575414391710871891583985913115712185285481976776168722529364037784685110E-14,
                    1.263076099952732343018285090317748152791577883095627841597744470967347096951963189927939850507807548E-14,
                    1.245353375294673842012584348364155942014093605725337418933485707680920734812704356218419753905474244E-14,
                    1.230037243843909791249739823975873442466055409123898303642565524718881302623837282975325152729185213E-14,
                    1.216754903804805786496733576299530654957864097182541980621977641314474786670596889438456431550746431E-14,
                    1.205198118800092217279231913924898539050263451599953597528128779012004759124059195220657247590914024E-14,
                    1.195110905923198639917320481301855239915020347590092638117995124263454032474794281517589630984860490E-14,
                    1.186279777998785740668895353167254941185740293735838716070391930426857091472803814729062833332102108E-14,
                    1.178525969084884982384769805149571025541938876382856932427134142276994271658862864671850365582453557E-14,
                    1.171699208697778743871214917482403551654426281067858006087777407684062518684759257761058051512917825E-14,
                    1.165672712057036550802688501138142794845058161746176216294056916001087755251677861003035102035647733E-14,
                    1.160339130116505218476479877172810714735521415364359873908215055042930731966845210486677118073708305E-14,
                    1.155607260935086375326528654463027070968843731339643496508222870167094633698322751583833015401040407E-14,
                    1.151399367872107127355035342654698208966819544872716166988689796871929808569944966883725077874908182E-14,
                    1.147648983679245138142888024853097404748073054042778151323353202333854813719243994877189927988258897E-14,
                    1.144299105380267285420530581531657862048735268541591839301097139244754766889478807430050569367368057E-14,
                    1.141300704781993449389872768393969383823847524145043175999948219466778367151376774850682504962686594E-14,
                    1.138611494955915025199678203345516769075490767242357170058451643300621401531037492778052885168202780E-14,
                    1.136194905123385596931148064180496289738524410946150332436171297236352234292373298669775090534575422E-14,
                    1.134019225859410488729982572558710400155417924216899582164616251951188909387495234068863065573695392E-14,
                    1.132056893998082311367618625962218511649170636897061947901815416795721387459321367131845517547168716E-14,
                    1.130283892529920942498255553243234932997629463632134934742996672437745523700131319662992685502243811E-14,
                    1.128679245473496239993592963733381365530753524711218861381799878561979674058746120347186661410741506E-14,
                    1.127224591445695549619793866674987410811096168217088802900811558659041845879578929261161159278880268E-14,
                    1.125903822650853288010341222554854928452855059872794997318193902087688168242340000109517431076288269E-14,
                    1.124702778416473958402443230481238344324565551667623205983118889967666990430595212316441863753808140E-14,
                    1.123608984345023013581803194113861222070566574490757232851218418929451617449597281227540226608291267E-14,
                    1.122611429722845742185543518136119219958517890685207923939864320756921587905211121059081611125586342E-14,
                    1.121700377103592042718869382173628163495355285106557957386772157597451366355357869835711692175411130E-14,
                    1.120867199023462312620806236969142711921557892207532195269226630610242326148073752205682903952229752E-14,
                    1.120104237655628516017338509789145416784464999215888938233489925361060318074600622770283717799945845E-14,
                    1.119404683908149704815417882331701422254550576117161005634655591087418909584266243082642521190352809E-14,
                    1.118762473042871546994113510039060433216278887162211092350838669221494003740073866170268165135538525E-14,
                    1.118172194365534406872121933489748310109229604955185105072295834695178899853971908234045630796269859E-14,
                    1.117629012928314166113064787445341523998218819490323897232498954462178720816271245417931400426966997E-14,
                    1.117128601510302920546206410163442496381803536592678042279364777525997180993050232818890086701289744E-14,
                    1.116667081411103262202457480000441668180109895328672058882306543513522307932766580156523872522053526E-14,
                    1.116240970817539172378093296759721774289340862316637081062443004847067733671732510828135260718059790E-14,
                    1.115847139691405459612570364054073703493028390165837585066488513638610761234365199872984831286118795E-14,
                    1.115482770283630306634978659015748199506183498314334797540824225510330826631257556775017320525394107E-14,
                    1.115145322512465431243599988100399935200281746635990789174449928133713715176120531187616581290675997E-14,
                    1.114832503554640415152897096040421874364281676573127295301600682889735745881466769416068855819475010E-14,
                    1.114542241092342314769664314929943744149509277715810809911135254648312003503351092038280006175297894E-14,
                    1.114272659738301912125590039029559497859383881426448533171173862644313098538875779465995627584615506E-14,
                    1.114022060228567637236675414013035588883772034268407744269202290852325195236660311966274624829935931E-14,
                    1.113788901029696177244401113932939955225839710008799874612778750442317738521208960091928462146454117E-14,
                    1.113571782055715232412563174897574039933937949434180620126061316951295533527100727508017589641821840E-14,
                    1.113369430231671656306308583774894380391966382632410976112913720403441218346244346283237463208896280E-14,
                    1.113180686675992663253183858699831253183712046349672559131740119233942668404077640367345366766554950E-14,
                    1.113004495304197066694243474002408577745384370013548056937445270337157331482016121197948708582177388E-14,
                    1.112839892682481464768524233812237765756880687677205903861889861337829155952305406026821790712419472E-14,
                    1.112685998982029208364609988030487403564022725156939072586144169569319446395230383297889085411012914E-14,
                    1.112542009904098521221790874564877983154019542254590224706837513674013920656852309248129057544475216E-14,
                    1.112407189462503242611400817649684735744403335804669669640043977365198693561679685185366804314184689E-14,
                    1.112280863524395325019508618863844517208836173783264018254977305350910832935040506068268710922442222E-14,
                    1.112162414022621615656502865376797736070569450775554560140727446272787249592515121542575348713787146E-14,
                    1.112051273763636947539039025218268163022466000109622908831932562431803817988320000927614478770593758E-14,
                    1.111946921764247001287714763203435105991077211870769475599491304376783153742107442468134018988893164E-14,
                    1.111848879058527943050981012890773681580527857719570855344177942820617369326558351692522013771579908E-14,
                    1.111756704923295696277934058089859127211115666123890461140916643723045169516328666530395678879901954E-14,
                    1.111669993476620832702190437201783956396390749246680428422899107089085146310001905854791230645949757E-14,
                    1.111588370609229157121586107785685469138179662556244812889947722555664032992869942691238809238679011E-14,
                    1.111511491213298816541603305895386533300744062105299660460301552902309509184776472330389691836665721E-14,
                    1.111439036677252672582086430972672436077625712358508358041117543848465143116686142666855103681775512E-14,
                    1.111370712618727317896486495220727659081037342172462345910395451384142213976749969041477218223372637E-14,
                    1.111306246831044113983401175608281788842436167826480765332317980756855179172278205275879371769649502E-14,
                    1.111245387421270276635709109124197939555366728091279063560241661433146472270538036975555486076814825E-14,
                    1.111187901120388689017405565043322878641690919460997253703393447077239635296162202838098077223241421E-14,
                    1.111133571748236353101297351475273038747105083511695909563464743897265694960856670491785709571696532E-14,
                    1.111082198817759974182380367271855382730621580289686324750267508493655683462025597898317135199361576E-14,
                    1.111033596264804924854981998533357651766678577329350249060834873056852472987715505717846033465199858E-14,
                    1.110987591291128314564763263435670693578577430951546975977323070106799379614801714313052038745390298E-14
            };

    Containers::array<scalar, 100> condition_numbers = {7600127608995371, 4939937672742741, 3322592195300731,
                                                        2300920605505064, 1634025765893941, 1186169295951489,
                                                        877842039419007, 660868862777446, 505178028506940,
                                                        391495913065552, 307174785676329, 243737128931973,
                                                        195390725565237, 158108617492391, 129046326871632,
                                                        106165206120968, 87984486769060, 73415268525263, 61647624200081,
                                                        52072711476314, 44228313420438, 37760284035492, 32394935478605,
                                                        27919046252730, 24165239336470, 21001185438812, 18321558923392,
                                                        16041993753287, 14094505823972, 12423999671514, 10985583580445,
                                                        9742491992850, 8664467478679, 7726492882078, 6907792056099,
                                                        6191037902669, 5561721376908, 5007646189252, 4518522202502,
                                                        4085636727254, 3701587609373, 3360065568712, 3055675974291,
                                                        2783792336682, 2540435417741, 2322173115486, 2126037263483,
                                                        1949454253665, 1790186997652, 1646286221079, 1516049466236,
                                                        1397986482079, 1290789923776, 1193310479382, 1104535698808,
                                                        1023571927834, 949628853469, 882006251396, 820082595213,
                                                        763305243742, 711181969229, 663273627589, 619187803612,
                                                        578573290341, 541115283751, 506531192073, 474566974385,
                                                        444993935851, 417605917739, 392216829367, 368658476774,
                                                        346778649322, 326439430936, 307515707304, 289893844307,
                                                        273470516327, 258151665935, 243851578946, 230492060910,
                                                        218001702948, 206315226369, 195372896883, 185120000356,
                                                        175506373072, 166485980329, 158016537963, 150059172025,
                                                        142578112433, 135540416899, 128915721875, 122676017636,
                                                        116795444951, 111250111088, 106017923142, 101078436918,
                                                        96412719778, 92003226056, 87833683772, 83888991543,
                                                        80155124675};

    Polynom<scalar, 10> polynom(coeffs);

    for (indexType i = 0; i < test_points.size(); ++i) {
        scalar compensated_horner_result = compensated_horner(polynom, test_points[i]);
        scalar experimental_relative_error = abs(
                (reference_results[i] - compensated_horner_result) * 1 / abs(reference_results[i]));
        ASSERT_TRUE(experimental_relative_error < 5 * reference_errors[i]);
    }

}

TEST(POLYNOM_EVAL, TEST_4) {

    /* Theoretical error does not work!!!
     * (x - 9) * (x - 6) ^ 9
     */

    Containers::array<scalar, 11> coeffs = {90699264, -146126592, 105815808, -45349632, 12737088, -2449440, 326592,
                                            -29808, 1782, -63, 1};
    Containers::array<scalar, 100> test_points = {9.0000000100, 9.0000000199, 9.0000000298, 9.0000000397, 9.0000000496,
                                                  9.0000000595, 9.0000000694, 9.0000000793, 9.0000000892, 9.0000000991,
                                                  9.0000001090, 9.0000001189, 9.0000001288, 9.0000001387, 9.0000001486,
                                                  9.0000001585, 9.0000001684, 9.0000001783, 9.0000001882, 9.0000001981,
                                                  9.0000002080, 9.0000002179, 9.0000002278, 9.0000002377, 9.0000002476,
                                                  9.0000002575, 9.0000002674, 9.0000002773, 9.0000002872, 9.0000002971,
                                                  9.0000003070, 9.0000003169, 9.0000003268, 9.0000003367, 9.0000003466,
                                                  9.0000003565, 9.0000003664, 9.0000003763, 9.0000003862, 9.0000003961,
                                                  9.0000004060, 9.0000004159, 9.0000004258, 9.0000004357, 9.0000004456,
                                                  9.0000004555, 9.0000004654, 9.0000004753, 9.0000004852, 9.0000004951,
                                                  9.0000005050, 9.0000005149, 9.0000005248, 9.0000005347, 9.0000005446,
                                                  9.0000005545, 9.0000005644, 9.0000005743, 9.0000005842, 9.0000005941,
                                                  9.0000006040, 9.0000006139, 9.0000006238, 9.0000006337, 9.0000006436,
                                                  9.0000006535, 9.0000006634, 9.0000006733, 9.0000006832, 9.0000006931,
                                                  9.0000007030, 9.0000007129, 9.0000007228, 9.0000007327, 9.0000007426,
                                                  9.0000007525, 9.0000007624, 9.0000007723, 9.0000007822, 9.0000007921,
                                                  9.0000008020, 9.0000008119, 9.0000008218, 9.0000008317, 9.0000008416,
                                                  9.0000008515, 9.0000008614, 9.0000008713, 9.0000008812, 9.0000008911,
                                                  9.0000009010, 9.0000009109, 9.0000009208, 9.0000009307, 9.0000009406,
                                                  9.0000009505, 9.0000009604, 9.0000009703, 9.0000009802, 9.0000009901};

    Containers::array<scalar, 100> reference_results =
            {0.00019683000590490007873200061236000306180001020600002268000003240000002700000001000000000000,
             0.00039169172338399511045533007126966679613286770561995430807248217768704632116019427290454250,
             0.00058655345243787604353157363563140696290439000557327461043462962295342914326959375300386903,
             0.00078141519306654333632225194988207995213930828588725588804153581179269931820818086633833050,
             0.00097627694526999744718889977599333831655880739016144888444454166363392424524496584249760960,
             0.00117113870904823883449306599347198018056498380737831652553237458364472589276368327911375664,
             0.00136600048440126795659631359936029864923222195155255732572836733214706874787271696599304153,
             0.00156086227132908527186021970823643121730548873932566024621673793992569417275633404426981958,
             0.00175572406983169123864637555221470917820554646561223279197632367402200623874674255839467297,
             0.00195058587990908631531638648094600703304108397740464413560560625336957262875593609310849217,
             0.00214544770156127096023187196161809189962776614584252505712830971734118567872096221172340100,
             0.00234030953478824563175446557895597292151420163665366649017429656294163310190436456395000135,
             0.00253517137959001078824581503522225067701482897907285846613593198799495543907131854909781756,
             0.00273003323596656688806758215021746658824972093334521124910553030824001783555462404165155207,
             0.00292489510391791438958144286128045233019130715692050045560494185576369739583645264890932155,
             0.00311975698344405375114908722328867923971801516944507795432378291466688414033978801247992329,
             0.00331461887454498543113221940865860772467482961665789034228825550727481352045106252489388219,
             0.00350948077722070988789255770734603667294076983329714679508794811056999156920679924730704708,
             0.00370434269147122757979183452684645286150328570512417808999345265784314010938933052218533850,
             0.00389920461729653896519179639219538036553957183017102860200307746482517904080810151387439545,
             0.00409406655469664450245420394596872996750479997931832307406238001278127561711189441799782400,
             0.00428892850367154464994083194828314856622726985630994996390568782321642683240174409561201255,
             0.00448379046422123986601346927679636858601047815731110317117421996996090060201257514789354516,
             0.00467865243634573060903391892670755738574210593011622394967086609447314437292189068976661221,
             0.00487351442004501733736399801075766666800992423311338481081712411921747617014440104421198469,
             0.00506837641531910050936553775922978188822461809411165722558314219194400290900051300095558167,
             0.00526323842216798058340038351994947166374952876913800493336725474061876411212232390173291730,
             0.00545810044059165801783039475828513718303731430131024466750684687462307599730139636728526153,
             0.00565296247059013327101744505714836161477352837989261610830782573266245128060634570658368482,
             0.00584782451216340680132342211699425951702711749964050287568542175159729400142336968441777872,
             0.00604268656531147906711022775582182624640783642054084637471448721312981625501750610734624900,
             0.00623754863003435052673977790917428736723058192805479430859290381695429494669483435800626282,
             0.00643241070633202163857400263013944806068664489396912567472715542960088159248425930183689387,
             0.00662727279420449286097484608935004253402188063796299406085456656777669681727014664630874713,
             0.00682213489365176465230426657498408342972179758999653105932215159353188357531213458868635448,
             0.00701699700467383747092423649276521123470356425362785161884746402605265927290414418210171177,
             0.00721185912727071177519674236596304368951493447036500315429227981130819694136916701920587434,
             0.00740672126144238802348378483539352519754009098515940023618539283615337942347804031581033869,
             0.00760158340718886667414737865941927623421240731314728668293624542781510823053734301165050984,
             0.00779644556451014818554955271394994275623412790774576687988656104296591033363197882961938561,
             0.00799130773340623301605234999244254561080296663020994815055259082281507170365017008645017600,
             0.00818616991387712162401782760590182994484562352075773600661603017182443594358068616479141737,
             0.00838103210592281446780805678288061461425821987136882410442710600778333989597238967683673262,
             0.00857589430954331200578512286948014159315365160036442073698877983005491569120281821106322945,
             0.00877075652473861469631112532935042538311586092887425369159645626083417036113374689411711411,
             0.00896561875150872299774817774369060242246102635929739530451303123123685991065571355738192734,
             0.00916048098985363736845840781124928049550567095586344954526455850996720464935855081019337819,
             0.00935534323977335826680395734832488814184168892740064296434725780719194666992927452694455796,
             0.00955020550126788615114698228876602406561829051241736133934203223007812865169044289137585872,
             0.00974506777433722147984965268397180654483086516660367385563810741923227569976954094608469419,
             0.00993993005898136471127415270289222284061676305285938665917284925700938873555127930664062500,
             0.01013479235520031630378268063202847860655799483395516761980026160934130906512813905557122041,
             0.01032965466299407671573744887543334729799084976793328414510611014236558920224826456981244375,
             0.01052451698236264640550068395471151958132243210635449588569306284371800484358211889391402508,
             0.01071937931330602583143462650901995274335411579549764417416468247588426711980838898827468009,
             0.01091424165582421545190153129506822010061191748061848004124255079548934290887367749487364590,
             0.01110910400991721572526366718711886040868378781337427265365624898783606413062776031028332972,
             0.01130396637558502710988331717698772727156382106252074001965136339038840457769484197511240264,
             0.01149882875282765006412277837404433855100338302798784380916613021222892500872952041835891531,
             0.01169369114164508504634436200521222577586915725844099013693277759880443396994229567236846240,
             0.01188855354203733251491039341496928355150810957243417815796506804250888315178164053711257600,
             0.01208341595400439292818321206534811896911937088326163832609898879983791206274611155924688121,
             0.01227827837754626674452517153593640101513303832761450216745898264498527744428893283979659856,
             0.01247314081266295442229863952387720998059589469814904542192755596783764819248714983226822362,
             0.01266800325935445641986599784386938687056404618007304640690154591136091662639604217842015230,
             0.01286286571762077319558964242816788281350247839185680145882377293935827178261522048976114868,
             0.01305772818746190520783198332658410847069153073017533930918424993051780005337392855700336644,
             0.01325259066887785291495544470648628344564028901918837625289056360855532295421774649509563448,
             0.01344745316186861677532246485279978569350689646426455396811248884109655113996535854602239794,
             0.01364231566643419724729549616800750093052578291025650184791134107173142801682052840319356537,
             0.01383717818257459478923700517215017204344181240443326570517001689041275545718913172789004900,
             0.01403204071028980985950947250282674849895134906417664471354511749706083824468224673778849438,
             0.01422690324957984291647539291519473575315024124954797844836799457187595299280211609798607648,
             0.01442176580044469441849727528197054466098872404083192589262700283345094142472648357410178789,
             0.01461662836288436482393764259342984088573324002116377827436868834231714710624659375286385944,
             0.01481149093689885459115903195740789430843517836434684760306108639304825902209323933602333069,
             0.01500635352248816417852399459929992843740653222796647277366774763248839481042186480638082576,
             0.01520121611965229404439509586206146981770247445190718510838655584506295105394010438809678495,
             0.01539607872839124464713491520620869744061085156237957520721284565847336780186746291519425309,
             0.01559094134870501644510604620981879215314859608156340297969177324436999949743535722017732788,
             0.01578580398059360989667109656853028606756505714297349273143033791884075474378463969689702400,
             0.01598066662405702546019268809554341197085224941265495518014489738674706288971524151611910739,
             0.01617552927909526359403345672162045273426202031631427827722546422208304628860691731660489803,
             0.01637039194570832475655605249508609072283013557249282871200351603362852331177946279682562418,
             0.01656525462389620940612313958182775720490728303188930597711549663121163881441342823061313527,
             0.01676011731365891800109739626529598176169699482293769087455963038289251579072648126202414067,
             0.01695498001499645099984151494650474169680048780374723034324911683732534444821439813838113583,
             0.01714984272790880886071820214403181144576842232051100049007021757845277291123740055377030167,
             0.01734470545239599204209017849401911198565957927248958970765919218153333726488042223614441659,
             0.01753956818845800100232017875017306024460645548367644376331748505029996770365810205751669915,
             0.01773443093609483619977095178376491851138777738125141474469000983479533218909007551645900100,
             0.01792929369530649809280526058363114384500793298092905574903682305812792927825769067315439191,
             0.01812415646609298713978588225617373748428332217930820320413392351804141769498782474751941825,
             0.01831901924845430379907560802536059425743562535332938871004435897578867180911124035832467080,
             0.01851388204239044852903724323272585199169199026694662229220626660035147950013011252372326474,
             0.01870874484790142178803360733737024092289213728512008895748991860054665194242019579906491113,
             0.01890360766498722403442753391596143310510238289523630044608128945100959369260580203424794269,
             0.01909847049364785572658187066273439182023658153606224407325510610044708611879853992806244426,
             0.01929333333388331732285947938949172098768398573434007055630578754190216771880184457892402796,
             0.01948819618569360928162323602560401457394402454912886272311012512507555126297091531800928113};

    Containers::array<scalar, 100> reference_errors =
            {4.442601460948009210163422861112003828032747655854607503421480633512231138634018145277658270157504970E-13,
             2.287684100709317126513499236454724293879831102744379485340543087109022948277198079414047753970659736E-13,
             1.564557469756736809751678851492444942041591300359795355761918613053511035236900700413771194250952084E-13,
             1.202083415450532252911273583686690146327474237315208615972800186043224260459516174953034337855867038E-13,
             9.843066650810792610393221180101402321709164314281546502624198940797165129971818492678060727665821089E-14,
             8.390001610530581454036575608659219034103299010610861070029163960292129087361829418389563729001427055E-14,
             7.351499794998907111308134363295809262633074930982702136470216507886306368918553030036153854834118503E-14,
             6.572296036813101948352081669210273551915243466900457025480913840952230462334450847067698014661213548E-14,
             5.966054547821009971454869741314858437838551989451789974797814563403080986933153571233069715235381111E-14,
             5.480939007184555684895448194014969297418411567186124866127709523985656889114829694397872183945840732E-14,
             5.083945372094909369379863846026497296987644849495528288069783492297980143224877863500707610228834155E-14,
             4.753061694740967604050164743812580985277642496748903234150691517905980579698471900628282186972162065E-14,
             4.473043675862245721666216459926084977889110515176353303807309947870215609830538294017221767592021077E-14,
             4.232999390031822089037699443107354533200723927655939195330639403651786713983733724734523987077154956E-14,
             4.024939470684861860823127616054873077073379182300298501252262192502592277439443182927399985994981820E-14,
             3.842870632745283881747405113842121260882947554177320926874781909738304059016157071371116202268525610E-14,
             3.682208938458935819272335099163643691482092967574676658588575629661204278855062946449946261512071570E-14,
             3.539388531591936975007295579120003133064882986179543673956103920869932708681647257862026864186496392E-14,
             3.411593863598300782635355479616835242555534275442804404434962606298725695949769398732391904871650530E-14,
             3.296572211385958232761090392558936867429810866646218827229251488792868148500095805350916659134132199E-14,
             3.192499735682291915854743249086042589254734649797495675941656059301738378706234872945678181423431752E-14,
             3.097884052171984327927531647282189488034818111609464791401012314730068339333434164114717459079298468E-14,
             3.011492207702521183418925086531542543072053771661119572174976827638567947790896301806514758810962448E-14,
             2.932296654863245856457905089039823614763710214998823088429039731446194274013813732376323229358519993E-14,
             2.859434187428727902047816390748418610896133440348504337809398818516283126050179945643539856553597243E-14,
             2.792174348558107926150712653645385757102230539970527599265044567460466420744871257146160034857476720E-14,
             2.729894856769157918438081627174168088466393431490678161934224082258442558964601985687610331893836798E-14,
             2.672062295876066129702972853502105717540051983207643488592207349126880786939322215582417844849407378E-14,
             2.618216798721426609027416508955558030211949092180885511346153692567428385075314688126298525315420698E-14,
             2.567959793130779469634646421889740595699269551761034226274272780900443789774872772635540406513028587E-14,
             2.520944118845328054442879939869740211869475582802650313307723035070446412499526740820628299430907391E-14,
             2.476865996945020886617852848569572570656440155750305991014890701869775213189591478367838216194670036E-14,
             2.435458458929739287619783378239771057730808223220012944451234275093943386192573139959693927862574808E-14,
             2.396485935029999267563999227744994041328601324325395680179301152413073290253238529233430427033812658E-14,
             2.359739769968156323003892213449197443952242520754637774955087805817941242347235307770736493179997069E-14,
             2.325034485883100936008943027094413903807792046112005832833588847021656635603818099462320405760193091E-14,
             2.292204651101769267988284556403332476118351631326256671427755175166151387241791878840284037554495510E-14,
             2.261102243183766435993351941680301841591292331394503262726489431052164175799514372280928934448340204E-14,
             2.231594417546386933991072732458683616949300755992488901023540352784303638422836225039120015233260343E-14,
             2.203561610711381549911791971427042356586029830212460933104193337888195346566285973005457216669059223E-14,
             2.176895921057000255917279174943474258413016415631002002231646675950226517158875982157360809895319416E-14,
             2.151499720835552416096194763796266417609203148232747929001491979449112908274277466300335455120885013E-14,
             2.127284461817451079793397015366192624117004201437730683868232454869279679833561262377877780070266015E-14,
             2.104169643764598034581753415700582466607808033654698434675497096530736694365834166348625722747447143E-14,
             2.082081920409785304147494214654716054096602975325290960690670292623145848404032070768041297617243543E-14,
             2.060954322021878316923337657925866714584245495685818404805236134345978635945268205804220845376511897E-14,
             2.040725577196671871849230950108353284805549839181258891738385492739744648567549890300758098222790050E-14,
             2.021339519406052764418830722891722831260700775867896662941243051286537801020769328623178809673017233E-14,
             2.002744566199635083815923858141513639941501642640106066584088782060590605892437940335604309942043961E-14,
             1.984893260889576409566292873914784270307795817769438684454953248542055567140259567628877926463142641E-14,
             1.967741868144150281296272787843320974004087333848008389041913516165136945772862169327181365557670598E-14,
             1.951250016234536371533338903637912270943092421151288200344154463033938350326643483950816352422459460E-14,
             1.935380379774256740320042702550028422837151262140468981034665068968187019023386659783677131839871956E-14,
             1.920098397703193138034291868080510892277113361570488708692950412192471523060085075010544588711679061E-14,
             1.905372022031335068790745563226462033413709529703781915632062485188726136334349210416094808710665389E-14,
             1.891171493497985680774503883619090152113272836991829675717970302239197778071061091428262107985636623E-14,
             1.877469140841604031688508945111611269562698009177879025643920993169429312191291071128851398021911783E-14,
             1.864239200831220346421778942631783717568402933513523682374505338040656886351966806712771023925431911E-14,
             1.851457656596608436125562265357892656894046904127162815003062418860258164390731650023930714853828990E-14,
             1.839102092122719619236767231417620506405755241246870826450210928822851760559204323714363229721804727E-14,
             1.827151561053769995301405520863220512132532086085441878461295192677660915635957261231350151653700383E-14,
             1.815586468191638218773418342123273945578687335594501598866551657088821385710422643884575201081623922E-14,
             1.804388462278320939110953264874398604409206572661705884954091553761024311166174417647882052751134346E-14,
             1.793540338828446859869455249105825413276022095610572395870137403466610582272839889599870826778891689E-14,
             1.783025951929703577300460584180190297967651724781576698995098977827027554216466972883603847904294174E-14,
             1.772830134060180479833683314535166094257401427584365155176856435557261536157703450853483837488507510E-14,
             1.762938623085165720171046293533003809501668583516338670026098542747510510160970770606795591670867694E-14,
             1.753337995694445578376723755803074402671426277756445090825774830870510116907149937864327521620339318E-14,
             1.744015606626817551302739321672895661377457350968457208728907346405148689821263835905759436526183520E-14,
             1.734959533103179293245439024736941510730390206316019767693355975677128955911147719779712936863739155E-14,
             1.726158523954744892199411710922482228393784223227480253729119151574314110821440104680839057982164739E-14,
             1.717601952989981798644046733523287040372026122071311378632454237253962123505238722295867382370875206E-14,
             1.709279776193871974626271051823528800099553053264394175697922256802397415227482938369620853852448827E-14,
             1.701182492397029584053174983115628973333406038487247605566454400074108166930034068905190527921160346E-14,
             1.693301107090865557744425229603828461851846334163743838433629523811430502707657026715661817989285505E-14,
             1.685627099099070065243331282320287188710848457387463525732777514627003084498925369681009015442080712E-14,
             1.678152389845781688063408487695149691679717444195593247441788313528388682057732324920330270384831060E-14,
             1.670869314987437482626970317604194691492094344720101384165238245475160290421012787893758853930722693E-14,
             1.663770598198890629833032348901488004057445321087330975937095822829854450135453273687906587056875481E-14,
             1.656849326925321054724530096778270040495600294700947935135470831932619852341160138075445409381017508E-14,
             1.650098929930076855621580814080050392580204816508909765567450498835615487877603183625514137026561982E-14,
             1.643513156485154259070097241751383883417618370806502277455430262790772875478973566651698500122873830E-14,
             1.637086057065797178922857362229758692340552811962096118566536034885786990980419260717932612634378774E-14,
             1.630811965423888149943340122117352756080799267344997288530710544147754110565011640014511375808199694E-14,
             1.624685481926596602835336057506423332691883774150490097558901075199166468984218234660077615647549068E-14,
             1.618701458057310512687990836340130341047758448408537092865628236989377967319924373831608850922034194E-14,
             1.612854981985345224205576469201229555964638399340371557774585190444857828082153170059850891312473530E-14,
             1.607141365119422844802924852338974943928557555420598815234099993025019117719566697271033676917678628E-14,
             1.601556129567555773027837306547362352951139633895610032797523333009929610288894742151164770600380272E-14,
             1.596094996432844174252834115359535613852332644015830155865765469496519268059135899853080805844784085E-14,
             1.590753874880893467403430231312394947407522492365408485176399264982980745589078854217150766000145162E-14,
             1.585528851920148049789759783449411827324552672641582881901104047534239477854764771549524920355578991E-14,
             1.580416182841486725614353391355082415265884084570552521721205625901772651241093009140757186828650877E-14,
             1.575412282267991156449011887856355816929832651510562899983330015308318472639897298076728048746244371E-14,
             1.570513715769931996212715232954697211179621615916109285033490039664706073224338116914909696102130506E-14,
             1.565717192003763257167219182111055187620339457244241754428990998795057681835420244834974250721319144E-14,
             1.561019555337313817374398682877219067670200912899350758527426738115256065405819176911877458325919182E-14,
             1.556417778926451281505166869012590401792136862248828632913450210124431282900489159295316042011945164E-14,
             1.551908958211299164100903962527361090949464562986477366474252467335774143557978525835601185553669386E-14,
             1.547490304802641628954743890318798486735967733412293230591966235231783346618224191739581404274331164E-14};

    Polynom<scalar, 10> polynom(coeffs);

    for (indexType i = 0; i < test_points.size(); ++i) {
        scalar compensated_horner_result = compensated_horner(polynom, test_points[i]);
        scalar experimental_relative_error = abs(
                (reference_results[i] - compensated_horner_result) * 1 / abs(reference_results[i]));
        std::cout << experimental_relative_error << " " << reference_errors[i] << " " << i << std::endl;
        ASSERT_TRUE(experimental_relative_error < 5e5 * reference_errors[i]);
    }

}

TEST(POLYNOM_EVAL, TEST_5) {

/*
 * (x - 7) ^ 8
 */

    Containers::array<scalar, 9> coeffs = {5764801, -6588344, 3294172, -941192, 168070, -19208, 1372, -56, 1};
    Containers::array<scalar, 100> test_points = {6.500, 6.503, 6.506, 6.509, 6.512, 6.515, 6.518, 6.521, 6.524,
                                                  6.527,
                                                  6.530, 6.533, 6.536, 6.539, 6.542, 6.545, 6.548, 6.551, 6.554,
                                                  6.557,
                                                  6.560, 6.563, 6.566, 6.569, 6.572, 6.575, 6.578, 6.581, 6.584,
                                                  6.587,
                                                  6.590, 6.593, 6.596, 6.599, 6.602, 6.605, 6.608, 6.611, 6.614,
                                                  6.617,
                                                  6.620, 6.623, 6.626, 6.629, 6.632, 6.635, 6.638, 6.641, 6.644,
                                                  6.647,
                                                  6.650, 6.653, 6.656, 6.659, 6.662, 6.665, 6.668, 6.671, 6.674,
                                                  6.677,
                                                  6.680, 6.683, 6.686, 6.689, 6.692, 6.695, 6.698, 6.701, 6.704,
                                                  6.707,
                                                  6.710, 6.713, 6.716, 6.719, 6.722, 6.725, 6.728, 6.731, 6.734,
                                                  6.737,
                                                  6.740, 6.743, 6.746, 6.749, 6.752, 6.755, 6.758, 6.761, 6.764,
                                                  6.767,
                                                  6.770, 6.773, 6.776, 6.779, 6.782, 6.785, 6.788, 6.791, 6.794,
                                                  6.797};

    Containers::array<scalar, 100> reference_results =
            {0.003906250000000000000000, 0.003722640602679094258561, 0.003546627615893473935616,
             0.003377940044732998170721, 0.003216314998934990749696, 0.003061497497803500390625,
             0.002913240278671707832576, 0.002771303608864315695361, 0.002635455101117021618176,
             0.002505469532410439724481, 0.002381128666176100000000, 0.002262221077832419710241,
             0.002148541983608805523456, 0.002039893072616309544481, 0.001936082342123527004416,
             0.001836923935996687890625, 0.001742237986263159341056, 0.001651850457757840166401,
             0.001565592995812193403136, 0.001483302776945927340001, 0.001404822362521600000000,
             0.001329999555322686599521, 0.001258687259015914045696, 0.001190743340458931072641,
             0.001126030494814647156736, 0.001064416113433837890625, 0.001005772154467879035136,
             0.000949975016173736007841, 0.000896905412873600106496, 0.000846448253531827305121,
             0.000798492522912100000000, 0.000752931165277996622401, 0.000709660970600418574336,
             0.000668582463235588483201, 0.000629599793037598310656, 0.000592620628869750390625,
             0.000557556054479199010816, 0.000524320466699664691681, 0.000492831475947257856256,
             0.000463009808974713123841, 0.000434779213849600000000, 0.000408066367122340274881,
             0.000382800783150126981376, 0.000358914725543104304161, 0.000336343120699432370176,
             0.000315023473396125390625, 0.000294895784402816164096, 0.000275902470085864489921,
             0.000257988283970491580416, 0.000241100240228887100161, 0.000225187539062500000000,
             0.000210201493946988852961, 0.000196095460708571938816, 0.000182824768400781863521,
             0.000170346651950894039296, 0.000158620186545562890625, 0.000147606223725464190976,
             0.000137267329159006474561, 0.000127567722065439006976, 0.000118473216257948338081,
             0.000109951162777600000000, 0.000101970394089246452641, 0.000094501169810786918656,
             0.000087515123947429289281, 0.000080985213602868822016, 0.000074885669139562890625,
             0.000069191945760545587456, 0.000063880676485490517601, 0.000058929626493994663936,
             0.000054317648809320741601, 0.000050024641296100000000, 0.000046031504945761969921,
             0.000042320103423722192896, 0.000038873223852623509441, 0.000035674538806191022336,
             0.000032708569488525390625, 0.000029960650073923649536, 0.000027416893182581291041,
             0.000025064156467793879296, 0.000022890010290541014721, 0.000020882706457600000000,
             0.000019031147999601100801, 0.000017324859965700833536, 0.000015753961211814252001,
             0.000014309137159611744256, 0.000012981613503750390625, 0.000011763130845074473216,
             0.000010645920227784266881, 0.000009622679558836781056, 0.000008686550888106661441,
             0.000007831098528100000000, 0.000007050287992278341281, 0.000006338465731314712576,
             0.000005690339646868044961, 0.000005100960362726891776, 0.000004565703233437890625,
             0.000004080251070798954496, 0.000003640577568861717121, 0.000003242931408352297216,
             0.000002883821021683985761};

    Containers::array<scalar, 100> reference_errors =
            {1.1134798143189824010000E-14,
             1.113657943464805428234822390768874966356553332409493393035291810482184803359732276154613603003226948E-14,
             1.113846310400579550199066897407624358008147792828121546374209467976701357626486286017364414366523334E-14,
             1.114045569198260511146154372498274381842725580176148648247023066428338065841092865383701781712932703E-14,
             1.114256419988971574983639017920936143368338929114396974247205923610113678377495693612420569427793146E-14,
             1.114479612512311213066755610830687918449450157034833157828985141892052365621259520709764164901162490E-14,
             1.114715949963111433858435535713259254335982095070155945726657969485079007950301459067492247065507722E-14,
             1.114966293162611517862188871436702985844656767643644819282358659047891296435977620219010742962440424E-14,
             1.115231565083643714195236531447510231742302348210332504306466753478964607823438796658698213471898155E-14,
             1.115512755762334663964522485581812797817759078731897828433238943267109424271780774507782665324302533E-14,
             1.115810927632039731138505210585125613878086577702000146205739633161498905158390984152557906205449274E-14,
             1.116127221318781500329146486641443142572261836457958768585765162188660922963208031825426559335374151E-14,
             1.116462861941397028137707482079178030610062451749738854435803451374265695341620294873205200773833440E-14,
             1.116819165963954250000583681115217413664885564995396696289527249910631177297680557621144637621800931E-14,
             1.117197548652824737635280715824442007722703826525215867248150110772036828740846869149749609706919741E-14,
             1.117599532196152190354335129913539200885386294039059490074053493934795671376951855660220990990481527E-14,
             1.118026754549394740515131081508977094228407531538148114539039446733414045772300104135914806060319982E-14,
             1.118480979077213044950220827307460153575281247402791888677543493885801171383923595807200011385292898E-14,
             1.118964105069302474401975303877755890290565400833462612180053903618074029540809941315091907631788463E-14,
             1.119478179215913459322068418232144259605523862106521952299943224233001301817797983498630078414927175E-14,
             1.120025408137867158558305783467865742404206709774716541835278567254696575879214446916244165316388268E-14,
             1.120608172075964518775328421813687595117998088742182290428516725803652401840500353045760755354886932E-14,
             1.121229039855930081806149988283307349573028118055242969961751222210191559329642154904751109123221752E-14,
             1.121890785257568262699283027285860702800197292500494140279066519220836355260060768362871018928718061E-14,
             1.122596404930798252924017014832930146982917425055691032569950040679092149281713894673542039108555441E-14,
             1.123349138016854022163915134474068649027729288559131825466808114035168041330982970455609338036901504E-14,
             1.124152487650391650705141839782082529821893762079846168290104033034423665388922256008279323147705570E-14,
             1.125010244537768033950189344038687045725063595584670855835726495791464099850856224673009333141921695E-14,
             1.125926512828604353750433668697033478527039562115498651178052174891669919098216726350312360002437618E-14,
             1.126905738522221376713578342466655074398563145217540430796312002536244813568824275986283039610468824E-14,
             1.127952740677968719501976703303862686539407370439226902894378191647031669256812920373048822776254088E-14,
             1.129072745729249976966589604052042804166051696130231157223832720570679142683015870566897353749627227E-14,
             1.130271425235606179921534723442818390958351484488466554572735898197444859323800385030096407622334984E-14,
             1.131554937446058206859869601485657566447933585366032039166469823341451224964674373160231903390959121E-14,
             1.132929973090590881908997548637246055163163551684434661203950417322198454463435852597557428073850735E-14,
             1.134403805865833870608350517205324688594451134706400472076773025733323369700487074715124626937145352E-14,
             1.135984348136395414127412377287611489104307329949463997109353818110980760654183899843203607548638713E-14,
             1.137680212435778568314630210261647600337531225360880160026348570716243768431469692853755963002560089E-14,
             1.139500779421322094375063967166776287197827054699887759367532018156300666615948912357905889068134784E-14,
             1.141456273017266404487683702673995402527811022883655825289468370462263202313337562962429872125222793E-14,
             1.143557843570118492841829688769369699423839527878960342830454713416222305645457638573027156816616547E-14,
             1.145817659942436041608509700208967044541262251661509279898634615309692193638763093863929843254758652E-14,
             1.148249011586644911045544627525831969658360304169476961423172525393612655764599691946476616812604502E-14,
             1.150866421771473145519829843879696085730660375561616468835580256877714456183872801000870719200189080E-14,
             1.153685773282248073606950083598706190565264380867648503925608526018463491281737280533910078770829761E-14,
             1.156724448085220372032624386537560425739792047557305580702215640203555141814407794732935475758567099E-14,
             1.160001482638204433505353273424444434016758391532215351517450395603947931778027701092743260478053807E-14,
             1.163537740748572240923100936768744565859647700569410485211846879919616718289425872128852256530054010E-14,
             1.167356106128958470949167876690524264183401302457814978765381821963856843578508683840947173739743429E-14,
             1.171481697085503609492278910726850318711069859528653230053180153961611895299694173558391541145178112E-14,
             1.1759421060983864010000E-14,
             1.180767667425939282710898450703534889143282592489286104929295425181642441052174780099991711469986753E-14,
             1.185991756288965001167068532788762018899990998728940192831015342817312316573234852839054055973182783E-14,
             1.191651123679319391103520495970587296149555906147094227505300574817322895328278747537933254822493304E-14,
             1.197786271396115288154836996264222699381707335680086776946663315602192533140478843274469355520879077E-14,
             1.204441872555381120937825869884759800671052721575434683045527070096876403620287713302527713821377787E-14,
             1.211667243557933687271566763027505342700082015665202496893349219538333794318290101399324377730809729E-14,
             1.219516874351113833538773671981790318072634015732524531217206567388681348764566599225747098656089984E-14,
             1.228051024801068350816215733842821482656393642499358837947129031025971991719968930672418363849315694E-14,
             1.237336396124777741242696651216284186469078266737522796706556634258096749538891499647775532580110803E-14,
             1.24744688764010105758790588378906250000E-14,
             1.258464450607243627710661660555493123047654059682522717097595492600948495841002479153368641277146539E-14,
             1.270480052691028898731642111480256697797601096477200461283221389980425549067032778359848205059432400E-14,
             1.283594768611222338896859025461834420828545620439895395790562033354665040135377342939026709184054066E-14,
             1.297921014916442090156315011739588246870909911122366793844198132383421053592829680800582272119623539E-14,
             1.313583949573356815788435736945151157424828472751261756078187172310826718026730351420212539442934855E-14,
             1.330723060275056530392911583827081755773229345313379585592187683972054611982155576674674347552642831E-14,
             1.349493969121626038946937288603022057929244563459391861338232458501452038354623815958634802152072184E-14,
             1.370070485708352750464508817003800813276814192077796085856946877612312092781674291134444958663556400E-14,
             1.392646945787429941009314582397018399006183940532062284132311282847075001480653012221915998549945080E-14,
             1.417440878684487927811983101347430033351483064608616872820507476662306005560163675210293578523273588E-14,
             1.444696053715658471245627303145818736672775916467206547728021061939603223240815647966772126501526765E-14,
             1.474685964160465419998933316911159327602029902782207983098650348480545268140504700324312162907238859E-14,
             1.507717817136260980102219199895638842030909285729477820890179355805976134286061366826405734533014821E-14,
             1.544137109274523903647155268868600698590514297719832674195332892260798708266914263791956462323403645E-14,
             1.584332881759449763526102382480714666540921157355733723950536950227875093264738585755166355808696352E-14,
             1.628743764466931171057354420417268060797528524616026711413860928138312543141076799949472325696365910E-14,
             1.677864938135598417688462679681687533819789541784602479429651790622829900200810475949949476277291658E-14,
             1.732256166315033544870537520384147994401995166121396210502045735009557468277306934983572979690628394E-14,
             1.792551076003055949878257215481069062009594777715372856742008067332273337150713920723434833074904432E-14,
             1.859467898296735515899166731272341035198060169662287366519324702495788435556541948602178487770843683E-14,
             1.933821919129186356946622773609283529882059744321984474950233396595312256873044095207579675922334442E-14,
             2.016539936576913590628603933851290329797219235417099008007792463986926458941216017615774637069887472E-14,
             2.108677076930695496106430879908087090444128515159615012323018765989669689268118429048503916850368787E-14,
             2.211436388728346000581967823287551080138962667582491506000104965171481465995727978902284983567123970E-14,
             2.326191714713830971695904333905021179395437934457754916431633980080145004138043967172500837409652129E-14,
             2.454514439253603542663026488308869061901729795783571011204285743608188590857296270404985786730669923E-14,
             2.598204826866945524562092671188565678788641653066257205246954399830033052726168342310605913118601163E-14,
             2.759328810873803779606921927033468776866795780871244746810285004892151588151781228414701348761900547E-14,
             2.940261265525726582633178199403607776325252312731094531019055351882293417551607684969465044185496381E-14,
             3.143737007585770172394372186203269128550501246757516198540191369195601680352199986004923880508161015E-14,
             3.372911033188959534776087451841885974902215547436857594226387566638348619773574943269869367960531141E-14,
             3.631429814260261550003906250000E-14,
             3.923515870013116886296249039482671250916746626449466503496791671212189907677347418018362582630063231E-14,
             4.254068311025573523688682972272675593706908338727947749967799588870967630160446344686605112568417454E-14,
             4.628782648760236957438051146229578870615037040638858205849687992840708021716484357170670074525146442E-14,
             5.054293900907875772780800428913124282531253882145267215221288976532895446868617496821436757716541054E-14,
             5.538347939171570674658079578775224669787593629270656192832683194660446636799174320343250230535036544E-14,
             6.090007167761628511058540620428064651313858469088568807349278092330964586489339100318465515098511108E-14,
             6.719898047744066538365390864836146748599694053569131875192868485660729507201420854127854412643207343E-14};

    Containers::array<scalar, 100> condition_numbers =
            {282429536481,
             296886897557.4570436508717448969212204004003254194783731265165556517168541297196781603443716603318223,
             312175180633.0289910775827779907765610054210557683261402653573554663872759099331237208355138806374088,
             328347471654.9396271531833859487364534311809249369895501195573758897870173762572342911924123798963581,
             345460594835.7742864734208198146370723430670492977010183593802134659263353214587787046968125795914245,
             363575400723.2540432396405186825678475326805482374123714783817784313258356675205510724912670369686094,
             382757078411.7712733086223288092893706665120582871476119355547021409794619187938533797781889057480828,
             403075494084.2072771843901823474544147923681230131336159693741618286905637511257380903127150751095192,
             424605558286.1548734060978368241402274411450539998786061575159060924119652170113350132467715200190832,
             447427624570.6244594207033180596378392792045070934038173231834483491132433877748971497983381464599099,
             471627922412.1200501992703989226210435911515057219500207564023343477725150873292876031090175675086774,
             497299027577.4288068457500723515252473226066437755676151095821920835096959019585930871324840008239177,
             524540373459.7052299088939273742415883501705827237119094069841225765518498190321299574061175094099847,
             553458807235.9589319522507195209328516261314012983277566372250556473644426329484312267378964208206356,
             584169195099.8082651798324668810979403217130529353029176325063527340985910921896883166633963898823974,
             616795081255.7576783000673576446068407910310883093490848188859617559996247830416086535988142587068264,
             651469405843.2546477665028414071174603041580665650608342699007169397001681925252930699461131661376241,
             688335287493.9570611330920629380856728578238294612359936322939603766878811722746373833301992770796603,
             727546876820.2641345649950391815510340528691529472130655023053013614178671219820887177913831497818792,
             769270287794.2909927821133213330297545267317674313734518256005383492656292344763816760066889803729286,
             813684614712.0492296328044369666214109412149804980555016052728881338021166475486499670615466592214577,
             860983043256.5959561178818126521869262233656961433560935408429351231557373995903778719872863312175908,
             911374065086.4444287111426250553810220784123086797313498702396080019121280449764552188222646880733738,
             965082806393.0089034399015733999434136999669264259508383302101469715408862966291991616767249994368078,
             1022352482006.188858373266360922826636061798965643294584039448151862036302387297676612453462264056574,
             1083445987894.977856011292466039172877828852248935299526565060793374567107457428005487325544752983047,
             1148647646326.730842069786525613386074335992377229621645167115740152882508637469037276140179182336674,
             1218265119533.157531871548091769097128890803959473326502372087962946522185768705841490896286171714583,
             1292631509504.452053439953631769619229530035071463245773723900242810641920153942565563863322980084257,
             1372107663519.306607708655341827373946803274508362992516541839342281049717459968832585264151486796860,
             1457084707245.249533477534559196711836653467286683459369724713225146633329828173068180246958546716044,
             1547986829741.902196785131405895852947492224343010401527784491564863172038228704696607203453423198382,
             1645274347504.762594069858245501046259098407961079989820041871455031641857300575036936645371506775757,
             1749447077839.315547428747787164805328133559399888973229970767254399093009063742647531199041551750738,
             1861048055400.607248518590101229287814557548225341665546948333521808169342053068143621250553839033738,
             1980667629724.362519953779498849499926503622652901588513657416259501937318439012638188834261597707342,
             2108947986072.186845825207149388157544380109564926872584153381877362288828356781092703807121876366591,
             2246588136983.894839268745252954110895019172580219151045073335826332584078522010620384381381589163958,
             2394349437652.957907236747598959198701227745694333881938765686077128533935228383439485909347304178592,
             2553061684706.306670536782945702086074816250538402388222503722949619608985742842542198674793054361881,
             2723629865280.293226347673790225606641006373498819928806951928692169653895419011328059991625405125141,
             2907041631558.805422328520429264430203819677920745822571109050832699634253612782555306374746754212479,
             3104375585313.279039489053447433809727973403471266696000582138251246867605275520813771334860206517517,
             3316810467614.085343708290226417992511213406019123161174870567070669138558872883775738228974936212992,
             3545635360948.630274080844379409641308762631350348876221541151369082338388258849162722999656751056017,
             3792261024691.207859153022200922037638161841373046471934276084749903022629202807786132251908008043118,
             4058232500462.984620189373705417127994217871238715636029336124957710245254283556618191969846445402744,
             4345243141674.558958128474699191994631900633111712562715026936118790416223474220609435293931503450211,
             4655150241778.952272475276088834044654119089559111677523365134482903728883898115724449896415854510940,
             4989992458851.035589017036825489028383334945177230194793700199169029453396615061566300750032073542047,
             5352009260481,
             5743662643124.688151197017344658297958224380528308262716443099195003850422220175318561132332601798025,
             6167661414573.898317268771429978250052754727597511581270271515527742254408995605294947979544938136783,
             6626988367772.047001340840513804666516480472863168105470765406608012571652323573373746713320549736552,
             7124930719593.806359454345934925955635233125207376574705516055158038514174213038168530911088457030839,
             7665114240352.335113856494593357665828346134370216271653723485926213489458671188483282827191086582815,
             8251541559770.610118624037255702081219063551307945986274924861580905266968451432627166981391998192418,
             8888635204213.443189576631116126151941614642945582706859606084521441550910199383104110632144800745379,
             9581285999599.736288955095677527918404057596177206301269956093744498984799932548549015369194815006396,
             10334907566332.09489836025089004822550678339962158289073180396349793821520484469601881142217191062440,
             11155497738828.1030426025390625,
             12049707865209.28720969577636194246595630663579924703490768569861220262120290580952466266060199225217,
             13024921085222.70097651506464412439719159168058414093509319222384387838236076883194220016273512153234,
             14089340849867.89537349720196914490875972288129534091354521240429791940914985612717628656027790390924,
             15252091138417.50589694951803746353760822253965768742746889036055380415985657249255746954566347078477,
             16523330052216.28242743573873428708363159065601422463729228042953581906647404677797420765680082256757,
             17914378725351.55672371654766878352047506122435787513883549936563363806606461777263815228857662875015,
             19437867796577.06671105732396745573069793397966556219960540803981019820131114550896507059509391057412,
             21107904042557.64552102173662882889483619951238355621182184456437077445765617030201561926456160672019,
             22940260188899.43519270469786519100714277931503384971058617898570303343896442277511743494834428577874,
             24952591403659.43736806940194362714336104886491426157558806164082966528735980550890433354261206668195,
             27164682551388.56190614619780422195736326401399782538330720080041714172739556981153857415197642454062,
             29598730960187.11305891837650443627364678434402907296348499718760494645468229077999548025021566746683,
             32279670248864.61976318636473465131418155257574299795640696204494813538952082309608200679608254320436,
             35235541699092.92294839341521537218558481570470901977714433348691346471132756385551432160233125587575,
             38497920766126.91855580735187734069203318895847380356496636124910541961636756258304968479472515999932,
             42102407634683.15648546014287941466283560819126824338214543145265305677649063199415221754124635710653,
             46089192284359.90728743305573262621003325943850211853578683968757591347294869008002190970507891337214,
             50503706380572.48152508217842578914003749656408744389339355942983601635161734493425724965341211171119,
             55397376511894.80966465848676901786072636918900376372508254265622370532725839736390905241726117234249,
             60828495925390.43226192409149195203597094880039463415035462419466729879356842317576513095428705816757,
             66863235056341.72201498439847490329761237397486583755173689095013353723373695674825156883986059041003,
             73576814915746.57825084034849860322455946913687339493612594695755108566341540589380860113928008176869,
             81054871920355.12507965513188118554422888795675347902056026448875819086837660242099249281039285518926,
             89395048188324.48669604478721593629414324832948482197110624989572043514860772080017062616537351870550,
             98708847878729.88975699247901185140649260919847883734408178183427320387989108383793300063610174921910,
             109123808071877.5702185720711231936581366552873779377494687351467906978809234068882724604972592054154,
             120786042274729.7723043659338680761041140038676297587213088997970805967902545384581049107956430972456,
             133863226270092.0200963332462489626472580793588889899153323825180498459206356449337241052957358899884,
             148548110179833.3400400274490222877831608840445362466139939173242336087507143582245734489931162646198,
             165062657867524.5655705196157944378807361822292636568621491917351834755036403051688990279912757212089,
             183662935897164.1534596288817337785873632185331902327403803577279959701825966703143632715987306656230,
             204644900110401.87890625,
             228351259639080.9906903862543204830168749895809146551824930437197639956097457468888903792372883745825,
             255179637288010.1877841638643188601244790932829094998579634607246871980870189470290306472780268174218,
             285592293544374.3979740322332789204505003682363963037258217423904586241394137232657390366102203673762,
             320127741328453.5161740768142937362456400660565007115668550676874062897043152842704992644069244818646,
             359414652964172.6056860709016131178207765273621678967772772245105641138411491903514603725534075997520,
             404188553507152.7076583508335709816290328592215801127187200128311282334702125914374091766508480246009,
             455311910376111.2359682972863270957510429099954199441502469660324373613754728853870731153650388123807};

    Polynom<scalar, 8> polynom(coeffs);

    for (indexType i = 0; i < test_points.size(); ++i) {
        scalar compensated_horner_result = compensated_horner(polynom, test_points[i]);
        scalar experimental_relative_error = abs(
                (reference_results[i] - compensated_horner_result) / abs(reference_results[i]));
        std::cout << experimental_relative_error << " " << reference_errors[i] << " " << i << std::endl;
        ASSERT_TRUE(experimental_relative_error < reference_errors[i]);
    }

}

TEST(POLYNOM_EVAL, TEST_6) {

/*
 * (x - 7) ^ 8
 */

    Containers::array<scalar, 9> coeffs = {5764801, -6588344, 3294172, -941192, 168070, -19208, 1372, -56, 1};
    Containers::array<scalar, 100> test_points = {6.500, 6.503, 6.506, 6.509, 6.512, 6.515, 6.518, 6.521, 6.524,
                                                  6.527,
                                                  6.530, 6.533, 6.536, 6.539, 6.542, 6.545, 6.548, 6.551, 6.554,
                                                  6.557,
                                                  6.560, 6.563, 6.566, 6.569, 6.572, 6.575, 6.578, 6.581, 6.584,
                                                  6.587,
                                                  6.590, 6.593, 6.596, 6.599, 6.602, 6.605, 6.608, 6.611, 6.614,
                                                  6.617,
                                                  6.620, 6.623, 6.626, 6.629, 6.632, 6.635, 6.638, 6.641, 6.644,
                                                  6.647,
                                                  6.650, 6.653, 6.656, 6.659, 6.662, 6.665, 6.668, 6.671, 6.674,
                                                  6.677,
                                                  6.680, 6.683, 6.686, 6.689, 6.692, 6.695, 6.698, 6.701, 6.704,
                                                  6.707,
                                                  6.710, 6.713, 6.716, 6.719, 6.722, 6.725, 6.728, 6.731, 6.734,
                                                  6.737,
                                                  6.740, 6.743, 6.746, 6.749, 6.752, 6.755, 6.758, 6.761, 6.764,
                                                  6.767,
                                                  6.770, 6.773, 6.776, 6.779, 6.782, 6.785, 6.788, 6.791, 6.794,
                                                  6.797};

    Containers::array<scalar, 100> reference_results =
            {0.003906250000000000000000, 0.003722640602679094258561, 0.003546627615893473935616,
             0.003377940044732998170721, 0.003216314998934990749696, 0.003061497497803500390625,
             0.002913240278671707832576, 0.002771303608864315695361, 0.002635455101117021618176,
             0.002505469532410439724481, 0.002381128666176100000000, 0.002262221077832419710241,
             0.002148541983608805523456, 0.002039893072616309544481, 0.001936082342123527004416,
             0.001836923935996687890625, 0.001742237986263159341056, 0.001651850457757840166401,
             0.001565592995812193403136, 0.001483302776945927340001, 0.001404822362521600000000,
             0.001329999555322686599521, 0.001258687259015914045696, 0.001190743340458931072641,
             0.001126030494814647156736, 0.001064416113433837890625, 0.001005772154467879035136,
             0.000949975016173736007841, 0.000896905412873600106496, 0.000846448253531827305121,
             0.000798492522912100000000, 0.000752931165277996622401, 0.000709660970600418574336,
             0.000668582463235588483201, 0.000629599793037598310656, 0.000592620628869750390625,
             0.000557556054479199010816, 0.000524320466699664691681, 0.000492831475947257856256,
             0.000463009808974713123841, 0.000434779213849600000000, 0.000408066367122340274881,
             0.000382800783150126981376, 0.000358914725543104304161, 0.000336343120699432370176,
             0.000315023473396125390625, 0.000294895784402816164096, 0.000275902470085864489921,
             0.000257988283970491580416, 0.000241100240228887100161, 0.000225187539062500000000,
             0.000210201493946988852961, 0.000196095460708571938816, 0.000182824768400781863521,
             0.000170346651950894039296, 0.000158620186545562890625, 0.000147606223725464190976,
             0.000137267329159006474561, 0.000127567722065439006976, 0.000118473216257948338081,
             0.000109951162777600000000, 0.000101970394089246452641, 0.000094501169810786918656,
             0.000087515123947429289281, 0.000080985213602868822016, 0.000074885669139562890625,
             0.000069191945760545587456, 0.000063880676485490517601, 0.000058929626493994663936,
             0.000054317648809320741601, 0.000050024641296100000000, 0.000046031504945761969921,
             0.000042320103423722192896, 0.000038873223852623509441, 0.000035674538806191022336,
             0.000032708569488525390625, 0.000029960650073923649536, 0.000027416893182581291041,
             0.000025064156467793879296, 0.000022890010290541014721, 0.000020882706457600000000,
             0.000019031147999601100801, 0.000017324859965700833536, 0.000015753961211814252001,
             0.000014309137159611744256, 0.000012981613503750390625, 0.000011763130845074473216,
             0.000010645920227784266881, 0.000009622679558836781056, 0.000008686550888106661441,
             0.000007831098528100000000, 0.000007050287992278341281, 0.000006338465731314712576,
             0.000005690339646868044961, 0.000005100960362726891776, 0.000004565703233437890625,
             0.000004080251070798954496, 0.000003640577568861717121, 0.000003242931408352297216,
             0.000002883821021683985761};

    Containers::array<scalar, 100> reference_errors =
            {1.1134798143189824010000E-14,
             1.113657943464805428234822390768874966356553332409493393035291810482184803359732276154613603003226948E-14,
             1.113846310400579550199066897407624358008147792828121546374209467976701357626486286017364414366523334E-14,
             1.114045569198260511146154372498274381842725580176148648247023066428338065841092865383701781712932703E-14,
             1.114256419988971574983639017920936143368338929114396974247205923610113678377495693612420569427793146E-14,
             1.114479612512311213066755610830687918449450157034833157828985141892052365621259520709764164901162490E-14,
             1.114715949963111433858435535713259254335982095070155945726657969485079007950301459067492247065507722E-14,
             1.114966293162611517862188871436702985844656767643644819282358659047891296435977620219010742962440424E-14,
             1.115231565083643714195236531447510231742302348210332504306466753478964607823438796658698213471898155E-14,
             1.115512755762334663964522485581812797817759078731897828433238943267109424271780774507782665324302533E-14,
             1.115810927632039731138505210585125613878086577702000146205739633161498905158390984152557906205449274E-14,
             1.116127221318781500329146486641443142572261836457958768585765162188660922963208031825426559335374151E-14,
             1.116462861941397028137707482079178030610062451749738854435803451374265695341620294873205200773833440E-14,
             1.116819165963954250000583681115217413664885564995396696289527249910631177297680557621144637621800931E-14,
             1.117197548652824737635280715824442007722703826525215867248150110772036828740846869149749609706919741E-14,
             1.117599532196152190354335129913539200885386294039059490074053493934795671376951855660220990990481527E-14,
             1.118026754549394740515131081508977094228407531538148114539039446733414045772300104135914806060319982E-14,
             1.118480979077213044950220827307460153575281247402791888677543493885801171383923595807200011385292898E-14,
             1.118964105069302474401975303877755890290565400833462612180053903618074029540809941315091907631788463E-14,
             1.119478179215913459322068418232144259605523862106521952299943224233001301817797983498630078414927175E-14,
             1.120025408137867158558305783467865742404206709774716541835278567254696575879214446916244165316388268E-14,
             1.120608172075964518775328421813687595117998088742182290428516725803652401840500353045760755354886932E-14,
             1.121229039855930081806149988283307349573028118055242969961751222210191559329642154904751109123221752E-14,
             1.121890785257568262699283027285860702800197292500494140279066519220836355260060768362871018928718061E-14,
             1.122596404930798252924017014832930146982917425055691032569950040679092149281713894673542039108555441E-14,
             1.123349138016854022163915134474068649027729288559131825466808114035168041330982970455609338036901504E-14,
             1.124152487650391650705141839782082529821893762079846168290104033034423665388922256008279323147705570E-14,
             1.125010244537768033950189344038687045725063595584670855835726495791464099850856224673009333141921695E-14,
             1.125926512828604353750433668697033478527039562115498651178052174891669919098216726350312360002437618E-14,
             1.126905738522221376713578342466655074398563145217540430796312002536244813568824275986283039610468824E-14,
             1.127952740677968719501976703303862686539407370439226902894378191647031669256812920373048822776254088E-14,
             1.129072745729249976966589604052042804166051696130231157223832720570679142683015870566897353749627227E-14,
             1.130271425235606179921534723442818390958351484488466554572735898197444859323800385030096407622334984E-14,
             1.131554937446058206859869601485657566447933585366032039166469823341451224964674373160231903390959121E-14,
             1.132929973090590881908997548637246055163163551684434661203950417322198454463435852597557428073850735E-14,
             1.134403805865833870608350517205324688594451134706400472076773025733323369700487074715124626937145352E-14,
             1.135984348136395414127412377287611489104307329949463997109353818110980760654183899843203607548638713E-14,
             1.137680212435778568314630210261647600337531225360880160026348570716243768431469692853755963002560089E-14,
             1.139500779421322094375063967166776287197827054699887759367532018156300666615948912357905889068134784E-14,
             1.141456273017266404487683702673995402527811022883655825289468370462263202313337562962429872125222793E-14,
             1.143557843570118492841829688769369699423839527878960342830454713416222305645457638573027156816616547E-14,
             1.145817659942436041608509700208967044541262251661509279898634615309692193638763093863929843254758652E-14,
             1.148249011586644911045544627525831969658360304169476961423172525393612655764599691946476616812604502E-14,
             1.150866421771473145519829843879696085730660375561616468835580256877714456183872801000870719200189080E-14,
             1.153685773282248073606950083598706190565264380867648503925608526018463491281737280533910078770829761E-14,
             1.156724448085220372032624386537560425739792047557305580702215640203555141814407794732935475758567099E-14,
             1.160001482638204433505353273424444434016758391532215351517450395603947931778027701092743260478053807E-14,
             1.163537740748572240923100936768744565859647700569410485211846879919616718289425872128852256530054010E-14,
             1.167356106128958470949167876690524264183401302457814978765381821963856843578508683840947173739743429E-14,
             1.171481697085503609492278910726850318711069859528653230053180153961611895299694173558391541145178112E-14,
             1.1759421060983864010000E-14,
             1.180767667425939282710898450703534889143282592489286104929295425181642441052174780099991711469986753E-14,
             1.185991756288965001167068532788762018899990998728940192831015342817312316573234852839054055973182783E-14,
             1.191651123679319391103520495970587296149555906147094227505300574817322895328278747537933254822493304E-14,
             1.197786271396115288154836996264222699381707335680086776946663315602192533140478843274469355520879077E-14,
             1.204441872555381120937825869884759800671052721575434683045527070096876403620287713302527713821377787E-14,
             1.211667243557933687271566763027505342700082015665202496893349219538333794318290101399324377730809729E-14,
             1.219516874351113833538773671981790318072634015732524531217206567388681348764566599225747098656089984E-14,
             1.228051024801068350816215733842821482656393642499358837947129031025971991719968930672418363849315694E-14,
             1.237336396124777741242696651216284186469078266737522796706556634258096749538891499647775532580110803E-14,
             1.24744688764010105758790588378906250000E-14,
             1.258464450607243627710661660555493123047654059682522717097595492600948495841002479153368641277146539E-14,
             1.270480052691028898731642111480256697797601096477200461283221389980425549067032778359848205059432400E-14,
             1.283594768611222338896859025461834420828545620439895395790562033354665040135377342939026709184054066E-14,
             1.297921014916442090156315011739588246870909911122366793844198132383421053592829680800582272119623539E-14,
             1.313583949573356815788435736945151157424828472751261756078187172310826718026730351420212539442934855E-14,
             1.330723060275056530392911583827081755773229345313379585592187683972054611982155576674674347552642831E-14,
             1.349493969121626038946937288603022057929244563459391861338232458501452038354623815958634802152072184E-14,
             1.370070485708352750464508817003800813276814192077796085856946877612312092781674291134444958663556400E-14,
             1.392646945787429941009314582397018399006183940532062284132311282847075001480653012221915998549945080E-14,
             1.417440878684487927811983101347430033351483064608616872820507476662306005560163675210293578523273588E-14,
             1.444696053715658471245627303145818736672775916467206547728021061939603223240815647966772126501526765E-14,
             1.474685964160465419998933316911159327602029902782207983098650348480545268140504700324312162907238859E-14,
             1.507717817136260980102219199895638842030909285729477820890179355805976134286061366826405734533014821E-14,
             1.544137109274523903647155268868600698590514297719832674195332892260798708266914263791956462323403645E-14,
             1.584332881759449763526102382480714666540921157355733723950536950227875093264738585755166355808696352E-14,
             1.628743764466931171057354420417268060797528524616026711413860928138312543141076799949472325696365910E-14,
             1.677864938135598417688462679681687533819789541784602479429651790622829900200810475949949476277291658E-14,
             1.732256166315033544870537520384147994401995166121396210502045735009557468277306934983572979690628394E-14,
             1.792551076003055949878257215481069062009594777715372856742008067332273337150713920723434833074904432E-14,
             1.859467898296735515899166731272341035198060169662287366519324702495788435556541948602178487770843683E-14,
             1.933821919129186356946622773609283529882059744321984474950233396595312256873044095207579675922334442E-14,
             2.016539936576913590628603933851290329797219235417099008007792463986926458941216017615774637069887472E-14,
             2.108677076930695496106430879908087090444128515159615012323018765989669689268118429048503916850368787E-14,
             2.211436388728346000581967823287551080138962667582491506000104965171481465995727978902284983567123970E-14,
             2.326191714713830971695904333905021179395437934457754916431633980080145004138043967172500837409652129E-14,
             2.454514439253603542663026488308869061901729795783571011204285743608188590857296270404985786730669923E-14,
             2.598204826866945524562092671188565678788641653066257205246954399830033052726168342310605913118601163E-14,
             2.759328810873803779606921927033468776866795780871244746810285004892151588151781228414701348761900547E-14,
             2.940261265525726582633178199403607776325252312731094531019055351882293417551607684969465044185496381E-14,
             3.143737007585770172394372186203269128550501246757516198540191369195601680352199986004923880508161015E-14,
             3.372911033188959534776087451841885974902215547436857594226387566638348619773574943269869367960531141E-14,
             3.631429814260261550003906250000E-14,
             3.923515870013116886296249039482671250916746626449466503496791671212189907677347418018362582630063231E-14,
             4.254068311025573523688682972272675593706908338727947749967799588870967630160446344686605112568417454E-14,
             4.628782648760236957438051146229578870615037040638858205849687992840708021716484357170670074525146442E-14,
             5.054293900907875772780800428913124282531253882145267215221288976532895446868617496821436757716541054E-14,
             5.538347939171570674658079578775224669787593629270656192832683194660446636799174320343250230535036544E-14,
             6.090007167761628511058540620428064651313858469088568807349278092330964586489339100318465515098511108E-14,
             6.719898047744066538365390864836146748599694053569131875192868485660729507201420854127854412643207343E-14};

    Containers::array<scalar, 100> condition_numbers =
            {282429536481,
             296886897557.4570436508717448969212204004003254194783731265165556517168541297196781603443716603318223,
             312175180633.0289910775827779907765610054210557683261402653573554663872759099331237208355138806374088,
             328347471654.9396271531833859487364534311809249369895501195573758897870173762572342911924123798963581,
             345460594835.7742864734208198146370723430670492977010183593802134659263353214587787046968125795914245,
             363575400723.2540432396405186825678475326805482374123714783817784313258356675205510724912670369686094,
             382757078411.7712733086223288092893706665120582871476119355547021409794619187938533797781889057480828,
             403075494084.2072771843901823474544147923681230131336159693741618286905637511257380903127150751095192,
             424605558286.1548734060978368241402274411450539998786061575159060924119652170113350132467715200190832,
             447427624570.6244594207033180596378392792045070934038173231834483491132433877748971497983381464599099,
             471627922412.1200501992703989226210435911515057219500207564023343477725150873292876031090175675086774,
             497299027577.4288068457500723515252473226066437755676151095821920835096959019585930871324840008239177,
             524540373459.7052299088939273742415883501705827237119094069841225765518498190321299574061175094099847,
             553458807235.9589319522507195209328516261314012983277566372250556473644426329484312267378964208206356,
             584169195099.8082651798324668810979403217130529353029176325063527340985910921896883166633963898823974,
             616795081255.7576783000673576446068407910310883093490848188859617559996247830416086535988142587068264,
             651469405843.2546477665028414071174603041580665650608342699007169397001681925252930699461131661376241,
             688335287493.9570611330920629380856728578238294612359936322939603766878811722746373833301992770796603,
             727546876820.2641345649950391815510340528691529472130655023053013614178671219820887177913831497818792,
             769270287794.2909927821133213330297545267317674313734518256005383492656292344763816760066889803729286,
             813684614712.0492296328044369666214109412149804980555016052728881338021166475486499670615466592214577,
             860983043256.5959561178818126521869262233656961433560935408429351231557373995903778719872863312175908,
             911374065086.4444287111426250553810220784123086797313498702396080019121280449764552188222646880733738,
             965082806393.0089034399015733999434136999669264259508383302101469715408862966291991616767249994368078,
             1022352482006.188858373266360922826636061798965643294584039448151862036302387297676612453462264056574,
             1083445987894.977856011292466039172877828852248935299526565060793374567107457428005487325544752983047,
             1148647646326.730842069786525613386074335992377229621645167115740152882508637469037276140179182336674,
             1218265119533.157531871548091769097128890803959473326502372087962946522185768705841490896286171714583,
             1292631509504.452053439953631769619229530035071463245773723900242810641920153942565563863322980084257,
             1372107663519.306607708655341827373946803274508362992516541839342281049717459968832585264151486796860,
             1457084707245.249533477534559196711836653467286683459369724713225146633329828173068180246958546716044,
             1547986829741.902196785131405895852947492224343010401527784491564863172038228704696607203453423198382,
             1645274347504.762594069858245501046259098407961079989820041871455031641857300575036936645371506775757,
             1749447077839.315547428747787164805328133559399888973229970767254399093009063742647531199041551750738,
             1861048055400.607248518590101229287814557548225341665546948333521808169342053068143621250553839033738,
             1980667629724.362519953779498849499926503622652901588513657416259501937318439012638188834261597707342,
             2108947986072.186845825207149388157544380109564926872584153381877362288828356781092703807121876366591,
             2246588136983.894839268745252954110895019172580219151045073335826332584078522010620384381381589163958,
             2394349437652.957907236747598959198701227745694333881938765686077128533935228383439485909347304178592,
             2553061684706.306670536782945702086074816250538402388222503722949619608985742842542198674793054361881,
             2723629865280.293226347673790225606641006373498819928806951928692169653895419011328059991625405125141,
             2907041631558.805422328520429264430203819677920745822571109050832699634253612782555306374746754212479,
             3104375585313.279039489053447433809727973403471266696000582138251246867605275520813771334860206517517,
             3316810467614.085343708290226417992511213406019123161174870567070669138558872883775738228974936212992,
             3545635360948.630274080844379409641308762631350348876221541151369082338388258849162722999656751056017,
             3792261024691.207859153022200922037638161841373046471934276084749903022629202807786132251908008043118,
             4058232500462.984620189373705417127994217871238715636029336124957710245254283556618191969846445402744,
             4345243141674.558958128474699191994631900633111712562715026936118790416223474220609435293931503450211,
             4655150241778.952272475276088834044654119089559111677523365134482903728883898115724449896415854510940,
             4989992458851.035589017036825489028383334945177230194793700199169029453396615061566300750032073542047,
             5352009260481,
             5743662643124.688151197017344658297958224380528308262716443099195003850422220175318561132332601798025,
             6167661414573.898317268771429978250052754727597511581270271515527742254408995605294947979544938136783,
             6626988367772.047001340840513804666516480472863168105470765406608012571652323573373746713320549736552,
             7124930719593.806359454345934925955635233125207376574705516055158038514174213038168530911088457030839,
             7665114240352.335113856494593357665828346134370216271653723485926213489458671188483282827191086582815,
             8251541559770.610118624037255702081219063551307945986274924861580905266968451432627166981391998192418,
             8888635204213.443189576631116126151941614642945582706859606084521441550910199383104110632144800745379,
             9581285999599.736288955095677527918404057596177206301269956093744498984799932548549015369194815006396,
             10334907566332.09489836025089004822550678339962158289073180396349793821520484469601881142217191062440,
             11155497738828.1030426025390625,
             12049707865209.28720969577636194246595630663579924703490768569861220262120290580952466266060199225217,
             13024921085222.70097651506464412439719159168058414093509319222384387838236076883194220016273512153234,
             14089340849867.89537349720196914490875972288129534091354521240429791940914985612717628656027790390924,
             15252091138417.50589694951803746353760822253965768742746889036055380415985657249255746954566347078477,
             16523330052216.28242743573873428708363159065601422463729228042953581906647404677797420765680082256757,
             17914378725351.55672371654766878352047506122435787513883549936563363806606461777263815228857662875015,
             19437867796577.06671105732396745573069793397966556219960540803981019820131114550896507059509391057412,
             21107904042557.64552102173662882889483619951238355621182184456437077445765617030201561926456160672019,
             22940260188899.43519270469786519100714277931503384971058617898570303343896442277511743494834428577874,
             24952591403659.43736806940194362714336104886491426157558806164082966528735980550890433354261206668195,
             27164682551388.56190614619780422195736326401399782538330720080041714172739556981153857415197642454062,
             29598730960187.11305891837650443627364678434402907296348499718760494645468229077999548025021566746683,
             32279670248864.61976318636473465131418155257574299795640696204494813538952082309608200679608254320436,
             35235541699092.92294839341521537218558481570470901977714433348691346471132756385551432160233125587575,
             38497920766126.91855580735187734069203318895847380356496636124910541961636756258304968479472515999932,
             42102407634683.15648546014287941466283560819126824338214543145265305677649063199415221754124635710653,
             46089192284359.90728743305573262621003325943850211853578683968757591347294869008002190970507891337214,
             50503706380572.48152508217842578914003749656408744389339355942983601635161734493425724965341211171119,
             55397376511894.80966465848676901786072636918900376372508254265622370532725839736390905241726117234249,
             60828495925390.43226192409149195203597094880039463415035462419466729879356842317576513095428705816757,
             66863235056341.72201498439847490329761237397486583755173689095013353723373695674825156883986059041003,
             73576814915746.57825084034849860322455946913687339493612594695755108566341540589380860113928008176869,
             81054871920355.12507965513188118554422888795675347902056026448875819086837660242099249281039285518926,
             89395048188324.48669604478721593629414324832948482197110624989572043514860772080017062616537351870550,
             98708847878729.88975699247901185140649260919847883734408178183427320387989108383793300063610174921910,
             109123808071877.5702185720711231936581366552873779377494687351467906978809234068882724604972592054154,
             120786042274729.7723043659338680761041140038676297587213088997970805967902545384581049107956430972456,
             133863226270092.0200963332462489626472580793588889899153323825180498459206356449337241052957358899884,
             148548110179833.3400400274490222877831608840445362466139939173242336087507143582245734489931162646198,
             165062657867524.5655705196157944378807361822292636568621491917351834755036403051688990279912757212089,
             183662935897164.1534596288817337785873632185331902327403803577279959701825966703143632715987306656230,
             204644900110401.87890625,
             228351259639080.9906903862543204830168749895809146551824930437197639956097457468888903792372883745825,
             255179637288010.1877841638643188601244790932829094998579634607246871980870189470290306472780268174218,
             285592293544374.3979740322332789204505003682363963037258217423904586241394137232657390366102203673762,
             320127741328453.5161740768142937362456400660565007115668550676874062897043152842704992644069244818646,
             359414652964172.6056860709016131178207765273621678967772772245105641138411491903514603725534075997520,
             404188553507152.7076583508335709816290328592215801127187200128311282334702125914374091766508480246009,
             455311910376111.2359682972863270957510429099954199441502469660324373613754728853870731153650388123807};

    Polynom<scalar, 8> polynom(coeffs);

    for (indexType i = 0; i < test_points.size(); ++i) {
        scalar compensated_horner_result = compensated_horner(polynom, test_points[i]);

        std::cout << abs(reference_results[i] - compensated_horner_result) << " "
                  << 150 * calc_absolute_error(polynom, test_points[i]) << std::endl;

        ASSERT_NEAR(reference_results[i], compensated_horner_result,
                    150 * calc_absolute_error(polynom, test_points[i]));
    }

}


TEST(POLYNOM_EVAL, TEST_7) {

/*
 * 5 * (x - 1)
 */

    Containers::array<scalar, 2> coeffs = {-5, 5};
    Containers::array<scalar, 100> test_points = {1.0000010000, 1.0000009901, 1.0000009802, 1.0000009703, 1.0000009604,
                                                  1.0000009505, 1.0000009406, 1.0000009307, 1.0000009208, 1.0000009109,
                                                  1.0000009010, 1.0000008911, 1.0000008812, 1.0000008713, 1.0000008614,
                                                  1.0000008515, 1.0000008416, 1.0000008317, 1.0000008218, 1.0000008119,
                                                  1.0000008020, 1.0000007921, 1.0000007822, 1.0000007723, 1.0000007624,
                                                  1.0000007525, 1.0000007426, 1.0000007327, 1.0000007228, 1.0000007129,
                                                  1.0000007030, 1.0000006931, 1.0000006832, 1.0000006733, 1.0000006634,
                                                  1.0000006535, 1.0000006436, 1.0000006337, 1.0000006238, 1.0000006139,
                                                  1.0000006040, 1.0000005941, 1.0000005842, 1.0000005743, 1.0000005644,
                                                  1.0000005545, 1.0000005446, 1.0000005347, 1.0000005248, 1.0000005149,
                                                  1.0000005050, 1.0000004951, 1.0000004852, 1.0000004753, 1.0000004654,
                                                  1.0000004555, 1.0000004456, 1.0000004357, 1.0000004258, 1.0000004159,
                                                  1.0000004060, 1.0000003961, 1.0000003862, 1.0000003763, 1.0000003664,
                                                  1.0000003565, 1.0000003466, 1.0000003367, 1.0000003268, 1.0000003169,
                                                  1.0000003070, 1.0000002971, 1.0000002872, 1.0000002773, 1.0000002674,
                                                  1.0000002575, 1.0000002476, 1.0000002377, 1.0000002278, 1.0000002179,
                                                  1.0000002080, 1.0000001981, 1.0000001882, 1.0000001783, 1.0000001684,
                                                  1.0000001585, 1.0000001486, 1.0000001387, 1.0000001288, 1.0000001189,
                                                  1.0000001090, 1.0000000991, 1.0000000892, 1.0000000793, 1.0000000694,
                                                  1.0000000595, 1.0000000496, 1.0000000397, 1.0000000298, 1.0000000199};

    Containers::array<scalar, 100> reference_results =
            {0.0000050000, 0.0000049505, 0.0000049010, 0.0000048515, 0.0000048020, 0.0000047525, 0.0000047030,
             0.0000046535, 0.0000046040, 0.0000045545, 0.0000045050, 0.0000044555, 0.0000044060, 0.0000043565,
             0.0000043070, 0.0000042575, 0.0000042080, 0.0000041585, 0.0000041090, 0.0000040595, 0.0000040100,
             0.0000039605, 0.0000039110, 0.0000038615, 0.0000038120, 0.0000037625, 0.0000037130, 0.0000036635,
             0.0000036140, 0.0000035645, 0.0000035150, 0.0000034655, 0.0000034160, 0.0000033665, 0.0000033170,
             0.0000032675, 0.0000032180, 0.0000031685, 0.0000031190, 0.0000030695, 0.0000030200, 0.0000029705,
             0.0000029210, 0.0000028715, 0.0000028220, 0.0000027725, 0.0000027230, 0.0000026735, 0.0000026240,
             0.0000025745, 0.0000025250, 0.0000024755, 0.0000024260, 0.0000023765, 0.0000023270, 0.0000022775,
             0.0000022280, 0.0000021785, 0.0000021290, 0.0000020795, 0.0000020300, 0.0000019805, 0.0000019310,
             0.0000018815, 0.0000018320, 0.0000017825, 0.0000017330, 0.0000016835, 0.0000016340, 0.0000015845,
             0.0000015350, 0.0000014855, 0.0000014360, 0.0000013865, 0.0000013370, 0.0000012875, 0.0000012380,
             0.0000011885, 0.0000011390, 0.0000010895, 0.0000010400, 9.905E-7, 9.410E-7, 8.915E-7, 8.420E-7, 7.925E-7,
             7.430E-7, 6.935E-7, 6.440E-7, 5.945E-7, 5.450E-7, 4.955E-7, 4.460E-7, 3.965E-7, 3.470E-7, 2.975E-7,
             2.480E-7, 1.985E-7, 1.490E-7, 9.95E-8};

    Containers::array<scalar, 100> reference_errors =
            {1.1100000246420123210000E-14,
             1.110000024888407432604888395111604888395111604888395111604888395111604888395111604888395111604888395E-14,
             1.110000025139779715409304223627831054886757804529687818812487247500510099979596000816159967353601306E-14,
             1.110000025396281516094300731732453880243223745233432958878697310110275172627022570339070390600845099E-14,
             1.110000025658071463024156601416076634735526863806747188671386922115785089546022490628904623073719284E-14,
             1.110000025925314793382956338769068911099421357180431351920042083114150447133087848500789058390320884E-14,
             1.110000026198183700970231766957261322560068041675526259834148415904741654263236232192217733361684031E-14,
             1.110000026476857706193940045127323519931234554636295261631030407220371763188997528741807241860964865E-14,
             1.110000026761524049931364031277150304083405734144222415291051259774109470026064291920069504778453519E-14,
             1.110000027052378113073773191349215062026567131408497090789329234822702821385442968492699527939400593E-14,
             1.110000027349623863730299667036625971143174250832408435072142064372918978912319644839067702552719201E-14,
             1.110000027653474334242060374817641117719672315116148580406239479295253058018179777802715744585343957E-14,
             1.110000027964152130350885156604630049931911030413073082160689968225147526100771674988651838402178847E-14,
             1.110000028281889975080110180190519912774015838402387237461264776770343165385056811660736830024101917E-14,
             1.110000028606931290120037148827490132342697933596470861388437427443696308335268168098444392848850708E-14,
             1.110000028939530817770405167351732237228420434527304756312389900176159718144450968878449794480328831E-14,
             1.110000029279955286779467680608365019011406844106463878326996197718631178707224334600760456273764259E-14,
             1.110000029628484125737285078754358542743777804496813754959721053264398220512203919682577852591078514E-14,
             1.110000029985410228033341445607203699196884886833779508396203455828668775857872961791190070576782672E-14,
             1.110000030351040772779775834462372213326764379849735189062692449809089789382928932134499322576672004E-14,
             1.110000030725698106536159600997506234413965087281795511221945137157107231920199501246882793017456359E-14,
             1.110000031109720691155283423810124984219164246938517863906072465597778058325968943315237975003156167E-14,
             1.110000031503464123608028637177192533878803375095883405778573254922014829966760419330094604960368192E-14,
             1.110000031907302234246147869998705166386119383659199792826621779101385471966852259484656221675514696E-14,
             1.110000032321628270632738719832109129066107030430220356768100734522560335781741867785939139559286464E-14,
             1.110000032746856174820598006644518272425249169435215946843853820598006644518272425249169435215946844E-14,
             1.110000033183421962799084298410988419068138971182332345812011850255857796929706436843522757877726905E-14,
             1.110000033631785215772758291251535416951003139074655384195441517674355124880578681588644738637914563E-14,
             1.110000034092430693993912562257885998893193137797454344216934144991698948533480907581627006087437742E-14,
             1.110000034565870085062280824800112217702342544536400617197362883994950203394585495861972226118670220E-14,
             1.110000035052643899947368421052631578947368421052631578947368421052631578947368421052631578947368421E-14,
             1.110000035553323531503534843456932621555331121050353484345693262155533112105035348434569326215553311E-14,
             1.110000036068513491960187353629976580796252927400468384074941451990632318501170960187353629976580796E-14,
             1.110000036598853847808257834546264666567651863953661072330313381850586662706074558146442893212535274E-14,
             1.110000037145022872703346397347000301477238468495628580042206813385589388001205908953873982514320169E-14,
             1.110000037707739941504973221117061973986228003060443764345830145371078806426931905126243305279265493E-14,
             1.110000038287768691416407706650093225605966438781852082038533250466128029832193909260410192666252331E-14,
             1.110000038885920479434590500236705065488401451791068328862237651885750355057598232602177686602493293E-14,
             1.110000039503058169028214171208720743828150048092337287592176979801218339211285668483488297531260019E-14,
             1.110000040140100283208828799478742466199706792637237335070858446000977357875875549763805179996742140E-14,
             1.110000040798025566033112582781456953642384105960264900662251655629139072847682119205298013245033113E-14,
             1.110000041477878000178589463053358020535263423666049486618414408348762834539639791280929136509005218E-14,
             1.110000042180772334693940431359123587812393016090380006846970215679561793906196508045190003423485108E-14,
             1.110000042907900184485982935747866968483371060421382552672819084102385512798189099773637471704683963E-14,
             1.110000043660536771744153082919914953933380581148121899362154500354358610914245216158752657689581857E-14,
             1.110000044440048389530207394048692515779981965734896302975653742110009017132551848512173128944995491E-14,
             1.110000045247900679428204186558942343004039662137348512669849430774880646345941975762027175908923981E-14,
             1.110000046085667828761361511127735178604825135590050495605012156349354778380400224424911165139330466E-14,
             1.110000046955042808804878048780487804878048780487804878048780487804878048780487804878048780487804878E-14,
             1.110000047857848794101573120994367838415226257525733152068362788891046805204894154204699941736259468E-14,
             1.110000048796051924960396039603960396039603960396039603960396039603960396039603960396039603960396040E-14,
             1.110000049771775601145425166633003433649767723692183397293476065441324984851545142395475661482528782E-14,
             1.110000050787316525451772464962901896125309150865622423742786479802143446001648804616652926628194559E-14,
             1.110000051845162752306543235851041447506837786661056175047338523038081211866189774879023774458236903E-14,
             1.110000052948014039951439621830683283197249677696605070906746884400515685431886549204984959174903309E-14,
             1.110000054098804856675082327113062568605927552140504939626783754116355653128430296377607025246981339E-14,
             1.110000055300730453854578096947935368043087971274685816876122082585278276481149012567324955116696589E-14,
             1.110000056557276493595822813862749598347486802845994950654119807206793665366077576313977507459260959E-14,
             1.110000057872252809492249882573978393612024424612494128698919680601221230624706434945984030061061531E-14,
             1.110000059249831989189468622264967540274104352007694157249338783361384948304880981005049290694878577E-14,
             1.110000060694593601788177339901477832512315270935960591133004926108374384236453201970443349753694581E-14,
             1.110000062211575057682655894976016157535975763696036354455945468316081797525877303711184044433223933E-14,
             1.110000063806330290963749352667011910926980838943552563438632832729155877783531848783013982392542724E-14,
             1.110000065484997705002125963327132606962529896359287802285410576667552484719638586234387456816369918E-14,
             1.110000067254379133227074235807860262008733624454148471615720524017467248908296943231441048034934498E-14,
             1.110000069122031956343618513323983169705469845722300140252454417952314165497896213183730715287517532E-14,
             1.110000071096377006516445470282746682054241200230813618003462204270051933064050778995960761684939411E-14,
             1.110000073186825507813186813186813186813186813186813186813186813186813186813186813186813186813186813E-14,
             1.110000075403929089665850673194614443084455324357405140758873929008567931456548347613219094247246022E-14,
             1.110000077759557918980435468602082675923004102240454402019564531397917324076995897759545597980435469E-14,
             1.110000080267113298198697068403908794788273615635179153094462540716612377850162866449511400651465798E-14,
             1.110000082941782768660720296196566812521036687983843823628407943453382699427802086839447997307303938E-14,
             1.110000085800847975596100278551532033426183844011142061281337047353760445682451253481894150417827298E-14,
             1.110000088864058480394157951676884240894338261810313739632167327803822574828705373241976199062387306E-14,
             1.110000092154088611201944652206432311144353029169783096484667165295437546746447270007479431563201197E-14,
             1.110000095697099699640776699029126213592233009708737864077669902912621359223300970873786407766990291E-14,
             1.110000099523437199836833602584814216478190630048465266558966074313408723747980613893376413570274637E-14,
             1.110000103668502013890197728228859907446360959192259150189314261674379469920067311737484223811527135E-14,
             1.110000108173849019858647936786654960491659350307287093942054433713784021071115013169446883230904302E-14,
             1.110000113088585060788893988067921064708581918311151904543368517668655346489215236346948141349242772E-14,
             1.110000118471166167153846153846153846153846153846153846153846153846153846153846153846153846153846154E-14,
             1.110000124391733673852094901564866229177183240787481070166582534073700151438667339727410398788490661E-14,
             1.110000130935187666377258235919234856535600425079702444208289054197662061636556854410201912858660999E-14,
             1.110000138205284334460459899046550757150869321368480089736399326977005047672462142456533931575995513E-14,
             1.110000146330178591783847980997624703087885985748218527315914489311163895486935866983372921615201900E-14,
             1.110000155470043866741324921135646687697160883280757097791798107255520504731861198738170347003154574E-14,
             1.110000165827737758415881561238223418573351278600269179004037685060565275908479138627187079407806191E-14,
             1.110000177664035392377072819033886085075702956020187454938716654650324441240086517664023071377072819E-14,
             1.110000191319888097397515527950310559006211180124223602484472049689440993788819875776397515527950311E-14,
             1.110000207249802060276703111858704793944491169049621530698065601345668629100084104289318755256518082E-14,
             1.110000226073406816412844036697247706422018348623853211009174311926605504587155963302752293577981651E-14,
             1.110000248657933612624621594349142280524722502522704339051463168516649848637739656912209889001009082E-14,
             1.110000276255617702165919282511210762331838565022421524663677130044843049327354260089686098654708520E-14,
             1.110000310744022409272383354350567465321563682219419924337957124842370744010088272383354350567465322E-14,
             1.110000355072058430510086455331412103746397694524495677233429394812680115273775216138328530259365994E-14,
             1.110000414151272825201680672268907563025210084033613445378151260504201680672268907563025210084033613E-14,
             1.110000496814528450032258064516129032258064516129032258064516129032258064516129032258064516129032258E-14,
             1.110000620705301993544080604534005037783375314861460957178841309823677581863979848866498740554156171E-14,
             1.110000826912763998852348993288590604026845637583892617449664429530201342281879194630872483221476510E-14,
             1.110001238291469607432160804020100502512562814070351758793969849246231155778894472361809045226130653E-14};

    Containers::array<scalar, 100> condition_numbers =
            {2000001, 2019998, 2040400, 2061219, 2082466, 2104156, 2126303, 2148921, 2172025, 2195631, 2219756, 2244418,
             2269633, 2295421, 2321802, 2348797, 2376426, 2404714, 2433683, 2463358, 2493766, 2524934, 2556891, 2589668,
             2623295, 2657808, 2693240, 2729631, 2767018, 2805443, 2844951, 2885587, 2927401, 2970445, 3014773, 3060444,
             3107521, 3156068, 3206156, 3257860, 3311259, 3366437, 3423486, 3482501, 3543587, 3606854, 3672421, 3740416,
             3810976, 3884250, 3960397, 4039588, 4122012, 4207869, 4297379, 4390780, 4488331, 4590315, 4697041, 4808849,
             4926109, 5049230, 5178664, 5314909, 5458516, 5610099, 5770341, 5940006, 6119952, 6311140, 6514658, 6731741,
             6963789, 7212406, 7479432, 7766991, 8077545, 8413968, 8779632, 9178523, 9615385, 10095912, 10626993,
             11217050, 11876485, 12618297, 13458951, 14419611, 15527951, 16820858, 18348624, 20181635, 22421525,
             25220681, 28818444, 33613446, 40322581, 50377834, 67114094, 100502513};

    Polynom<scalar, 1> polynom(coeffs);

    for (indexType i = 0; i < test_points.size(); ++i) {
        scalar compensated_horner_result = compensated_horner(polynom, test_points[i]);
        scalar experimental_relative_error = abs(
                (reference_results[i] - compensated_horner_result) / abs(reference_results[i]));
        std::cout << reference_results[i] - compensated_horner_result << " " << reference_errors[i] << " " << i << std::endl;
        //ASSERT_TRUE(experimental_relative_error < reference_errors[i]);
    }

}

