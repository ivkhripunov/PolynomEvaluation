#include "../src/PolynomEvaluation.h"
#include <gtest/gtest.h>

/*
 * Theoretical absolute relative error is calculated using this expression:
 * ERROR ~< (100 * PRECISION) + CONDITION_NUMBER * (100 * PRECISION) ^ 2
 * where u = 2^-53 ~ 1.11e-16 -- unit roundoff for double aka scalar
 */

TEST(POLYNOM_EVAL, TEST_1) {

    Containers::array<scalar, 11> coeffs = {1, -10, 45, -120, 210, -252, 210, -120, 45, -10, 1};
    Containers::array<scalar, 100> test_points = {1.33300, 1.32987, 1.32674, 1.32361, 1.32048, 1.31735, 1.31422,
                                                  1.31109,
                                                  1.30796, 1.30483, 1.30170, 1.29857, 1.29544, 1.29231, 1.28918,
                                                  1.28605,
                                                  1.28292, 1.27979, 1.27666, 1.27353, 1.27040, 1.26727, 1.26414,
                                                  1.26101,
                                                  1.25788, 1.25475, 1.25162, 1.24849, 1.24536, 1.24223, 1.23910,
                                                  1.23597,
                                                  1.23284, 1.22971, 1.22658, 1.22345, 1.22032, 1.21719, 1.21406,
                                                  1.21093,
                                                  1.20780, 1.20467, 1.20154, 1.19841, 1.19528, 1.19215, 1.18902,
                                                  1.18589,
                                                  1.18276, 1.17963, 1.17650, 1.17337, 1.17024, 1.16711, 1.16398,
                                                  1.16085,
                                                  1.15772, 1.15459, 1.15146, 1.14833, 1.14520, 1.14207, 1.13894,
                                                  1.13581,
                                                  1.13268, 1.12955, 1.12642, 1.12329, 1.12016, 1.11703, 1.11390,
                                                  1.11077,
                                                  1.10764, 1.10451, 1.10138, 1.09825, 1.09512, 1.09199, 1.08886,
                                                  1.08573,
                                                  1.08260, 1.07947, 1.07634, 1.07321, 1.07008, 1.06695, 1.06382,
                                                  1.06069,
                                                  1.05756, 1.05443, 1.05130, 1.04817, 1.04504, 1.04191, 1.03878,
                                                  1.03565,
                                                  1.03252, 1.02939, 1.02626, 1.02313};

    Containers::array<scalar, 100> reference_results = {0.00001676649698063893054717344900000000000000000000,
                                                        0.00001525556176801552845313919069987423155670401849,
                                                        0.00001386829423082166304381656073207781644307301376,
                                                        0.00001259561375535855268091810142176341349182475601,
                                                        0.00001142902859999423031111523482886550872888705024,
                                                        0.00001036060285388417872160114078674455088369140625,
                                                        0.00000938292495534294004732059969202580562904679424,
                                                        0.00000848907771040413796967404875743869628767313401,
                                                        0.00000767260975382314121600617439234315227497496576,
                                                        0.00000692750839646001861311495918807033820723565449,
                                                        0.00000624817380463081656267319358938104490000000000,
                                                        0.00000562939445863285688814902366143094692187677249,
                                                        0.00000506632383923503404785311134580282846322098176,
                                                        0.00000455445829247731321343540617159670853603712801,
                                                        0.00000408961602464512217381234148043451644986778624,
                                                        0.00000366791718077441793743344776971153761728515625,
                                                        0.00000328576496150222076730289468868722654077517824,
                                                        0.00000293982773450567168956430546922812682918298201,
                                                        0.00000262702209817051176404430706937050579536331776,
                                                        0.00000234449685649763009023965998553486210613872049,
                                                        0.00000208961786559431014113242748037365760000000000,
                                                        0.00000185995371340534806623546881004241726607673649,
                                                        0.00000165326219561864958071454884932769299864830976,
                                                        0.00000146747755193056145561152123771825561374711001,
                                                        0.00000130069842807838694141333773634322424711348224,
                                                        0.00000115117653024159918978203682689762115478515625,
                                                        0.00000101730593957953038248934363140701161783092224,
                                                        8.9761305581210432879404491812341162005764001E-7,
                                                        7.9074713986182424896886121616947873081982976E-7,
                                                        6.9547142666005281873409682193210269323059649E-7,
                                                        6.1065478027895580329588167582484010000000000E-7,
                                                        5.3526386458265125682530065106615074370071049E-7,
                                                        4.6835580359744079985910965873205026436939776E-7,
                                                        4.0907130678182540956103806771255309388430201E-7,
                                                        3.5662823533265296236284719650609992240333824E-7,
                                                        3.1031558659453595151432898820000349619140625E-7,
                                                        2.6948787454594285981926136268276400729882624E-7,
                                                        2.3355988521743309662796108329085916266350801E-7,
                                                        2.0200178675570070430446521088326273218610176E-7,
                                                        1.7433457468174369919550227893644748105848249E-7,
                                                        1.5012583370291143190725814083594240000000000E-7,
                                                        1.2898579822712922775247294728259856696149449E-7,
                                                        1.1056369449358529687259883980753131418264576E-7,
                                                        9.454434797791698107557662797420714412230401E-8,
                                                        8.064504045177932716722788511429054561255424E-8,
                                                        6.861260177694624080128048257061701650390625E-8,
                                                        5.822072219311057693762451758097270995969024E-8,
                                                        4.926747151664195918850580730519669731098601E-8,
                                                        4.157301230505738695597955325043738988773376E-8,
                                                        3.497749465918728262904135866014869438557849E-8,
                                                        2.933912093230604752340043847656250000000000E-8,
                                                        2.453236919316893101883452943888061964788849E-8,
                                                        2.044636484828356878644161891524984099045376E-8,
                                                        1.698339036817240940885409736067679455871601E-8,
                                                        1.405752358317892038858023302036342495233024E-8,
                                                        1.159339551686344082105990083345746572265625E-8,
                                                        9.52505920955132518774020261087397805031424E-9,
                                                        7.79496145146409710846592463761222657447401E-9,
                                                        6.35300979441119978971362405982544161432576E-9,
                                                        5.15572764357308762365044893475786443108449E-9,
                                                        4.16549064679334724064351082250240000000000E-9,
                                                        3.34983799834576260265667545731171888469249E-9,
                                                        2.68085265767924375492294852787426511922176E-9,
                                                        2.13460485149681893634614209550284939513801E-9,
                                                        1.69065358002194119323914486153584520986624E-9,
                                                        1.33160118577367975422181853537796884765625E-9,
                                                        1.04269636593944951435323512746772102349824E-9,
                                                        8.1148131782727535183458827201030761237201E-10,
                                                        6.2747900122668796886458784751674799947776E-10,
                                                        4.8191678213570081743241338400043111020049E-10,
                                                        3.6748298954841974896829019906010000000000E-10,
                                                        2.7811317117118462181239506598164489270649E-10,
                                                        2.0880307537223152038302766037867063934976E-10,
                                                        1.5544561569819179269873223272208661717001E-10,
                                                        1.1468929123780610651025308734045398836224E-10,
                                                        8.381574130652446670078968906402587890625E-11,
                                                        6.063430669268293579091474159483930804224E-11,
                                                        4.339165237419096331166356187137248708001E-11,
                                                        3.069467851162606645962768711767630078976E-11,
                                                        2.144510797681142179532207088203327412649E-11,
                                                        1.478429001284303376457562613760000000000E-11,
                                                        1.004690116963284848615143239565874873049E-11,
                                                        6.72235674583878853116781472954968523776E-12,
                                                        4.42286892105850429509690058258567441201E-12,
                                                        2.85720190886697800509534019477594701824E-12,
                                                        1.80928012917528538810481338951181640625E-12,
                                                        1.12090291497512552247991427100606874624E-12,
                                                        6.7790896130747938179018105473648499801E-13,
                                                        3.9921592075026002783359574493207986176E-13,
                                                        2.2823557735538029472299264376695006249E-13,
                                                        1.2623321727659510109666068490000000000E-13,
                                                        6.726148681208320699217728782814556449E-14,
                                                        3.435451473632526964034578771477528576E-14,
                                                        1.671770311071942231619946642316046401E-14,
                                                        7.69268673786027635855775293504103424E-15,
                                                        3.31585355680020247074923367666015625E-15,
                                                        1.32283406222095737502667401696641024E-15,
                                                        4.8083476557715974406625985443652601E-16,
                                                        1.5593629723875900694168127888229376E-16,
                                                        4.382847176545605626845729158120849E-17};

    Containers::array<scalar, 100> reference_errors =
            {1.110000351035477232305809522771097500027960895061198307611038568746704004641507666746781825661935026E-14,
             1.110000380657723668249221308900803873204200379303414037172452823801028949075463261956956939257518930E-14,
             1.110000413144019992794828820079582630827913276358946938583241416073272593017428933894497969842582037E-14,
             1.110000448806348625933428184345446010240771090287945937846122624263406012890145612447293408620063740E-14,
             1.110000487994507969290819473475451137806694482654669627584908992960202539924027307776288244295531647E-14,
             1.110000531101164168625910658318319063078442398269452083300099171465830735926297305386879179022607796E-14,
             1.110000578567640935473051042265960003293377840712237747907391710425080905875237997265155071959485420E-14,
             1.110000630890564614127512645882065869229819553955264449466583977882796034435440563455459849856693107E-14,
             1.110000688629501794330174477556237535943160728553957626900989604591046241239939712515621723906614103E-14,
             1.110000752415750599637110653968073870023894558641356873448111122157044861731111279224043921867348553E-14,
             1.110000822962475062313092691720110494135409280716046372106490585135984406787291461293631364688193303E-14,
             1.110000901076405619080234868107303001878214433149359405357726940120579082085994226828874131958458989E-14,
             1.110000987671368810346809515039244324397194373159085795377644334220500889095585089688011785622313326E-14,
             1.110001083783957055031053939051910811973515054654017945571360963756733579058399342786757337352786222E-14,
             1.110001190591706508424439606342854482724398254784889521622725048622305495215917899936904648775450917E-14,
             1.110001309434219451857640323870256705920736600511004426524627019678795619559129077787475709787157124E-14,
             1.110001441837749809828952320886110637460042772087323168016640614202623105802576573198654015655251434E-14,
             1.110001589543869186754481386129293555259613220446596024668335487058006059316375506609244840563426131E-14,
             1.110001754542949881730062198323607431095679311768514230000063290306424451243892817110453379302320409E-14,
             1.110001939113345137406407894598831763500285906102681981572942259928593857096162518356740964600795885E-14,
             1.110002145867320920247335939792188996430750155629339947347075325364766210400988025648642957409762137E-14,
             1.110002377805004639855643053796521038633817342599091032736890411364465717113730377178610981506846104E-14,
             1.110002638377872868262096366545617157933921453626472589378578427010217719709701474955056951474048885E-14,
             1.110002931563612861624555616367197483504286109755064270226501242773762657006639196036523744045894948E-14,
             1.110003261954574674644275682020111557389267461756298454320247292270806064602238972056085987015234611E-14,
             1.110003634862498352967973545457077831792490344989741054509718672762854399785055233659872844722513154E-14,
             1.110004056442774739081427848929055409530736374008103434574283139969499167213663795972003876743301071E-14,
             1.110004533842204804948331139208026231221584716111916372947079669953844640839770045372154555856208624E-14,
             1.110005075375093891316159511381189384434842117343925527012574693154441094803348091377330918247440395E-14,
             1.110005690733595234115199969908335647401096490529148915730387522232121221379607323111585423905631217E-14,
             1.110006391239554278260678491348612070526459644654906010649373299452641812552105616615655605685047771E-14,
             1.110007190146768442139156538434841807557166170942100112294682321034319634766585848300480637229243840E-14,
             1.110008103004651639024437277673180644382272986963266345778588735801092360051630343478328831263956237E-14,
             1.110009148096888404832958508323432096359447278030030507829049390930110710702170273380415800679031578E-14,
             1.110010346971919520698340633179556610109331752326865294593712125835421720677483417287187270783382000E-14,
             1.110011725086200815690192986613549182904444807031083123744039386632041587084659115160501338646360174E-14,
             1.110013312586353887897266032837902198124767150953003329988908177101420066520389696630554282508650398E-14,
             1.110015145262886238321633680768468461032196123311069770863729951362802240607223151042880950616573046E-14,
             1.110017265716495475012809534887690285618414496291633408520183472825035826254528698378099347103119325E-14,
             1.110019724788606668511286460828303212904573082203371341994050493328539830947474081280831086427190329E-14,
             1.110022583321404856328514752252010222946364479463967609945968635260547788935209398174304231769048182E-14,
             1.110025914330114078782337886465683257153378305031007103813244512780300066604482073556774650873948647E-14,
             1.110029805692828687887838907501374515876173523536035136653641387728687999543600511837280540083320303E-14,
             1.110034363492401650963801980956436941370158011456876493486587618523178697894031678794162617409498751E-14,
             1.110039716182846763378705396273008133369956347012346334601871476029432411707535585335789328692158409E-14,
             1.110046019802244294430058325593570990431952459447235475386945374960399842480580301848740995562677411E-14,
             1.110053464519060755610618269562468648355430231455147437250769581745074855790974384182955730908284391E-14,
             1.110062282884256932073705259226225715805436223801809141359456412651877801364892048326536200887103523E-14,
             1.110072760274572944302129063532164793804021209836237844706802749461909952826298936305762737559626252E-14,
             1.110085248162524861579328068156329336513957910846743459713128332711246315562728116091664552274372846E-14,
             1.110100181049086707393170299991737093090302438656682865314458284189191286792670318834017722469131840E-14,
             1.110118098163946635712246520699067841343599647911342954708284446410278804889335627062092474832866815E-14,
             1.110139671400872513962005131690012118632803102254882389546845422671981748965497686289817454375346536E-14,
             1.110165741447384218305788154318611683043676518308609385847995580497539339559509293006402451383524501E-14,
             1.110197364738195926920042169670251043180556501949082770783268838759666971037453945232778755668740295E-14,
             1.110235874780883842834066670025868728793243670160592574687621596360580828280367169396220103728635728E-14,
             1.110282962669747565952381170980211147185381734012362151890930327209115591059136143751700334288565467E-14,
             1.110340783362833174608988538726043760275845161334209098268722689824891630771819881047202690041818362E-14,
             1.110412096753800769918643828600004864975478250631391944520620394497235294664720875755954177004752993E-14,
             1.110500456024362167318391451971112644643827376240973158194672054045217097964015974754519078213881777E-14,
             1.110610460652914248053721288567285042923303532806332758455499867815899942838753695289314242364954289E-14,
             1.110748098427575281818270014865529465152787277324802285925218508068617339084321237352314778207442880E-14,
             1.110921210828851810915889985286148562444663086838056189741615748736799364949257582760197015534745473E-14,
             1.111140130650667550260527634726948734087606296423118693023583889602332877054909241925594437551632443E-14,
             1.111418561899612454213212872033155517492410454414753281652718375371545284829378952442801427049668290E-14,
             1.111774803180254646513648396105335229399313676430779717451711679960517065453944698706205328621039331E-14,
             1.112233462069454542322955397031788572604641223923197602104686596983935730800899814411452889500408438E-14,
             1.112827877389477296026261694730396800730942629591160646581826178452090204604089550733247675743142977E-14,
             1.113603571365655205558537045325251264625844298155673598631026806287065652909342147269404675545538024E-14,
             1.114623214364967071194215951528411101403574840584007735161535995769102268959626769780979555007626655E-14,
             1.115973833367218448136103533892075893376775926508811659915382054977716591581422364269440578033535155E-14,
             1.117777383787432693749186900593389052049540855797811609594047794675811421951367601889413742528160272E-14,
             1.120206418907490914498183534667277630511006878167621950955034315471440764578329172354581761578620811E-14,
             1.123507575927736064416274719405891165632674122766935878771561949905923059584563465883595338535384137E-14,
             1.128037196388614209367332193474039185042763969186439318116385484356849623571129726009826243722431322E-14,
             1.134316030807640745295622704128673300506109532310295740327478599630893533538005225886962256054311455E-14,
             1.143114375406620906631310757576518473019339971680448267384950005026296167321179089813414927557896017E-14,
             1.155586453974042407395718935798285039994344793605808506529917704515940568879061390353644524743879613E-14,
             1.173485742658863925778834544048772745659227246069034794958685944257271110397448693745653253941869127E-14,
             1.199515573560528764838836144540672220217283157824312433445955023617788503770305699086756693960085571E-14,
             1.237909889843605926605281197705548804466292694167418380490242695301223467719259920928872731063906444E-14,
             1.295413102200369363883594318197916246058735501640460244985241195844634989201230485710037722270811536E-14,
             1.382966346649568949505970657999608732489359209923556195029346927879089112655079592527562727327396809E-14,
             1.518671958100054258914823198244915661374208961781397348265665002711762376061558883919618137983334889E-14,
             1.733126642733318216897451958990547325780721938287236906867388610423755310071653110397719836070797074E-14,
             2.079259027850469209036708052247112386365761936220855270006930435741769521371037275447931091826931324E-14,
             2.650976894204413393425733176967122237218259919400596894235000866104556376737622378737714833339703450E-14,
             3.619581004728915245060234721675680120224144040215641082950146372445179105867790703408650276781735487E-14,
             5.307234066895590092303402450864219217340901794930829832110136722560812938796941578722999251155652758E-14,
             8.340629305139281798773823693593633854735946367864361854337156660369637285142961712402008380488214911E-14,
             1.398550010434659224389229904504842636095589133690814465582110314026959978502148351982825719156153916E-13,
             2.490794743153616606735770654360283212053924784242793482506047750949789133096518434884731689004183232E-13,
             4.699600090182431636723859838550698111154751321677624175680448486161454002415521147712142274915856020E-13,
             9.397141769896321045360490429215903536953876821978785210080540751888121818554261011337130488388227081E-13,
             1.998437173411237660875493742736041921559025309231860504862993763226960248646790228181595518296758216E-12,
             4.551370324406887274472598298136044353388413614430733331625693280709781808811717380234352603531276930E-12,
             1.121808693940624933417087130616875630504680604868015623111837425458507916732908145640597088992811986E-11,
             3.037134396162815519836405611664966174628659594385655289119289713014740147247503368075746596611700194E-11,
             9.219401812757442111164235304979389076633547251278132887997655465313829998668563614495668138496370422E-11,
             3.229553308255410950342129688819246976465708835431169429904926919168351876803163423153353941049911738E-10};


    Polynom<scalar, 10> polynom(coeffs);

    for (indexType i = 0; i < test_points.size(); ++i) {
        scalar compensated_horner_result = compensated_horner(polynom, test_points[i]);
        scalar experimental_relative_error = abs(
                (reference_results[i] - compensated_horner_result) / abs(reference_results[i]));
        //std::cout << experimental_relative_error << " " << reference_errors[i] << " " << i << std::endl;
        ASSERT_TRUE(experimental_relative_error < reference_errors[i]);
    }

}

TEST(POLYNOM_EVAL, TEST_2) {

    Containers::array<scalar, 11> coeffs = {375000, -1231250, 1709375, -1341250, 665250, -219470, 49024, -7350, 710,
                                            -40, 1};
    Containers::array<scalar, 100> test_points = {5.1000, 5.0991, 5.0982, 5.0973, 5.0964, 5.0955, 5.0946, 5.0937,
                                                  5.0928, 5.0919, 5.0910, 5.0901, 5.0892, 5.0883, 5.0874, 5.0865,
                                                  5.0856, 5.0847, 5.0838, 5.0829, 5.0820, 5.0811, 5.0802, 5.0793,
                                                  5.0784, 5.0775, 5.0766, 5.0757, 5.0748, 5.0739, 5.0730, 5.0721,
                                                  5.0712, 5.0703, 5.0694, 5.0685, 5.0676, 5.0667, 5.0658, 5.0649,
                                                  5.0640, 5.0631, 5.0622, 5.0613, 5.0604, 5.0595, 5.0586, 5.0577,
                                                  5.0568, 5.0559, 5.0550, 5.0541, 5.0532, 5.0523, 5.0514, 5.0505,
                                                  5.0496, 5.0487, 5.0478, 5.0469, 5.0460, 5.0451, 5.0442, 5.0433,
                                                  5.0424, 5.0415, 5.0406, 5.0397, 5.0388, 5.0379, 5.0370, 5.0361,
                                                  5.0352, 5.0343, 5.0334, 5.0325, 5.0316, 5.0307, 5.0298, 5.0289,
                                                  5.0280, 5.0271, 5.0262, 5.0253, 5.0244, 5.0235, 5.0226, 5.0217,
                                                  5.0208, 5.0199, 5.0190, 5.0181, 5.0172, 5.0163, 5.0154, 5.0145,
                                                  5.0136, 5.0127, 5.0118, 5.0109};

    Containers::array<scalar, 100> reference_results = {0.0000293601000000000000000000000000000000,
                                                        0.0000277610805833766714694083382077994401,
                                                        0.0000262361344228801457765533768846746624,
                                                        0.0000247824371751445276575220665828524649,
                                                        0.0000233972490322997882304634446834302976,
                                                        0.0000220779128755806601853416273447265625,
                                                        0.0000208218524550031150254002144317080576,
                                                        0.0000196265705949141171051424928806260849,
                                                        0.0000184896474252211145280063648955367424,
                                                        0.0000174087386381084907445226302398618801,
                                                        0.0000163815737700489629298554010000000000,
                                                        0.0000154059545089186739194993068826559001,
                                                        0.0000144797530260254836448150436864589824,
                                                        0.0000136009103328607236372880113850177449,
                                                        0.0000127674346623854342631595655962469376,
                                                        0.0000119773998746628589096720514150390625,
                                                        0.0000112289438866497223718525859765682176,
                                                        0.0000105202671259595721858017900191466049,
                                                        0.0000098496310084122116221176234520372224,
                                                        0.0000092153564391840014926364398283952201,
                                                        0.0000086158223373745548363786240000000000,
                                                        0.0000080494641838060939377100004120852601,
                                                        0.0000075147725918724829925378808068097024,
                                                        0.0000070102919012556920781174438661719249,
                                                        0.0000065346187943281889000153898628939776,
                                                        0.0000060864009350604940872287750244140625,
                                                        0.0000056643356302538735846528873740747776,
                                                        0.0000052671685129188779522982626183040249,
                                                        0.0000048936922476211731241387395224961024,
                                                        0.0000045427452576168404074951034848454601,
                                                        0.0000042132104736000552176876490000000000,
                                                        0.0000039040141038867842435911907265195201,
                                                        0.0000036141244258588694289629532571828224,
                                                        0.0000033425505984935943332526557626190049,
                                                        0.0000030883414958045541053102637599794176,
                                                        0.0000028505845610203744652455906728515625,
                                                        0.0000026284046813285477449304809197797376,
                                                        0.0000024209630830123751875339783200343449,
                                                        0.0000022274562468097243523089629600973824,
                                                        0.0000020471148433230286138705106461406001,
                                                        0.0000018792026883106723866869760000000000,
                                                        0.0000017230157176906208467098074622306801,
                                                        0.0000015778809820878665642626542691943424,
                                                        0.0000014431556607579776067597061952229849,
                                                        0.0000013182260947197423177927008191512576,
                                                        0.0000012025068389306151318809246103515625,
                                                        0.0000010954397333393754429841075562750976,
                                                        9.964929926511177109996506948335649E-7,
                                                        9.051603146403956651684160941850624E-7,
                                                        8.209600068490466478626338630486401E-7,
                                                        7.434341315059238378906250000000000E-7,
                                                        6.721476685064643004912866237307401E-7,
                                                        6.066876962907195328719216914202624E-7,
                                                        5.466625904591724107313030326078649E-7,
                                                        4.917012399663601939711257246974976E-7,
                                                        4.414522807330175199985068369140625E-7,
                                                        3.955833465181461019252216955928576E-7,
                                                        3.537803368931091578412053985576849E-7,
                                                        3.157467021605384274457816534631424E-7,
                                                        2.812027450615299849253924577775801E-7,
                                                        2.498849391152919333365760000000000E-7,
                                                        2.215452634360924671528607661717001E-7,
                                                        1.959505538730407173293955061965824E-7,
                                                        1.728818703189152484948017743576449E-7,
                                                        1.521338800349360619612025311461376E-7,
                                                        1.335142568390554724159311025390625E-7,
                                                        1.168430960060212716873439616050176E-7,
                                                        1.019523447281421711277326492227049E-7,
                                                        8.86852479863606261938390091956224E-8,
                                                        7.68958096819117939952081015754201E-8,
                                                        6.64482688795195581878490000000000E-8,
                                                        5.72165910137512768806994977455601E-8,
                                                        4.90839739108221694604908664193024E-8,
                                                        4.19423684788080586920675542163249E-8,
                                                        3.56920139198915263813184008651776E-8,
                                                        3.02409873189314255619049072265625E-8,
                                                        2.55047674633091208502126524235776E-8,
                                                        2.14058127496668025706884238046249E-8,
                                                        1.78731530338137407512423384065024E-8,
                                                        1.48419952807354133909755123301601E-8,
                                                        1.22533428722980607754240000000000E-8,
                                                        1.00536284308973853230731020843201E-8,
                                                        8.1943600179548357563770523444224E-9,
                                                        6.6317805668181865662018632879049E-9,
                                                        5.3265404102749500457780616626176E-9,
                                                        4.2433827635375398741895009765625E-9,
                                                        3.3508420242080435954187228005376E-9,
                                                        2.6209547513779576323027750394449E-9,
                                                        2.0289831866642939607103070797824E-9,
                                                        1.5531511806280835131154721698001E-9,
                                                        1.1743923886644790478010000000000E-9,
                                                        8.761106010954008754560806599801E-10,
                                                        6.439520728359737442287483879424E-10,
                                                        4.655897186448736126315932363849E-10,
                                                        3.305190406061402523681843864576E-10,
                                                        2.298656551260168854298837890625E-10,
                                                        1.562042873629526369930865278976E-10,
                                                        1.033891016420487430096682231649E-10,
                                                        6.63952370369464542128733594624E-11,
                                                        4.11714179324446918413650623401E-11};

    Containers::array<scalar, 100> reference_errors =
            {2.532103694728049163915385165581861097203347400042915385165581861097203347400042915385165581861097203E-14,
             2.612484059995081789848722277427354666432695493998803598338405062469340678961136072287801965761194035E-14,
             2.698194876502349819905980147384622748505842470361528139746293366748175951660498633809427257045284697E-14,
             2.789642965567032646612935947550514188016122997749778222496241282801534133559198935560268822594673494E-14,
             2.887270352577090043128133308751987992857454288357574219641776244448775774707488128219463779134953864E-14,
             2.991557680329192053493238254791046790409839963280672521071219838085015817529510301274322160851149151E-14,
             3.103027989625051387343343664753335616184925586158860037506304561141379853822471559602563739055503106E-14,
             3.222250910627041488549644221872112458324518041519528028137842253255002860637040960629878076596658287E-14,
             3.349847314108253355722708074561198811964839111000649596184688417064375854650450717238965281128811211E-14,
             3.486494478159831929428970556796613056538900925328412161273465450716822402848026168691405899335084365E-14,
             3.632931833260416426190054882996744972308850942086221555939865344046657541604280562290582668296749545E-14,
             3.789967357009504913299995314124591686212481793593738066947650614397797953281465465839970768915768248E-14,
             3.958484699442620967112327291960123875364983462749935318746641328928766088059917235660140191507290068E-14,
             4.139451130872814054837852771791690736624826267262569681394725790792236042256127580718627648086880774E-14,
             4.333926416864238422746100629022825715367729899691203234337201266486307955342568225064098759783285693E-14,
             4.543072739501613630374006614822823539540102357896986475936482140930998966246934745513720076015112258E-14,
             4.768165800881922728951123218501006903974805541991036861991905038743337083201329333017679546562395216E-14,
             5.010607264083189012922828134557504374564153581278017568387467376186010198235279726599274959792873130E-14,
             5.271938709184914574281080583439341148310526695127210617121665515025836533950301142498600497206032130E-14,
             5.553857307727105804229799797429309937777358097492550422266459351330557273818588645212676338234751535E-14,
             5.858233448891706065984297370511586328346532029827502196603770970167351376247453445244668063530710726E-14,
             6.187130585371863139954697095257452509309612743211696978413338738908460857896898165249927303922724851E-14,
             6.542827607190395902359884434789245799538942497981419431017563386588494944019827411864371040590523632E-14,
             6.927844098623889002323834274085772922163659656772824693182373562964301717866668024720825338355763392E-14,
             7.344968888054211808955055224196077602476015511025494920494659359709769481534761301866783122558727265E-14,
             7.797292364400397673920261663014398648496764721213557300384954341769772174178913167450923553809788401E-14,
             8.288243108446673381649282904469245448371075908175928772672257467248495744096048965057964055919701455E-14,
             8.821629474869778470791857256125510565347954338908108168907475039677215926345826333834315295452064913E-14,
             9.401686863469138871403195772292727417357740098044293818350726536805312042145138033100315037061830578E-14,
             1.003313153888588600355933959862167717158945960357059207704140188790295745411388004802690334372489997E-13,
             1.072122200041433019138983720120833450235719069342723503543653139114291400402049923526740146005105430E-13,
             1.147182907152777417551595341525569156205053678854602792046723563316382631279285212541133767377003304E-13,
             1.229151607749533315751839605064294429810377916369796392357984013537469953330185317253998514957206287E-13,
             1.318763071505966773339049782237512232908531588970996960684946686917086476532442471840525788582950450E-13,
             1.416841049798825694146346112067285574310949338738554390989847348653230281346949818873554935293395276E-13,
             1.524310399542548887576506434366257928371860733010673640297320765868581111182946009453825581309111473E-13,
             1.642211047737060724490974833805319044840892079306903181509260927273805931897253277634997939836174013E-13,
             1.771714105675946793020529316656585626013392914045637721664420643811728636363336277767210835039367748E-13,
             1.914140498706149523651411715649591395228819626163204940440215441729776500784767652442032307871516435E-13,
             2.070982545834148540958134170865132063169716672964298856440430009950629214950499160682380252279776581E-13,
             2.243929005844338956412903131845779894849223435196297546002930017307379067334106749731886481167684797E-13,
             2.434894206032606328618399501129777375253893864808041617055954866329019981517595494650518925829458245E-13,
             2.646051990006058921134524594083305704105828395254544356531655817714476062334595309816718903413973769E-13,
             2.879875367040033524664582646601935247182166423038920927978039093984399361495446283140744061214466468E-13,
             3.139182923181286432500604182451471243784339068074589973137042141170905437234419532551399326989615123E-13,
             3.427193271107365139103966368321764228089178269356857538032215404254146924453871048975345819975600662E-13,
             3.747589081069519481154363532971502083629483278760306877988341281593739813688216797386657497386129859E-13,
             4.104592560866483237143654964232407445791924067186543985758463592395785402476732851666041870700349289E-13,
             4.503054653640787680643185237677450722938635461761976390525221828104478203434867939964159770296150875E-13,
             4.948560717282981692128079081263403265251721888346923529879078693003021043256611274362948379935410264E-13,
             5.447556062460792114575268489423713455417108057759932816083763177241383683050363626836714101506328776E-13,
             6.007495488534364990256222765583044229842434000829329796009079576554916914138298361172320695822796816E-13,
             6.637021907341641662550092153021580219190947945227414669817180262405450543952198287917992619310454845E-13,
             7.346180334852262551775929387779864408813217437022742436361672739376098452116379548932040972705610770E-13,
             8.146675025681207438245315778795761801550359181422860249507264563556971926452785063954207825861352676E-13,
             9.052179410697276147962545574698679611581615068482084994050019883129915264546984702370441596457752222E-13,
             1.007871088463519379406129707148491106817852417174185353183633950326790622045357802093449615007753203E-12,
             1.124508552432982838894215971980250890665939592178914397552781875382992706525553105759090804125599338E-12,
             1.257347169051747563644435048906030592582424754156932450548177457972301910237874999639177084621496261E-12,
             1.409006643037653960611328455102862977704298695701924480141162291998964597204947244124970658290910024E-12,
             1.582592499063765728283754493497341317416299334274592406684264888463100877211717676161782515498579066E-12,
             1.781798202162552831721703312225271916640613829982696686559912803324655338582631108259625801993616573E-12,
             2.011031380446230416572264139661795616252934388795889328053143574691171064577616697475627120471734590E-12,
             2.275570488162799375416712813828411291387615209768058438040055442853268176095245571793806642461072618E-12,
             2.581760092154321930671941875868972678382090610412455537303059362614525583993525827350444368353471300E-12,
             2.937255401227911101724115369704526972963645301904320371865369970858278701400020466831579545938063434E-12,
             3.351329893562434764420564359070227441560391858879664295511895591556293374605549877255535759268338245E-12,
             3.835264219523132230783550500391070344497518809133755593902369121501209544164835699670387912184030641E-12,
             4.402840366572026033787221953129629027742753771405662770418343992753131235538742665255211401894563508E-12,
             5.070972931066908616091209468423534552946308607853636573358581392893365574153804676706257237325228618E-12,
             5.860520042434246524361398656109841744260195066133951551943427317971720485045088974176543081097892523E-12,
             6.797331158886462643696419628121111302437044125627335747476840111444028599319405384677284463748994044E-12,
             7.913609223260990683476444097237888620699273270750544875742444784043156326221223087980043818404267765E-12,
             9.249692881832781066144691165603781070195243741077833091498836991222841708791493844044642711611757517E-12,
             1.085640405893796102011365854823740052975016253336429817753588283230488578010196049630125212830525595E-11,
             1.279816220311746958909167348195982601797799691806960399969164957150093215664089538887191514011626883E-11,
             1.515714650344242031294697936377699149161109467232275920447203190636915502820892708355419546543676012E-11,
             1.803890263640575949521812207084393523658434069236832548808370472877369419856429112607596969625277493E-11,
             2.157995834838895698578195105337317627628487437042244778773865094404595708481595560231768664711460225E-11,
             2.595825885463129008617054553990289082645003019411745300626166069107865274663138713720443669850413223E-11,
             3.140759979320111290259392747666397943179198704347416333556036394549796187314631975722930055380795708E-11,
             3.823778715394517818538708251360995197929140981206536980890208574058000533785515769326423035327218154E-11,
             4.686309376549543698116366193557438393487531296123641506979372066418260425944298283587285349271666339E-11,
             5.784287833551968636372206762928336763293126652828452624688980207153739963503332716848700060263219765E-11,
             7.194026164949804026896486040788211558516335489601799072783390112143803356647308648995807708871867321E-11,
             9.020797663947052048625696481575108031942574177324940965086477240339114152251340567322751653594452378E-11,
             1.141157092333100431373101177531516750467077393647673577952861577911324725561734100258151119053362680E-10,
             1.457417846142647598542726870413103504279064019064596907995998467853661506876886544927424395111591519E-10,
             1.880663314719105790279749930686460506329089579917154861476281052210010179345762602452986533174816133E-10,
             2.454274135642868978663518784098302950175270706717423405470443888200015623633177713307623056777253371E-10,
             3.242440707280734763368614968194557938529056900610706938703053955749184431526693052234607566220657085E-10,
             4.341859513352917671067312544212849362422563330830579175278603996045977443707389111746188391828484367E-10,
             5.901078228970010890992975362740127477930264944388386160717977612771524411764345192177196369032146305E-10,
             8.153280436076379215794818212549569973449696160028262022380372849718584653815832263098874071375283859E-10,
             1.147335999910159315081729788171423106190340400579041302616310594399805539864923580359146649549896348E-9,
             1.648028607378017550965093604656612531901459336252014695634424097591458070122870434960503452371642424E-9,
             2.422690329281902927613430569764499460779273383398076331360569664171002570483979320731954702248011614E-9,
             3.656523193278637777184744668630227352025818254026695492965896543689093613342102247073252755270053881E-9,
             5.687986539172095759365596729212427998674352135273097852531908576250792006374043673566003569729622657E-9,
             9.163305258950836701954424320351039100456308498467847202690148252187984135147621335527986717483415615E-9};


    Polynom<scalar, 10> polynom(coeffs);

    for (indexType i = 0; i < test_points.size(); ++i) {
        scalar compensated_horner_result = compensated_horner(polynom, test_points[i]);
        scalar experimental_relative_error = abs(
                (reference_results[i] - compensated_horner_result) / abs(reference_results[i]));
        //std::cout << experimental_relative_error << " " << reference_errors[i] << " " << i << std::endl;
        ASSERT_TRUE(experimental_relative_error < reference_errors[i]);
    }

}

TEST(POLYNOM_EVAL, TEST_3) {

    Containers::array<scalar, 11> coeffs = {2160900, -7141260, 9404521, -6549256, 2750668, -744320, 133406, -15800,
                                            1192, -52, 1};
    Containers::array<scalar, 100> test_points = {5.00100000, 5.00099001, 5.00098002, 5.00097003, 5.00096004,
                                                  5.00095005, 5.00094006, 5.00093007, 5.00092008, 5.00091009,
                                                  5.00090010, 5.00089011, 5.00088012, 5.00087013, 5.00086014,
                                                  5.00085015, 5.00084016, 5.00083017, 5.00082018, 5.00081019,
                                                  5.00080020, 5.00079021, 5.00078022, 5.00077023, 5.00076024,
                                                  5.00075025, 5.00074026, 5.00073027, 5.00072028, 5.00071029,
                                                  5.00070030, 5.00069031, 5.00068032, 5.00067033, 5.00066034,
                                                  5.00065035, 5.00064036, 5.00063037, 5.00062038, 5.00061039,
                                                  5.00060040, 5.00059041, 5.00058042, 5.00057043, 5.00056044,
                                                  5.00055045, 5.00054046, 5.00053047, 5.00052048, 5.00051049,
                                                  5.00050050, 5.00049051, 5.00048052, 5.00047053, 5.00046054,
                                                  5.00045055, 5.00044056, 5.00043057, 5.00042058, 5.00041059,
                                                  5.00040060, 5.00039061, 5.00038062, 5.00037063, 5.00036064,
                                                  5.00035065, 5.00034066, 5.00033067, 5.00032068, 5.00031069,
                                                  5.00030070, 5.00029071, 5.00028072, 5.00027073, 5.00026074,
                                                  5.00025075, 5.00024076, 5.00023077, 5.00022078, 5.00021079,
                                                  5.00020080, 5.00019081, 5.00018082, 5.00017083, 5.00016084,
                                                  5.00015085, 5.00014086, 5.00013087, 5.00012088, 5.00011089,
                                                  5.00010090, 5.00009091, 5.00008092, 5.00007093, 5.00006094,
                                                  5.00005095, 5.00004096, 5.00003097, 5.00002098, 5.00001099};

    Containers::array<scalar, 100> reference_results = {
            0.00025510516736005607997699800100000000000000000000000000000000000000000000000000,
            0.00025004237598910705224643498565992957797464254031617905100854383268120845990001,
            0.00024503015247368218830654632695379096069857201376991092513862844301256181761024,
            0.00024006850214617756396349660074903093207628813682731144337661151815562697569049,
            0.00023515743033926770596848549011306666884578185316896068412567040420992779288576,
            0.00023029694238590559965549376846120147101185822743975870577990783253808603515625,
            0.00022548704361932269657906974972996820248323123710952465575967148090527814706176,
            0.00022072773937302892215215620158093015235185529716447300594091423080900941985249,
            0.00021601903498081268328395771763987696159504177436419629816408009445485863501824,
            0.00021136093577674087601784854477626119503881179553711496160617004399885376774401,
            0.00020675344709515889316932086142762907419469525459813452758636250900010000000000,
            0.00020219657427069063196397350297370682307183600240409196819387524258079227414601,
            0.00019769032263823850167554113016471201627184068896408897431969871964740307124224,
            0.00019323469753298343126396383660836725659534954564161381758444634875923918001849,
            0.00018882970429038487701349719132000144802684747257205806062589367991130608894976,
            0.00018447534824618083017086271234003186931780906032145284258485760070010244140625,
            0.00018017163473638782458343876742302819345791755157859482274993736013618689867776,
            0.00017591856909730094433749189780246753910985116515181716653334226982871291410449,
            0.00017171615666549383139644856103519758158502658748209925559460623346721048986624,
            0.00016756440277781869323920728892953269315576471303461314934947697453730512247801,
            0.00016346331277140631049849125656081602543363381103978826964070809610240000000000,
            0.00015941289198366604459924125837818839019426613887115137534891504233520524968201,
            0.00015541314575228584539704908740621273939577153861917969052812176636397480551424,
            0.00015146407941523225881663131354491099022102166989680409960516356998100442723649,
            0.00014756569831075043449034345697167788677358717534162967762776329491795071205376,
            0.00014371800777736413339673455264844453657301317241101553382590293979644775390625,
            0.00013992101315387573549914210193737220722745194264748806420811097858592257893376,
            0.00013617471977936624738432740732826491661047147437216428489151729251603977604649,
            0.00013247913299319530990115128628079729853416053349154800370503282497143700455424,
            0.00012883425813500120579929016018456217529249111652684423465182995501394345290201,
            0.00012524010054470086736799251443985021854731340684342951941347228690490000000000,
            0.00012169666556248988407487572566198203084438263611993074356660919741011994970801,
            0.00011820395852884251020476325201192093157848747510011567390715119683503992602624,
            0.00011476198478451167249856218265580268347510166736509784857931707073030898774449,
            0.00011137074967052897779218114235592634862105050399681967493093300410104740299776,
            0.00010803025852820472065548854719565841675850734232501368250490757581887197265625,
            0.00010474051669912789103131120744061030295524862520746589167294477484712946302976,
            0.00010150152952516618187447327353835726687953468523603024346433015891920075927849,
            0.00009831330234846599679087552125887476174028394763708204448307307752983293748224,
            0.00009517584051145245767661497197777617750240590319356446378385064158282173181601,
            0.00009208914935682941235714484410434390025328933500508832753411696885760000000000,
            0.00008905323422757944222647483165625356757954267707130484356945429468498592142401,
            0.00008606810046696386988641170598279935851318898528059650289479093793110495437824,
            0.00008313375341852276678584023663833611602366473915963630013853498065091918794249,
            0.00008025019842607496086004442740756206016619549243816264127301198266147380658176,
            0.00007741744083371804417006906348417381084845817885601991591589023687250009765625,
            0.00007463548598582838054212156580433340074592558343473575456656810457099493016576,
            0.00007190433922706111320701414853629492118195903540225851955182497905942507340049,
            0.00006922400590235017243964627572744640679160669384557564359944053816687826305024,
            0.00006659449135690828319852741310993052850821280772038808317000628826139871602001,
            0.00006401580093622697276534007106591562884938396481844144629882910156250000000000,
            0.00006148793998607657838454313475349659863362752643012333807469863185803993603001,
            0.00005901091385250625490301547739411306013111110249114219235339928824186770817024,
            0.00005658472788184398240973985272228028824152598271611837721423297928050973023049,
            0.00005420938742069657387552706259833626859900782934735672536052123816124523160576,
            0.00005188489781594968279278039578481625952851058343254390048311472994283212890625,
            0.00004961126441476781081530033388697419351998036573923721789239465209647570354176,
            0.00004738849256459431539812952045787822334617109226539674382214429616098406401249,
            0.00004521658761315141743743798926841568812701849956247275406104016861502249165824,
            0.00004309555490844020891044864774245074553818021349930899031740070006356070631401,
            0.00004102539979874066051540301155728588797369232340997166331327683061760000000000,
            0.00003900612763261162931156718640948653280272356853517786637801277298866822872601,
            0.00003703774375889086635927809294603584990816263203388803361208715039497698100224,
            0.00003512025352669502436002993086069496346028809635745835386240461095714401300849,
            0.00003325366228541966529660087815535163936208026919213368713328606092059241086976,
            0.00003143797538473926807322002156604854500387526823521257499624196285174306640625,
            0.00002967319817460723615577451415329014388407038252454644239924783898851609035776,
            0.00002795933600525590521205695605613526428950173463875810635571433125504689271449,
            0.00002629639422719655075205299440949035858396657857529328865769602514850098970624,
            0.00002468437819121939576826913842392644772618910924376602635015387184503530749801,
            0.00002312329324839361837610078562725072442936635803163773656631556852490000000000,
            0.00002161314475006735945424045526697176788331553155669327280140680815600073871201,
            0.00002015393804786773028512622487270530318721194426465865913629401387354422247424,
            0.00001874567849370082019543036597747541958599342670925735865692615672326645067649,
            0.00001738837143975170419658817499677414326674868691463797369292964596979126117376,
            0.00001608202223848445062536699526415024285283948891503923986233620548248291015625,
            0.00001482663624264212878447542622200612883316561714240111460224923497133822181376,
            0.00001362221880524681658321271576618969198190334453799672523031952812760821710649,
            0.00001246877527959960817815833174287591036026844284766198296224650810054329959424,
            0.00001136631101928062161390170859614103974640959227045083904918647128551718837201,
            0.00001031483137814900646381216516454018831246329121615750863897483018240000000000,
            0.00000931434171034295147084898962490706305913296213673556844949514217901734918801,
            0.00000836484737027969218841168758150266292792882297882069721439393059544721818624,
            0.00000746635371265551862123038929854768163945717250794202446368707426336679363449,
            0.00000661886609244578286629641207408137215291394832819963487767098938326464331776,
            0.00000582238986490490675383297375299761420725368561280579354498007947367666015625,
            0.00000507693038556638948830605337701691668840725911954796330766111297328429310976,
            0.00000438249301024281528947539496926107756944595773954573033080543055132787078849,
            0.00000373908309502586103348565045100521589177144636625438943463131249693345972224,
            0.00000314670599628630389399765768808988269528694102312821791598157776622584173601,
            0.00000260536707067402898335984966438395096411038670130943690703566744010000000000,
            0.00000211507167511803699381979077959697853176150998176757411467121355784612735401,
            0.00000167582516682645183877583626864773248592724699809145239738753661506576973824,
            0.00000128763290328652829406891073970355892792014838524538641106277852107644828249,
            9.5050024226465963931440182791327797582786330465542583309758957387612210176E-7,
            6.6443254180638529927416496176428065314463118560368979974157510232431640625E-7,
            4.2943516023639848526863523890250177641378922569204450664419691809080344576E-7,
            2.4551345615855383662904240816194114612956269770363577095964368672254336049E-7,
            1.1267278845587506218972495445840425488277046515515207770545984048232449024E-7,
            3.091851629056258182053928311013335552447656280721257656758178801534439001E-8};

    Containers::array<scalar, 100> reference_errors =
            {4.478117553125665635562034364340362103725609462228282919054754983299703674086921904713008499488935629E-11,
             4.566495121711398428484159046269282658157628753166892184639345372041519865830942986990659475165625312E-11,
             4.657587052540635971582318729082827206788728340232783076173708863370331155329383024858868935035535346E-11,
             4.751505693777959530438912266765158215349063742442765266183654910019939693440945774333365976004195715E-11,
             4.848369267876853204911453604368146058382446784836393073821454331897036989061519112175655397529286036E-11,
             4.948302244075498127457978864736651317342360264641109079326087261072608907991251036721442614667551184E-11,
             5.051435738745053752942849354955579363244089836426483058104302576257728497585520921796383277846976882E-11,
             5.157907945996287823318132317646372046471640031966296044289546946800714913264517824697862699714099618E-11,
             5.267864601186762716288988677874228903051817660864160189995464738796456683812670936176521582620770144E-11,
             5.381459480233214665015322771034703871318845837315461867688127850334318987998310673618315694310999668E-11,
             5.498854937925475364620152511194644909032717019181681187622434622855375436158944723723474932326232279E-11,
             5.620222488762917912781275796495183229996285524659874741791628288739006764143480629916444672807352352E-11,
             5.745743434196093900510042471758747879425694118362681629835596404651438186528128793361491501101556213E-11,
             5.875609540559671419208266117156077080127089391684551847380508407597774305805190764116582110725361372E-11,
             6.010023772433349980594188430051546332610328562184952608098725604924840973121192842214543524869910912E-11,
             6.149201086671243943741153910781689500245561092202416329169431429182725269187682209756602631469259486E-11,
             6.293369292904296280176747081275607187319487477660570286752894017310113394852444756906785906852174044E-11,
             6.442769986952632185476717286347408101144821045275054608107639232704167425066229459957541381842628112E-11,
             6.597659564294589571077706725971664732370744880814020476662974414600631759492199214293535999633895353E-11,
             6.758310321537043077264748344957120976079596526974145311134528964226867131783472947819982210327145016E-11,
             6.925011654729735669749829051663802802362440821611458672146769939219794810521058522617419632496159605E-11,
             7.098071364378669850644993506622685825555613603956794867136405825179030571673408221996078320697278982E-11,
             7.277817078156379794175753491729120560296748640529387727471881079371069906011642793787446891319456294E-11,
             7.464597803598832968994983794741510550875407395429422157247732508769566581771303198343569734793236559E-11,
             7.658785624541493562791678314554927828230969085450733408083882109999914501947154728561550897557472924E-11,
             7.860777556705908453088874751411858949422998462914993060915461594996039211065166838784504806141522864E-11,
             8.070997579732343622791920416918290729316658199294048324553603773433101166539745192222746501817392935E-11,
             8.289898865097639776049794995984316158001062774389620802463927856342970708268959795504902757844139293E-11,
             8.517966221800425101044153152312873824096186784224762007357888438399301036294684622273681378571226499E-11,
             8.755718784484747880120345936732205485114569590391424956392453455584327675381704493967151412071922177E-11,
             9.003712971862736475048028615164373106001488316382654706314398861653494348788524267053540963233588354E-11,
             9.262545746951283625214080991033383944980665304910243463464349258679849947446934673971751352376625631E-11,
             9.532858214832608482804493105956919963920288401111548603248061722443934444818903025482714790729267139E-11,
             9.815339598473118092313196836874787230141534426875238985292396114249471200901914444409460318114805598E-11,
             1.011073163869483584356244728141336160912744388137336412175187601549054914452968573735057803467274130E-10,
             1.041983347081395805070937956090002470003779204227920581459899140083314819070928534101529987463571593E-10,
             1.074350703789062208555346094858325285181026589437080681709263271559992250789479540556042788133037889E-10,
             1.108268310915001357731806459124998761519180749108374984419118726438214442628946465644102943688515794E-10,
             1.143836798214932693208333739583547522893517980542361848925426852804394054187973284214394251187913959E-10,
             1.181165095893157599582059749723220897050402798422475048491524296211863180594388913353520353171347377E-10,
             1.220371270003065896992991553070715801736332407293887793142750875518752915275038010712370368348903112E-10,
             1.261583457613964534339189576030230056899537209448259552933122140220368081406768231893437055791919934E-10,
             1.304940915596968624202812929842576990959563712590222611045399971411391555860470378757374121312055172E-10,
             1.350595199084800916487294896397998456688957360527002024450972267143814025021344054120189725976810762E-10,
             1.398711488258392226177375920619351784917087512984852447127184834422460750643575893523488160904533861E-10,
             1.449470085186903769347819650683684416761227403141279603354089273849550904437955826797229217311921503E-10,
             1.503068106094790461672150613954603272351374359115797874135507426137477531525179299335240798956071906E-10,
             1.559721398769634594455805075089337818508478728009322078044982040557647458749927042463321152953039850E-10,
             1.619666720005404046353477290623381569018383247382721749257153527164088434382797058545111138118989668E-10,
             1.683164214180244497427618313087947670243362699327606679005541278964139316173032062403031019674776505E-10,
             1.750500241522804256778179640459179044489765507215165064243419044545169964023018877293214770782174295E-10,
             1.821990613609317842263654330834451484116399353149368045679731031449424566303901003287530075438033565E-10,
             1.897984304509433394231536543203608029971602607212434093752048113887803374635256588866420268575367550E-10,
             1.978867719207418432679003939496517682916057654505455278218673172443773375082239796019036176217682979E-10,
             2.065069617029420487023384171311126486886312794700829856793032224476379512149798175936082228429727592E-10,
             2.157066807520665524265244455261769599010097529257708693764132400069571444693816621333324671290261362E-10,
             2.255390760448967646176852112789005962305128025825687807574611877607342178503211579876686633264327997E-10,
             2.360635301529049705922887084503367166552109407740240315078856305680643227354049514009736090581532575E-10,
             2.473465602568543567099206203696691479794041549623718065130809119452793114707961225992616320496869233E-10,
             2.594628720977613895616695615467052364121096745030620714977757872339555235161271705221927708795071013E-10,
             2.724966001495863909731986081439262072430401515063061527125053613544999085250961438800127819527272963E-10,
             2.865427725896327751359773023973315157291526748246431495776491729813743468969380553535199116125685868E-10,
             3.017090488710784182669141758394322986356200482430363858226788209275494830185004771408979251065493060E-10,
             3.181177894503489548160584623118751247274139056344299689501675319011000073576256586678153227956294583E-10,
             3.359085322682242180715821635343268573746137633053047987022362902100731777248073737626885456111129945E-10,
             3.552409699753276333618587661578654454000747908488566446475073089419801792573029872008945291131084428E-10,
             3.762985470515251083757025279391023577812153151248921270573163360272273145545595057883242006780988367E-10,
             3.992928288390998080066538640371172985181495417511810903381427088988189421315393124088434720116542512E-10,
             4.244688377733853703498665119444037604492999377111631989925652722280539739333576041168705303864079692E-10,
             4.521116094845731989767282259953938099624928998705980679983711097117608973344439060781207904170568835E-10,
             4.825542982050805655068415784875906651682809150241711106189147164803048521814463283339438780626112404E-10,
             5.161882644905888484548012921671511909010540816134110010915474957378437726586876344550787852519451234E-10,
             5.534757193240172100700781085592877971778026225814988401604382378000427221877744623934076860484023988E-10,
             5.949656927040341950378568914416014893940531292251604778861902254062962079938893515537768416275691322E-10,
             6.413143645550606468166004122780132462414314187589408686502000067309070678179531155991244373772313384E-10,
             6.933111750383301232049632840588068881981353787493429210417677490690605203714763954304747220496191438E-10,
             7.519126710591069778123991805368551604174903772222310711663454214963572715478126218312112713618257122E-10,
             8.182868239344354522073084103021712344987054453039340049476439772804319766011242050711740944495581066E-10,
             8.938716910320259390513219601230568280775544673989784637228463213870242370184527823752855479271766401E-10,
             9.804539834104052367313660626626721303200535504374547096844350009340708329652643759951123419209007395E-10,
             1.080275650886253312521126674018026139028486658301257376503552681661356174264794018341635980937006524E-9,
             1.196180513076395563785442992302771278579455970713355948369743905248908187639348572515486912204370288E-9,
             1.331819102493829766594815155414467845305042586246686799316630415138046272601256534252468351786000352E-9,
             1.491939710984346377936905545847519651359055836905500172930917094344645529753472800201713895780237928E-9,
             1.682809735892744540613961021960060300076712479950636395127024337321243509927884888330953544626729682E-9,
             1.912838522300817281008123190266391437619442835829562841864615241603076078234965395619440833223596375E-9,
             2.193519850358535858606604709410616037206741344188944614708057742149881216735831921832339583868588141E-9,
             2.540896276026029487819238660714965594426939006978684345514981067132406731659412544856231901819871120E-9,
             2.977903704687672012016307580844516593308061260328268734487647938260170418745268895735668151434933592E-9,
             3.538257241967734005347470103820855845465200843046182663902838070039615258333356082166088739811986989E-9,
             4.273155186986363886622960104075012694572964278088227714037937299089141256214513195759984337890133120E-9,
             5.263404136500540001376925019493287584158916437980853448664813345468227288145375774037784555595723377E-9,
             6.642621844617658327486158506301057917018246214153566341460522614283634089553903255045532192488461984E-9,
             8.644797256205306325635663838202477154627295887515669617823876303699963743874177150768960498874291837E-9,
             1.171050158647735762780800580463771700436992991551669546858855343844207957391016113206607689471127982E-8,
             1.675173894038636115074451153937677759202836241792210315868478627158321013482857102125485575023497448E-8,
             2.591781971393158051775598198828543988356346588292853562965032197608496035384602363923279564302787883E-8,
             4.533235167250865299808336044480706750307279444217494179779337017979662060802870084361134175989376699E-8,
             9.877662975734095242385405664028486769520680164002000548140381144737055549749764835406916835564613128E-8,
             3.599535917426189149413341005093157272226394016628504549905159385034199997405194799249567776746898711E-7};

    Polynom<scalar, 10> polynom(coeffs);

    for (indexType i = 0; i < test_points.size(); ++i) {
        scalar compensated_horner_result = compensated_horner(polynom, test_points[i]);
        scalar experimental_relative_error = abs(
                (reference_results[i] - compensated_horner_result) / abs(reference_results[i]));
        //std::cout << experimental_relative_error << " " << reference_errors[i] << " " << i << std::endl;
        ASSERT_TRUE(experimental_relative_error < reference_results[i]);
    }

}

TEST(POLYNOM_EVAL, TEST_4) {

    Containers::array<scalar, 11> coeffs = {59049, -196830, 295245, -262440, 153090, -61236, 17010, -3240, 405, -30, 1};
    Containers::array<scalar, 100> test_points = {2.600, 2.603, 2.606, 2.609, 2.612, 2.615, 2.618, 2.621, 2.624, 2.627,
                                                  2.630, 2.633, 2.636, 2.639, 2.642, 2.645, 2.648, 2.651, 2.654, 2.657,
                                                  2.660, 2.663, 2.666, 2.669, 2.672, 2.675, 2.678, 2.681, 2.684, 2.687,
                                                  2.690, 2.693, 2.696, 2.699, 2.702, 2.705, 2.708, 2.711, 2.714, 2.717,
                                                  2.720, 2.723, 2.726, 2.729, 2.732, 2.735, 2.738, 2.741, 2.744, 2.747,
                                                  2.750, 2.753, 2.756, 2.759, 2.762, 2.765, 2.768, 2.771, 2.774, 2.777,
                                                  2.780, 2.783, 2.786, 2.789, 2.792, 2.795, 2.798, 2.801, 2.804, 2.807,
                                                  2.810, 2.813, 2.816, 2.819, 2.822, 2.825, 2.828, 2.831, 2.834, 2.837,
                                                  2.840, 2.843, 2.846, 2.849, 2.852, 2.855, 2.858, 2.861, 2.864, 2.867,
                                                  2.870, 2.873, 2.876, 2.879, 2.882, 2.885, 2.888, 2.891, 2.894, 2.897};

    Containers::array<scalar, 100> reference_results =
            {0.000104857600000000000000000000, 0.000097253461433805715000527049, 0.000090149270822232320504882176,
             0.000083515593923598484276028401, 0.000077324524128297629567156224, 0.000071549613990099615712890625,
             0.000066165809334147587692954624, 0.000061149385863482168213854201, 0.000056477888187717354967269376,
             0.000052130071199257068815346649, 0.000048085843724178490000000000, 0.000044326214376618333352652449,
             0.000040833239547181264169598976, 0.000037589973457545958193355601, 0.000034580420215074076278989824,
             0.000031789487802830871103515625, 0.000029202943942003483972993024, 0.000026807373765254438673009001,
             0.000024590139241073610670744576, 0.000022539340290692258087863249, 0.000020643777540597760000000000,
             0.000018892916655137732057698849, 0.000017276854195127393442251776, 0.000015786284949774657045043801,
             0.000014412470690613620767719424, 0.000013147210297489166259765625, 0.000011982811207963436516967424,
             0.000010912062142819279835644801, 0.000009928207061616528930635776, 0.000009024920303514444856660849,
             0.000008196282869808010000000000, 0.000007436759805837217107346249, 0.000006741178641117286368280576,
             0.000006104708847704064244053001, 0.000005522842277952930315265024, 0.000004991374543951576181640625,
             0.000004506387302007237665357824, 0.000004064231406647572522401601, 0.000003661510899651594831102976,
             0.000003295067800663118480459449, 0.000002961967666954240000000000, 0.000002659485890900719634874649,
             0.000002385094704704913351525376, 0.000002136450862855381637743201, 0.000001911383973745667813146624,
             0.000001707885452788213369140625, 0.000001524098070253174888244224, 0.000001358306067936240628319401,
             0.000001208925819614629174706176, 0.000001074497011086501939579049, 9.53674316406250000000000E-7,
             8.45219547726738091164049E-7, 7.47994256939818786226176E-7, 6.60952768068482275874401E-7,
             5.83135620108095986484224E-7, 5.13663400740527822265625E-7, 4.51730952053751361306624E-7,
             3.96601930091015154838201E-7, 3.47603700728035650405376E-7, 3.04122555034158459939649E-7,
             2.65599227914240000000000E-7, 2.31524704452345220694449E-7, 2.01436298986451489022976E-7,
             1.74913992535407978606601E-7, 1.51577014775638417997824E-7, 1.31080657325707041015625E-7,
             1.13113305642107341825024E-7, 9.7393677359695041798001E-8, 8.3668255425284801560576E-8,
             7.1708904873278937061249E-8, 6.1310662578010000000000E-8, 5.2289689788971837545849E-8,
             4.4481377712499930955776E-8, 3.7738596846955704499801E-8, 3.1930081208285372007424E-8,
             2.6938938999176025390625E-8, 2.2661281678134344679424E-8, 1.9004963774880799438801E-8,
             1.5888426175698793931776E-8, 1.3239635967018160063849E-8, 1.0995116277760000000000E-8,
             9.099059901039401398249E-9, 7.502520803928269464576E-9, 6.162677950336718514001E-9,
             5.042166166892418433024E-9, 4.108469075197275390625E-9, 3.333369396234118349824E-9,
             2.692452204196940400601E-9, 2.164656967840983678976E-9, 1.731874467807835667449E-9,
             1.378584918490000000000E-9, 1.091533853073393531649E-9, 8.59442550649180389376E-10,
             6.72749994932560009201E-10, 5.23383555379856794624E-10, 4.04555773570791015625E-10,
             3.10584820834420916224E-10, 2.36736367459211723401E-10, 1.79084769654285362176E-10,
             1.34391637934412192049E-10};

    Containers::array<scalar, 100> reference_errors =
            {1.466390660395929600000000E-12,
             1.496319930816943274448814398912382427981011856186061831336195941707422694451658296163782638782392158E-12,
             1.529000627682554650275994656628628920982116450623978638665599683980928240262942034493239584849645541E-12,
             1.564708197451335302497206301950384369863669533929211911805883070224372146331684665511813189021711439E-12,
             1.603747972408690617517698545622911783845657164997993502978285741683641507211671051378508106695362342E-12,
             1.646458669888984066820215985535688435978350773390694118793382419667070766817790706645475151958865698E-12,
             1.693216331918726190181923843365187352360787395948953662440953698862753770547749076860364709077068202E-12,
             1.744438764659732265474874312755976001295233888546340705123496354544104034246599171255086432561367272E-12,
             1.800590545579617633689428057009211302831820589773571007873092854618002561599050334442219336908925153E-12,
             1.862188676135825038067290436070379135565440113041924009711771625385181673913658747895069252066910742E-12,
             1.929808969141873634643087731848353732979876939347190350343449450303071440136584111039981657575884727E-12,
             2.004093273140783109547980673716524374248337744927203982222988634592175526393012322648836658487843361E-12,
             2.085757651334254009331202262592601878160668044841685971259628129769891262933036212385116549890881134E-12,
             2.175601650252267415127163740649981272048363527682970878919751763507231103487828305264117078978238956E-12,
             2.274518813802439064487113174392526741209808759903925874282012792703194426620499145014249289240453298E-12,
             2.383508622090324794410004047932972365664802039117048109444599460356601721555096289233803035031871462E-12,
             2.503690062015663308822342251286980666488877979562825293781757141232065224346442428815910950973293202E-12,
             2.636317068792530686685106522767585419791106442782227977904765104700175221075195112950846695708754505E-12,
             2.782796115003066245142609049132052476200601251543973214663565992279163267160036357136043370390523335E-12,
             2.944706267510217722712507736587112749761699251042966878090673073440030055604307079056519548515206943E-12,
             3.123822083634688658642326202063208393276199611228479597363073698181318856925404304666047584372623664E-12,
             3.322139777763650316059310935335699651452190599505023243106896457042597909648350130361196476856489600E-12,
             3.541907159572945433616617424978806579408660430846763907517483849589384303283013035419657209588648616E-12,
             3.785657927180379120718575720229602577364682473195645492174868197303804002860927125532179491880878902E-12,
             4.056250995036975652089371984322384445606351628998109943489958030269203555180522801259040012434415356E-12,
             4.356915649873378800413997215075539775064466148626770039256212638157162696671102184966134911223940935E-12,
             4.691303461743497541705294392564258487945419882623237215681372748490428172107118241830551243726873773E-12,
             5.063548034976475960634622242717442079896657817661625262721609481779981463544409566356652424169085291E-12,
             5.478333870260369148849972307322026247420493842033695988405953784268074685255697590450606591862536791E-12,
             5.940975829669537489646387750356119639675609929296149891491300501244095133450689178155172502003361951E-12,
             6.457510957880212140839535987371404924951722173973905458948764918488418808891181122341988895226896732E-12,
             7.034804723143268823790148966751228433870587010616793779395215083803568883528489821314748766094787571E-12,
             7.680674110532088913326391708251532640660960704869865913014751065945817651955184222173036848660400553E-12,
             8.404030439345562842007031403941426887879654842196512452949005247471160141532698143438195803885585140E-12,
             9.215045300628473240971962554055067626377400253163882164085638960219845813280464514722173977053561036E-12,
             1.012534363696766233577111537474141756101878392495052850182469807543364111604384537233389168488901432E-11,
             1.114822873621987558759950458542137356935459230208245860591261064367646840947972326820350478311781054E-11,
             1.229894480948351144324016665830474108217072628042180214988347258322211328534024146083475501089918677E-11,
             1.359498390306065786397620223135882244865733821354704901818210609252939813076817934264083832763712547E-11,
             1.505644519310915080428892167668566688010192335503655414232620988531852069100034100601377464210328517E-11,
             1.670645627772194346212787266186284519391644115339818675582440145047894090005740644554666805515409953E-11,
             1.857166797281259198677310173182338891501359472420126378781629148886845385750828692415884310320176033E-11,
             2.068283640758163409525118431882925218739588179936248426637158083928451329347437335002903624456395747E-11,
             2.307550899163816520188834677853708545396666846673376124529631858749779116861670295965719042243929935E-11,
             2.579083419945057970587083930700864748859397300834297294409733020842981216071229496368705070959820325E-11,
             2.887651922571766470024262396231542703301515634839709522863857233589669578100333074782336492836011506E-11,
             3.238796457793671736286073020255274135117407072192886857518456361966167474207050602316924257851292623E-11,
             3.638961080244202901061272656056575408942572504894158629927324951092574728867496866598509821610604331E-11,
             4.09565400531646417795481291906071419361978769302368164062500000000E-11,
             4.617638444121863088828835478014536450994178123492226073018655558668167105442693321007242969530268824E-11,
             5.2151604466336932900000000E-11,
             5.900221485484755609041215260770382924470335755045322512959919262459692502541417574632579395407962817E-11,
             6.686905247838954681191276041011109689748599659053940219080148549030217113004258414137413721856494373E-11,
             7.591770254505437075285171971130594889847746099629449832634999391061927490060210228292283144432095338E-11,
             8.634322600936869624004147592898664220651360534213305023678782743245533895362547529542165838496096741E-11,
             9.837586450101345875494210171752450325212994464147309124481585474744347452223209270243763696730945397E-11,
             1.122879407630522016409708720466210839801090464448641512854744214011392887579771759606673883817721036E-10,
             1.284022248455981895209339931796219700336240489763980903979863990098472058230546467817038782556035196E-10,
             1.471021019811951299197369161532833204041706290031952885155963332548272504116234893913732042634218830E-10,
             1.688439608606820271437021106238918955748634944847952763911886992362487425181969682131886516897249834E-10,
             1.941723256997308737873413121483409994318271290731066981463877991130087834891283391532585567823391936E-10,
             2.237383882197069962716696540874485269150257816227343041482931997026424669331450456081067726286144582E-10,
             2.583227645094143616917053929291116849568427027937355412318324949570363597314715767444125465317386844E-10,
             2.988635171967898556941805454652192264794710737843939087156344619380618008295859472048550523322693332E-10,
             3.464907592171386665127141114659794104766711867265844544107899614630144378839946988574573957147019043E-10,
             4.025695098383528810081282367627605642170708218066777551017079717152371502307485850259343045855391368E-10,
             4.687529304215937149253286710241113026903438376100916569067627998040194701435049110130219767985017005E-10,
             5.470486583753913595305083802532849802998807681924620961339789803992054224953253264128769678845756107E-10,
             6.399017251116615482457086187590480311484521393940464197646287865413281760319158292040645920120140395E-10,
             7.502985439367665595289915067794562962489262334151096885107691592730568330265532419470479444579825298E-10,
             8.818977623961805826715872293487365307544191556541696424731705711166954646296080523390898905557837943E-10,
             1.039195492641804681064529410643974566914265232860150771780442572529663051786045376337839785411940952E-9,
             1.227734700994217626112250239941199694244167135495140676186770584502582208567065030454896945300117660E-9,
             1.454371541825518080381784050667188738476533202115530096656408381028259124842402292294454690979464202E-9,
             1.727615417808186883313569722089019670953618285632258139085935802916511138723444050392220180994430458E-9,
             2.058064890836064065895876820344001183622286142316136165260978316723246786128153833400107915295615864E-9,
             2.458968741841436793859947357537177404790235448014258584194941289018705365540546576322687485625727537E-9,
             2.946951157989763272616890778416088209714347938604699470297413338472842719290267681121126532142972772E-9,
             3.542953153399927224892522166604333928711911793304711393968565781663001004269072406373778448331030981E-9,
             4.273460224585594875436377487946164188778146896193822786175191745974360251335246386168166177806740568E-9,
             5.1721107663845247845047851562500000000E-9,
             6.281813570972060393046465081496021943767968936539959060577408552324688516163388250346212273605176432E-9,
             7.657549575448959475152403673673330383157278421490548212384025076197521755811700463433498245580605492E-9,
             9.370098336068495829681255102726861017775123679001838138827701183857321137022370986875466944594363705E-9,
             1.151102133608371803983849480666922104357079848201215786530233764361227340401842806022501955872160286E-8,
             1.419936361024970750241233209743072706339517177933022614962573457741384934574154329445304060522749024E-8,
             1.759071906400004320159587121312098175104349903126514395368777241709361624029969306038961090092394906E-8,
             2.188956807149539397633094415583403533364619954090049606259003958205599197150221587737418340049045701E-8,
             2.736617538727537809330277567199977823507903450126982701134653615365870167911085591383943458097075288E-8,
             3.437988756602784095890478164607613937691788665568125616869043082622409103121092256934254443021135414E-8,
             4.341147595183167281510373682626358817827342703646640413349673826519158121970410617994660809993437200E-8,
             5.510836220024492769629330026410836292203609997162036290706995863844004419056028092672555473619565049E-8,
             7.034833608839186940828213128624368809585093366568038186247639553633131785494614703493891381145535331E-8,
             9.033003802693584967051520532888868703673784319040060449162206470479279619508077265254788967594067466E-8,
             1.167025154181655958667092642001566924246088008192122852306155397177054301072731517122504090167114678E-7,
             1.517523420798626835582096101344718097157695062959939047091655450489540493969191926493064166004309028E-7,
             1.986763490156522099001540776777932851738100423800316749167641232878424686334199850550445925972084018E-7,
             2.619829605530202452411015566452145504186912794130669896516401129151707862527187684967760597458907507E-7,
             3.480887640783120002648689723837046930316694485567516432016144859183895080042148574724622787106467889E-7,
             4.662147637269947329401122387111849627321810534917163758639176019978591182162988277494230198493122509E-7};

    Polynom<scalar, 10> polynom(coeffs);

    for (indexType i = 0; i < test_points.size(); ++i) {
        scalar compensated_horner_result = compensated_horner(polynom, test_points[i]);
        scalar experimental_relative_error = abs(
                (reference_results[i] - compensated_horner_result) / abs(reference_results[i]));
        //std::cout << experimental_relative_error << " " << reference_errors[i] << " " << i << std::endl;
        ASSERT_TRUE(experimental_relative_error < reference_results[i]);
    }

}

TEST(POLYNOM_EVAL, TEST_5) {

    Containers::array<scalar, 11> coeffs = {5764801, -6588344, 3294172, -941192, 168070, -19208, 1372, -56, 1};
    Containers::array<scalar, 100> test_points = {6.500, 6.503, 6.506, 6.509, 6.512, 6.515, 6.518, 6.521, 6.524, 6.527,
                                                  6.530, 6.533, 6.536, 6.539, 6.542, 6.545, 6.548, 6.551, 6.554, 6.557,
                                                  6.560, 6.563, 6.566, 6.569, 6.572, 6.575, 6.578, 6.581, 6.584, 6.587,
                                                  6.590, 6.593, 6.596, 6.599, 6.602, 6.605, 6.608, 6.611, 6.614, 6.617,
                                                  6.620, 6.623, 6.626, 6.629, 6.632, 6.635, 6.638, 6.641, 6.644, 6.647,
                                                  6.650, 6.653, 6.656, 6.659, 6.662, 6.665, 6.668, 6.671, 6.674, 6.677,
                                                  6.680, 6.683, 6.686, 6.689, 6.692, 6.695, 6.698, 6.701, 6.704, 6.707,
                                                  6.710, 6.713, 6.716, 6.719, 6.722, 6.725, 6.728, 6.731, 6.734, 6.737,
                                                  6.740, 6.743, 6.746, 6.749, 6.752, 6.755, 6.758, 6.761, 6.764, 6.767,
                                                  6.770, 6.773, 6.776, 6.779, 6.782, 6.785, 6.788, 6.791, 6.794, 6.797};

    Containers::array<scalar, 100> reference_results =
            {0.003906250000000000000000, 0.003722640602679094258561, 0.003546627615893473935616,
             0.003377940044732998170721, 0.003216314998934990749696, 0.003061497497803500390625,
             0.002913240278671707832576, 0.002771303608864315695361, 0.002635455101117021618176,
             0.002505469532410439724481, 0.002381128666176100000000, 0.002262221077832419710241,
             0.002148541983608805523456, 0.002039893072616309544481, 0.001936082342123527004416,
             0.001836923935996687890625, 0.001742237986263159341056, 0.001651850457757840166401,
             0.001565592995812193403136, 0.001483302776945927340001, 0.001404822362521600000000,
             0.001329999555322686599521, 0.001258687259015914045696, 0.001190743340458931072641,
             0.001126030494814647156736, 0.001064416113433837890625, 0.001005772154467879035136,
             0.000949975016173736007841, 0.000896905412873600106496, 0.000846448253531827305121,
             0.000798492522912100000000, 0.000752931165277996622401, 0.000709660970600418574336,
             0.000668582463235588483201, 0.000629599793037598310656, 0.000592620628869750390625,
             0.000557556054479199010816, 0.000524320466699664691681, 0.000492831475947257856256,
             0.000463009808974713123841, 0.000434779213849600000000, 0.000408066367122340274881,
             0.000382800783150126981376, 0.000358914725543104304161, 0.000336343120699432370176,
             0.000315023473396125390625, 0.000294895784402816164096, 0.000275902470085864489921,
             0.000257988283970491580416, 0.000241100240228887100161, 0.000225187539062500000000,
             0.000210201493946988852961, 0.000196095460708571938816, 0.000182824768400781863521,
             0.000170346651950894039296, 0.000158620186545562890625, 0.000147606223725464190976,
             0.000137267329159006474561, 0.000127567722065439006976, 0.000118473216257948338081,
             0.000109951162777600000000, 0.000101970394089246452641, 0.000094501169810786918656,
             0.000087515123947429289281, 0.000080985213602868822016, 0.000074885669139562890625,
             0.000069191945760545587456, 0.000063880676485490517601, 0.000058929626493994663936,
             0.000054317648809320741601, 0.000050024641296100000000, 0.000046031504945761969921,
             0.000042320103423722192896, 0.000038873223852623509441, 0.000035674538806191022336,
             0.000032708569488525390625, 0.000029960650073923649536, 0.000027416893182581291041,
             0.000025064156467793879296, 0.000022890010290541014721, 0.000020882706457600000000,
             0.000019031147999601100801, 0.000017324859965700833536, 0.000015753961211814252001,
             0.000014309137159611744256, 0.000012981613503750390625, 0.000011763130845074473216,
             0.000010645920227784266881, 0.000009622679558836781056, 0.000008686550888106661441,
             0.000007831098528100000000, 0.000007050287992278341281, 0.000006338465731314712576,
             0.000005690339646868044961, 0.000005100960362726891776, 0.000004565703233437890625,
             0.000004080251070798954496, 0.000003640577568861717121, 0.000003242931408352297216,
             0.000002883821021683985761};

    Containers::array<scalar, 100> reference_errors =
            {1.457981431898240100000000E-12,
             1.475794346480542823482239076887496635655333240949339303529181048218480335973227615461360300322694838E-12,
             1.494631040057955019906689740762435800814779282812154637420946797670135762648628601736441436652333351E-12,
             1.514556919826051114615437249827438184272558017614864824702306642833806584109286538370178171293270303E-12,
             1.535641998897157498363901792093614336833892911439697424720592361011367837749569361242056942779314594E-12,
             1.557961251231121306675561083068791844945015703483315782898514189205236562125952070976416490116249024E-12,
             1.581594996311143385843553571325925433598209507015594572665796948507900795030145906749224706550772213E-12,
             1.606629316261151786218887143670298584465676764364481928235865904789129643597762021901074296244042439E-12,
             1.633156508364371419523653144751023174230234821033250430646675347896460782343879665869821347189815512E-12,
             1.661275576233466396452248558181279781775907873189782843323894326710942427178077450778266532430253255E-12,
             1.691092763203973113850521058512561387808657770200014620573963316149890515839098415255790620544927441E-12,
             1.722722131878150032914648664144314257226183645795876858576516218866092296320803182542655933537415149E-12,
             1.756286194139702813770748207917803061006245174973885443580345137426569534162029487320520077383344042E-12,
             1.791916596395425000058368111521741366488556499539669628952724991063117729768055762114463762180093105E-12,
             1.829754865282473763528071582444200772270382652521586724815011077203682874084686914974960970691974102E-12,
             1.869953219615219035433512991353920088538629403905949007405349393479567137695185566022099099048152681E-12,
             1.912675454939474051513108150897709422840753153814811453903944673341404577230010413591480606031998167E-12,
             1.958097907721304495022082730746015357528124740279188867754349388580117138392359580720001138529289850E-12,
             2.006410506930247440197530387775589029056540083346261218005390361807402954080994131509190763178846253E-12,
             2.057817921591345932206841823214425960552386210652195229994322423300130181779798349863007841492717485E-12,
             2.112540813786715855830578346786574240420670977471654183527856725469657587921444691624416531638826758E-12,
             2.170817207596451877532842181368759511799808874218229042851672580365240184050035304576075535488693194E-12,
             2.232903985593008180614998828330734957302811805524296996175122221019155932964215490475110912322175204E-12,
             2.299078525756826269928302728586070280019729250049414027906651922083635526006076836287101892871806091E-12,
             2.369640493079825292401701483293014698291742505569103256995004067909214928171389467354203910855544105E-12,
             2.444913801685402216391513447406864902772928855913182546680811403516804133098297045560933803690150412E-12,
             2.525248765039165070514183978208252982189376207984616829010403303442366538892225600827932314770557016E-12,
             2.611024453776803395018934403868704572506359558467085583572649579146409985085622467300933314192169538E-12,
             2.702651282860435375043366869703347852703956211549865117805217489166991909821672635031236000243761813E-12,
             2.800573852222137671357834246665507439856314521754043079631200253624481356882427598628303961046882411E-12,
             2.905274067796871950197670330386268653940737043922690289437819164703166925681292037304882277625408838E-12,
             3.017274572924997696658960405204280416605169613023115722383272057067914268301587056689735374962722726E-12,
             3.137142523560617992153472344281839095835148448846655457273589819744485932380038503009640762233498410E-12,
             3.265493744605820685986960148565756644793358536603203916646982334145122496467437316023190339095912084E-12,
             3.402997309059088190899754863724605516316355168443466120395041732219845446343585259755742807385073469E-12,
             3.550380586583387060835051720532468859445113470640047207677302573332336970048707471512462693714535216E-12,
             3.708434813639541412741237728761148910430732994946399710935381811098076065418389984320360754863871277E-12,
             3.878021243577856831463021026164760033753122536088016002634857071624376843146969285375596300256008913E-12,
             4.060077942132209437506396716677628719782705469988775936753201815630066661594891235790588906813478443E-12,
             4.255627301726640448768370267399540252781102288365582528946837046226320231333756296242987212522279274E-12,
             4.465784357011849284182968876936969942383952787896034283045471341622230564545763857302715681661654686E-12,
             4.691765994243604160850970020896704454126225166150927989863461530969219363876309386392984325475865195E-12,
             4.934901158664491104554462752583196965836030416947696142317252539361265576459969194647661681260450233E-12,
             5.196642177147314551982984387969608573066037556161646883558025687771445618387280100087071920018908027E-12,
             5.478577328224807360695008359870619056526438086764850392560852601846349128173728053391007877082976119E-12,
             5.782444808522037203262438653756042573979204755730558070221564020355514181440779473293547575856709926E-12,
             6.110148263820443350535327342444443401675839153221535151745039560394793177802770109274326047805380721E-12,
             6.463774074857224092310093676874456585964770056941048521184687991961671828942587212885225653005401005E-12,
             6.845610612895847094916787669052426418340130245781497876538182196385684357850868384094717373974342929E-12,
             7.258169708550360949227891072685031871106985952865323005318015396161189529969417355839154114517811156E-12,
             7.704210609838640100000000E-12,
             8.186766742593928271089845070353488914328259248928610492929542518164244105217478009999171146998675347E-12,
             8.709175628896500116706853278876201889999099872894019283101534281731231657323485283905405597318278330E-12,
             9.275112367931939110352049597058729614955590614709422750530057481732289532827874753793325482249330406E-12,
             9.888627139611528815483699626422269938170733568008677694666331560219253314047884327446935552087907697E-12,
             1.055418725553811209378258698847598006710527215754346830455270700968764036202877133025277138213777869E-11,
             1.127672435579336872715667630275053427000820156652024968933492195383337943182901013993243777308097288E-11,
             1.206168743511138335387736719817903180726340157325245312172065673886813487645665992257470986560899838E-11,
             1.291510248010683508162157338428214826563936424993588379471290310259719917199689306724183638493156938E-11,
             1.384363961247777412426966512162841864690782667375227967065566342580967495388914996477755325801108032E-11,
             1.48546887640101057587905883789062500000000E-11,
             1.595644506072436277106616605554931230476540596825227170975954926009484958410024791533686412771465390E-11,
             1.715800526910288987316421114802566977976010964772004612832213899804255490670327783598482050594324000E-11,
             1.846947686112223388968590254618344208285456204398953957905620333546650401353773429390267091840540657E-11,
             1.990210149164420901563150117395882468709099111223667938441981323834210535928296808005822721196235392E-11,
             2.146839495733568157884357369451511574248284727512617560781871723108267180267303514202125394429348550E-11,
             2.318230602750565303929115838270817557732293453133795855921876839720546119821555766746743475526428306E-11,
             2.505939691216260389469372886030220579292445634593918613382324585014520383546238159586348021520721837E-11,
             2.711704857083527504645088170038008132768141920777960858569468776123120927816742911344449586635563995E-11,
             2.937469457874299410093145823970183990061839405320622841323112828470750014806530122219159985499450799E-11,
             3.185408786844879278119831013474300333514830646086168728205074766623060055601636752102935785232735883E-11,
             3.457960537156584712456273031458187366727759164672065477280210619396032232408156479667721265015267650E-11,
             3.757859641604654199989333169111593276020299027822079830986503484805452681405047003243121629072388588E-11,
             4.088178171362609801022191998956388420309092857294778208901793558059761342860613668264057345330148209E-11,
             4.452371092745239036471552688686006985905142977198326741953328922607987082669142637919564623234036451E-11,
             4.854328817594497635261023824807146665409211573557337239505369502278750932647385857551663558086963516E-11,
             5.298437644669311710573544204172680607975285246160267114138609281383125431410767999494723256963659096E-11,
             5.789649381355984176884626796816875338197895417846024794296517906228299002008104759499494762772916581E-11,
             6.333561663150335448705375203841479944019951661213962105020457350095574682773069349835729796906283936E-11,
             6.936510760030559498782572154810690620095947777153728567420080673322733371507139207234348330749044318E-11,
             7.605678982967355158991667312723410351980601696622873665193247024957884355565419486021784877708436826E-11,
             8.349219191291863569466227736092835298820597443219844749502333965953122568730440952075796759223344420E-11,
             9.176399365769135906286039338512903297972192354170990080077924639869264589412160176157746370698874720E-11,
             1.009777076930695496106430879908087090444128515159615012323018765989669689268118429048503916850368787E-10,
             1.112536388728346000581967823287551080138962667582491506000104965171481465995727978902284983567123970E-10,
             1.227291714713830971695904333905021179395437934457754916431633980080145004138043967172500837409652129E-10,
             1.355614439253603542663026488308869061901729795783571011204285743608188590857296270404985786730669923E-10,
             1.499304826866945524562092671188565678788641653066257205246954399830033052726168342310605913118601163E-10,
             1.660428810873803779606921927033468776866795780871244746810285004892151588151781228414701348761900547E-10,
             1.841361265525726582633178199403607776325252312731094531019055351882293417551607684969465044185496381E-10,
             2.044837007585770172394372186203269128550501246757516198540191369195601680352199986004923880508161015E-10,
             2.274011033188959534776087451841885974902215547436857594226387566638348619773574943269869367960531141E-10,
             2.5325298142602615500039062500000000E-10,
             2.824615870013116886296249039482671250916746626449466503496791671212189907677347418018362582630063231E-10,
             3.155168311025573523688682972272675593706908338727947749967799588870967630160446344686605112568417454E-10,
             3.529882648760236957438051146229578870615037040638858205849687992840708021716484357170670074525146442E-10,
             3.955393900907875772780800428913124282531253882145267215221288976532895446868617496821436757716541054E-10,
             4.439447939171570674658079578775224669787593629270656192832683194660446636799174320343250230535036544E-10,
             4.991107167761628511058540620428064651313858469088568807349278092330964586489339100318465515098511108E-10,
             5.620998047744066538365390864836146748599694053569131875192868485660729507201420854127854412643207343E-10};

    Polynom<scalar, 10> polynom(coeffs);

    for (indexType i = 0; i < test_points.size(); ++i) {
        scalar compensated_horner_result = compensated_horner(polynom, test_points[i]);
        scalar experimental_relative_error = abs(
                (reference_results[i] - compensated_horner_result) / abs(reference_results[i]));
        std::cout << experimental_relative_error << " " << reference_errors[i] << " " << i << std::endl;
        ASSERT_TRUE(experimental_relative_error < reference_errors[i]);
    }

}

